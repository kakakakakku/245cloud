","ﾂ�":"\\u008b","ﾂ�":"\\u008c","ﾂ�":"\\u008d","ﾂ�":"\\u008e","ﾂ�":"\\u008f","ﾂ�":"\\u0090","ﾂ�":"\\u0091","ﾂ�":"\\u0092","ﾂ�":"\\u0093","ﾂ�":"\\u0094","ﾂ�":"\\u0095","ﾂ�":"\\u0096","ﾂ�":"\\u0097","ﾂ�":"\\u0098","ﾂ�":"\\u0099","ﾂ�":"\\u009a","ﾂ�":"\\u009b","ﾂ�":"\\u009c","ﾂ�":"\\u009d","ﾂ�":"\\u009e","ﾂ�":"\\u009f","ﾂｭ":"\\u00ad","ﾘ":"\\u0600","ﾘ�":"\\u0601","ﾘ�":"\\u0602","ﾘ�":"\\u0603","ﾘ�":"\\u0604","ﾜ�":"\\u070f","癰ｴ":"\\u17b4","癰ｵ":"\\u17b5","窶�":"\\u200c","窶�":"\\u200d","窶�":"\\u200e","窶�":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","窶ｪ":"\\u202a","窶ｫ":"\\u202b","窶ｬ":"\\u202c","窶ｭ":"\\u202d","窶ｮ":"\\u202e","窶ｯ":"\\u202f","竅�":"\\u2060","竅｡":"\\u2061","竅｢":"\\u2062","竅｣":"\\u2063","竅､":"\\u2064","竅･":"\\u2065","竅ｦ":"\\u2066","竅ｧ":"\\u2067","竅ｨ":"\\u2068","竅ｩ":"\\u2069","竅ｪ":"\\u206a","竅ｫ":"\\u206b","竅ｬ":"\\u206c","竅ｭ":"\\u206d","竅ｮ":"\\u206e","竅ｯ":"\\u206f","\ufeff":"\\ufeff","�ｰ":"\\ufff0","�ｱ":"\\ufff1","�ｲ":"\\ufff2","�ｳ":"\\ufff3","�ｴ":"\\ufff4","�ｵ":"\\ufff5","�ｶ":"\\ufff6","�ｷ":"\\ufff7","�ｸ":"\\ufff8","�ｹ":"\\ufff9","�ｺ":"\\ufffa","�ｻ":"\\ufffb","�ｼ":"\\ufffc","�ｽ":"\\ufffd","�ｾ":"\\ufffe","�ｿ":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h=JSON&&JSON.stringify||function(e){
return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,r={},n=[];for(t=0;65536>t;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return r[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,r};r.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(u||(u=p(l)),t.replace(l,function(e){return u[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){for(var e={},t=0;t<d.length;t++){var r=d[t];e[r]=k[r]&&k[r].enabled()}return e},r.detectProtocols=function(e,t,r){var n={},i=[];t||(t=d);for(var o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}var a=function(e){var t=e.shift();n[t]?i.push(t):e.length>0&&a(e)};return r.websocket!==!1&&a(["websocket"]),n["xhr-streaming"]&&!r.null_origin?i.push("xhr-streaming"):!n["xdr-streaming"]||r.cookie_needed||r.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),n["xhr-polling"]&&!r.null_origin?i.push("xhr-polling"):!n["xdr-polling"]||r.cookie_needed||r.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";r.createHook=function(){var t="a"+r.random_string(8);if(!(g in e)){var n={};e[g]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return e[g](t)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.addEventListener(r,n,!1):(t.attachEvent("on"+r,n),e.attachEvent("on"+r,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.removeEventListener(r,n,!1):(t.detachEvent("on"+r,n),e.detachEvent("on"+r,n))};var m={},v=!1,b=function(){for(var e in m)m[e](),delete m[e]},_=function(){v||(v=!0,b())};r.attachEvent("unload",_),r.unload_add=function(e){var t=r.random_string(8);return m[t]=e,v&&r.delay(b),t},r.unload_del=function(e){e in m&&delete m[e]},r.createIframe=function(e,n){var i,o,s=t.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unload_del(o))},c=function(e){s&&(u(),n(e))},f=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),i=setTimeout(function(){c("timeout")},15e3),o=r.unload_add(u),{post:f,cleanup:u,loaded:a}},r.createHtmlfile=function(t,n){var i,o,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},f=function(){u&&(c(),r.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(e){u&&(f(),n(e))},h=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var p=u.createElement("div");return u.body.appendChild(p),s=u.createElement("iframe"),p.appendChild(s),s.src=t,i=setTimeout(function(){l("timeout")},15e3),o=r.unload_add(f),{post:h,cleanup:f,loaded:c}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(t,n,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=r.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,n,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var c in o.headers)s.xhr.setRequestHeader(c,o.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,r=e.responseText}catch(e){}1223===t&&(t=204),r&&r.length>0&&s.emit("chunk",t,r);break;case 4:var t=e.status;1223===t&&(t=204),s.emit("finish",t,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};S.prototype=new y;var E=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,n){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:B.enabled()?3:4};var k=function(t,n,i){if(this===e)return new k(t,n,i);var o,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&r.objectExtend(s._options,i),s._base_url=r.amendUrl(t),s._server=s._options.server||r.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?o=s._options.protocols_whitelist:(o="string"==typeof n&&n.length>0?[n]:r.isArray(n)?n:null,o&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=z(s._base_url),s._ir.onfinish=function(e,t){s._ir=null,e?(s._options.info&&(e=r.objectExtend(e,s._options.info)),s._options.rtt&&(t=s._options.rtt),s._applyInfo(e,t,o),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new n,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},k.prototype._dispatchOpen=function(){var e=this;e.readyState===k.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=k.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("message",{data:e}))},k.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},k.prototype._didClose=function(e,t,n){var o=this;if(o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN&&o.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:r.userSetCode(e)});if(!r.userSetCode(e)&&o.readyState===k.CONNECTING&&!n){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=k.CLOSED,r.delay(function(){o.dispatchEvent(s)})},k.prototype._didMessage=function(e){var t=this,r=e.slice(0,1);switch(r){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var i=n.protocol=n._protocols.shift();if(!i)return!1;if(k[i]&&k[i].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(i),n.protocol="waiting-for-load",r.attachEvent("load",function(){n._try_next_protocol()}),!0;if(k[i]&&k[i].enabled(n._options)){var o=k[i].roundTrips||1,s=(n._options.rto||0)*o||5e3;n._transport_tref=r.delay(s,function(){n.readyState===k.CONNECTING&&n._didClose(2007,"Transport timeouted")});var a=r.random_string(8),u=n._base_url+"/"+n._server+"/"+a;return n._debug("Opening transport:",i," url:"+u," RTO:"+n._options.rto),n._transport=new k[i](n,u,n._base_url),!0}n._debug("Skipping transport:",i)}},k.prototype.close=function(e,t){var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==k.CONNECTING&&n.readyState!==k.OPEN?!1:(n.readyState=k.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},k.prototype.send=function(e){var t=this;if(t.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===k.OPEN&&t._transport.doSend(r.quote(""+e)),!0},k.prototype._applyInfo=function(e,n,i){var o=this;o._options.info=e,o._options.rtt=n,o._options.rto=r.countRTO(n),o._options.info.null_origin=!t.domain;var s=r.probeProtocols();o._protocols=r.detectProtocols(s,i,e)};var x=k.websocket=function(t,n){var i=this,o=n+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=t,i.url=o;var s=e.WebSocket||e.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=r.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(e){this.ws.send("["+e+"]")},x.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var j=function(){};j.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},j.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},j.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},j.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,r){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+r):e.send_schedule_wait()}),e.send_buffer=[]}},j.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(e,n,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=t.createElement("form"),a=o._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+r.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=n}catch(l){r.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var h=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,r.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",i(!0))};return c.onerror=c.onload=h,c.onreadystatechange=function(e){"complete"==c.readyState&&h()},h},M=function(e){return function(t,r,n){var i=new e("POST",t+"/xhr_send",r);return i.onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},O=function(e,n){var i,o,s=t.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,n(e),n=null)},u=!1,c=null;if(s.id="a"+r.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){c||(c=setTimeout(function(){u||a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))o=t.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),o&&l.insertBefore(o,l.firstChild),a},R=k["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(I),n._schedule_recv()};R.prototype=new j,R.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",O,t)},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(t,n,i){var o="a"+r.random_string(6),s=t+"?c="+escape(a+"."+o),u=0,c=function(t){switch(u){case 0:delete e[a][o],i(t);break;case 1:i(t),u=2;break;case 2:delete e[a][o]}},f=n(s,c);e[a][o]=f;var l=function(){e[a][o]&&(u=1,e[a][o](r.closeFrame(1e3,"JSONP user aborted read")))};return l},T=function(){};T.prototype=new j,T.prototype.run=function(e,t,r,n,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(M(i)),o.poll=new V(e,n,t+r,i)},T.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var C=k["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XHRCorsObject)};C.prototype=new T,C.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},C.roundTrips=2,C.need_body=!0;var A=k["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XDRObject)};A.prototype=new T,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var U=k["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRCorsObject)};U.prototype=new T,U.enabled=C.enabled,U.roundTrips=2;var q=k["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XDRObject)};q.prototype=new T,q.enabled=A.enabled,q.roundTrips=2;var B=function(){};B.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},B.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},B.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var r=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(r===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([k.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},B.prototype.postMessage=function(e,t){var r=this;r.iframeObj.post(r.window_id+e+(t||""),r.origin)},B.prototype.doSend=function(e){this.postMessage("m",e)},B.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var N,P=function(t,n){parent!==e?parent.postMessage(N+t+(n||""),"*"):r.log("Can't postMessage, no parent window.",t,n)},D=function(){};D.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},D.prototype._didMessage=function(e){P("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},r.parent_origin=void 0,k.bootstrap_iframe=function(){var n;N=t.location.hash.slice(1);var i=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var i=t.data.slice(0,8),o=t.data.slice(8,9),s=t.data.slice(9);if(i===N)switch(o){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==k.version&&r.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+k.version+'".'),!r.flatUrl(f)||!r.flatUrl(l))return void r.log("Only basic urls are supported in SockJS");if(!r.isSameOriginUrl(f)||!r.isSameOriginUrl(l))return void r.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");n=new D,n._transport=new D[c](n,f,l);break;case"m":n._doSend(s);break;case"c":n&&n._doCleanup(),n=null}}};r.attachMessage(i),P("s")};var W=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};W.prototype=new o(["finish"]),W.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=r.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var r=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var H=function(e){var n=this,i=function(){var t=new B;t.protocol="w-iframe-info-receiver";var r=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var r=JSON.parse(e.substr(1)),i=r[0],o=r[1];n.emit("finish",i,o)}else n.emit("finish");t.doCleanup(),t=null},i={_options:{},_didClose:r,_didMessage:r};t.i_constructor(i,e,e)};t.body?i():r.attachEvent("load",i)};H.prototype=new o(["finish"]);var F=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new o(["finish"]);var z=function(e){if(r.isSameOriginUrl(e))return new W(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new W(e,r.XHRLocalObject);case 2:return new W(e,r.XDRObject);case 3:return new H(e);default:return new F}},J=D["w-iframe-info-receiver"]=function(e,t,n){var i=new W(n,r.XHRLocalObject);i.onfinish=function(t,r){e._didMessage("m"+JSON.stringify([t,r])),e._didClose()}};J.prototype.doCleanup=function(){};var X=k["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};X.prototype=new B,X.enabled=function(){return"EventSource"in e&&B.enabled()},X.need_body=!0,X.roundTrips=3;var G=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,r.XHRLocalObject)};G.prototype=new T;var K=k["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};K.prototype=new B,K.enabled=function(){return e.XMLHttpRequest&&B.enabled()},K.need_body=!0,K.roundTrips=3;var Y=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRLocalObject)};Y.prototype=new T;var Q=k["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new B,Q.enabled=function(){return B.enabled()},Q.need_body=!0,Q.roundTrips=3;var $=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",re,r.XHRLocalObject)};$.prototype=new T;var V=function(e,t,r,n){var i=this;i.ri=e,i.Receiver=t,i.recv_url=r,i.AjaxObject=n,i._scheduleRecv()};V.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),r=0;t.onmessage=function(t){r+=1,e.ri._didMessage(t.data)},t.onclose=function(r){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===r.reason?e.ri._didClose(1006,"Polling error ("+r.reason+")"):e._scheduleRecv())}},V.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,o){var s=o?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Z.prototype=new n,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var ee,te=function(){if(void 0===ee)if("ActiveXObject"in e)try{ee=!!new ActiveXObject("htmlfile")}catch(t){}else ee=!1;return ee},re=function(t){var n=this;r.polluteGlobalNamespace(),n.id="a"+r.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+n.id);var o,s=te()?r.createHtmlfile:r.createIframe;e[a][n.id]={start:function(){o.loaded()},message:function(e){n.dispatchEvent(new i("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,r){o.cleanup(),n.iframe_close=o=null,delete e[a][n.id],n.dispatchEvent(new i("close",{reason:r}))},o=s(t,function(e){n.iframe_close({},"permanent")})};re.prototype=new n,re.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var ne=function(e,t){var r=this,n=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(n),s=o.indexOf("\n");if(-1===s)break;n+=s+1;var a=o.slice(0,s);r.dispatchEvent(new i("message",{data:a}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null;var n=200===e?"network":"permanent";r.dispatchEvent(new i("close",{reason:n}))}};return ne.prototype=new n,ne.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},k.getUtils=function(){return r},k.getIframeTransport=function(){return B},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}],94:[function(e,t,r){(function(r){function n(e,t,r,n,i,o,c,f){function l(e){if(f){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){f(null,JSON.parse(t))})}}var h=t?a:s;c["Content-Type"]="application/x-www-form-urlencoded";var p={hostname:r,port:n||(t?443:80),path:i,method:e,headers:c};if("GET"==e){var d=u.stringify(o);p.path+="?"+d,h.get(p,l).on("error",function(e){f(e)})}else{var g=h.request(p,l);g.setTimeout(5e3),g.on("timeout",function(){f&&f(new Error("timed out"),null),g.abort()}),g.on("error",function(e){f&&f(e,null)});var d=u.stringify(o);g.write(d),g.end()}}function i(e,t,r,n,i,s,a,c){var f=u.stringify(s),l=(t?"https://":"http://")+r+":"+n+i;"GET"==e&&(l+="?"+f);var h=o(e,l);h.withCredentials=!0,h.onload=function(){decoded="";try{var e=JSON.parse(h.responseText);c(null,e)}catch(t){c(null,JSON.parse(h.responseText))}},h.onerror=function(){c(h.statusText||"unknown error")},h.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(header_key in a)h.setRequestHeader(header_key,a[header_key]);h.send(f)}function o(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}var s=e("http"),a=e("https"),u=e("querystring");t.exports="browser"!==r.title?{request:n}:{request:i}}).call(this,e("_process"))},{_process:12,http:31,https:8,querystring:16}],95:[function(e,t,r){function n(e){if(0==e)return"";var t=Math.floor(62*Math.random())%62;return n(e-1)+i[t]}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.exports=n},{}],96:[function(e,t,r){function n(){}var i=e("./transporter");t.exports=n,n.format=function(e){var t="";e.params&&(e.value=e.params);try{t=i.decode(e.value)}catch(r){t=e.value}return{id:e.id,value:t?"string"==typeof t?JSON.parse(t):t:null,timestamp:e.timestamp}}},{"./transporter":106}],97:[function(e,t,r){function n(e,t){this.milkcocoa=e,this.idGenerator=e.idGenerator,this.path=t}var i=e("./streaming"),o=e("./streaming2"),s=e("./history"),a=e("./dataelement");t.exports=n,n.prototype.transporter=function(){return this.milkcocoa.transporter},n.prototype.push=function(e,t,r){var n=this;if(e instanceof Array)throw new Error("params must not be Array");if("object"!=typeof e)throw new Error("params must be object");this.idGenerator.getNextId(function(i,o){var s=n.milkcocoa.get_time();n.transporter().send_operation_request(n.path,"push",{id:o,ts:s,params:e},t,r)})},n.prototype.set=function(e,t,r,n){if("string"!=typeof e)throw new Error("id must be string");if(t instanceof Array)throw new Error("params must not be Array");if("object"!=typeof t)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"set",{path:this.path,id:e,params:t},r,n)},n.prototype.send=function(e,t,r){if("object"!=typeof e)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"send",{path:this.path,params:e},t,r)},n.prototype.remove=function(e,t,r){if("string"!=typeof e)throw new Error("id must be string");this.transporter().send_operation_request(this.path,"remove",{path:this.path,id:e},t,r)},n.prototype.get=function(e,t){if("string"!=typeof e)throw new Error("id must be string");this.transporter().call("get",{path:this.path,id:e},function(e,r){return r.err?void t(r.err):void t(null,a.format(r.content.d))})},n.prototype.get_many=function(e,t){this.transporter().call("get_many",{path:this.path,ids:JSON.stringify(e)},function(e,r){return r.err?void t(r.err):void t(null,r.content.d.map(a.format))})},n.prototype.count=function(e){e(new Error("deprecated"))},n.prototype.stream=function(){return new i(this.transporter(),this.path)},n.prototype.stream2=function(){return new o(this.transporter(),this.path)},n.prototype.history=function(){return new s(this.transporter(),this.path)},n.prototype.on=function(e,t){this.milkcocoa.listeners.add(e,this.path,t),this.transporter().on(this.path,e)},n.prototype.off=function(e){this.milkcocoa.listeners.del(e,this.path),this.transporter().off(this.path,e)},n.prototype.child=function(e){return new n(this.milkcocoa,this.path+"/"+e)}},{"./dataelement":96,"./history":98,"./streaming":104,"./streaming2":105}],98:[function(e,t,r){function n(e,t){this.stream=new i(e,t),this._times=1,this._limit=null,this._span=null,this.listeners={}}var i=e("./streaming2");n.prototype.sort=function(e){return this.stream.sort(e),this},n.prototype.size=function(e){return this.stream.size(e),this},n.prototype.times=function(e){return this._times=e,this},n.prototype.limit=function(e){return this._limit=e,this},n.prototype.span=function(e,t){return this._span={start:e,end:t},this},n.prototype.on=function(e,t){this.listeners[e]=t},n.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},n.prototype.runTimes=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e--,t.fire("data",n),void(e>0?t.runTimes(e):t.fire("end")))})},n.prototype.runLimit=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e-=n.length,0>e?"DESC"==t.stream.stream._sort?t.fire("data",n.slice(0,n.length+e)):t.fire("data",n.slice(0,n.length+e)):n.length>0&&t.fire("data",n),void(e>0&&n.length>0?t.runLimit(e):t.fire("end")))})},n.prototype.runSpan=function(e){var t=this;this.stream.next(function(r,n){if(r)return void t.fire("error",r);if("DESC"==t.stream.stream._sort)var i=function(t){return t.id>=e};else var i=function(t){return t.id<=e};var o=n.filter(i);o.length>0?(t.fire("data",o),t.runSpan(e)):t.fire("end")})},n.prototype.fire=function(e,t){this.listeners[e]&&this.listeners[e](t)},t.exports=n},{"./streaming2":105}],99:[function(e,t,r){(function(e){function r(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e%62,i=Math.floor(e/62);return 1>i?"":r(i)+t[n]}function n(){var t="ybfghijam6cpqdrw71nx34eo5suz0t9vkl28",n=(new Date).getTime(),i=n,o=null,s=[],a=0,u=1,c=a,f="0000";return{init:function(e){if(e&&"number"==typeof e){n=(new Date).getTime(),i=Math.floor(e/1e3);var t=r(i);f=t.substr(t.length-4)}},getHeader:function(e,t){var r=this,i=(new Date).getTime();if(o==i)setTimeout(function(){r.getHeader(e,t)},1);else{o=i;var s=i-n;t((e+s).toString(36))}},getNextId:function(e){s.push(e),c==a&&this._exec_getNextId()},_exec_getNextId:function(){var e=this,t=s.shift();t?(c=u,this._getNextId(function(r,n){t(r,n),e._exec_getNextId()})):c=a},_getNextId:function(r){function n(e){return 1>=e?t[Math.floor(36*Math.random())]:t[Math.floor(36*Math.random())]+n(e-1)}this.getHeader(i,function(t){var i=t+f+n(3);15!=i.length&&(e.console&&console.error("generated id is wrong.",i.length),i=i.substr(0,15)),r(null,i)})}}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(e,t,r){function n(){var e={push:{},set:{},remove:{},send:{}};return{add:function(t,r,n){e[t][r]||(e[t][r]=[]),e[t][r].push(n)},del:function(t,r){e[t][r]=[]},fire:function(t,r,n){e[t][r].forEach(function(e){e(n)})},get_subscribes:function(){var t=[];for(var r in e)for(var n in e[r])t.push({event:r,path:n});return t}}}t.exports=n},{}],101:[function(e,t,r){(function(e){t.exports="browser"!==e.title?{mode:!1,log:function(){this.mode&&console.log(arguments)},error:function(){this.mode&&console.error(arguments)}}:{mode:!1,log:function(){window.console&&this.mode&&console.log(arguments)},error:function(){window.console&&this.mode&&console.error(arguments)}}}).call(this,e("_process"))},{_process:12}],102:[function(e,t,r){(function(r){function n(e,t){if(this.host=e,this.option=t||{},this.file_path=this.option.file_path||"/var/lib/mlkcca",this.storage=new u(this.file_path),this.app_id=this.option.app_id||this.host.match(/([a-z0-9]+)\.mlkcca\.com/)[1],!this.app_id)throw new Error("app_id must be specified");this.option.clientId||(this.option.clientId="js"+this.app_id.substr(this.app_id.length-5)+c(16)),this.option.app_id=this.app_id,this.listeners=new o,this.idGenerator=new i,this.connect()}var i=e("./idgenerator"),o=e("./listeners"),s=e("./transporter"),a=e("./datastore"),u=(e("./logger"),e("./storage")),c=(e("./dataelement"),e("./clientid"));n.prototype.connect=function(e){function t(t){r.start_ts=(new Date).getTime(),r.idGenerator.init(t),r.server_ts=Math.floor(t/1e3),e&&e()}var r=this,n=null,i=this.storage.get("mlkcca_sid");i&&(n=i.sid),this.transporter=new s(this.host,this.option,n,t),this.transporter.onMessage(function(e){if(e.content.hasOwnProperty("params"))if("string"==typeof e.content.params)e.content.params=JSON.parse(e.content.params);else if("object"!=typeof e.content.params)throw new Error("unknown params");switch(e.event){case"push":r.listeners.fire("push",e.path,{id:e.content.id,path:e.path,value:e.content.params,timestamp:e.content.ts});break;case"set":r.listeners.fire("set",e.path,{id:e.content.id,path:e.path,value:e.content.params});break;case"remove":r.listeners.fire("remove",e.path,{id:e.content.id,path:e.path});break;case"send":r.listeners.fire("send",e.path,{path:e.path,value:e.content.params});break;case"success":console.log("success",e)}}),this.server_ts=(new Date).getTime(),this.start_ts=(new Date).getTime()},n.prototype.onConnected=function(e){this.transporter.onConnected(e);

},n.prototype.onClosed=function(e){this.transporter.onClosed(e)},n.prototype.onError=function(e){this.transporter.onError(e)},n.prototype.get_time=function(){var e=(new Date).getTime()-this.start_ts;return Math.floor(this.server_ts+e)},n.connectWithAuth=function(e,t,r){var i=r||{};i.token=t;var o=new n(e,i);return o.authWithToken(t,function(e){}),o},n.connectWithApiKey=function(e,t,r,i){var o=i||{};o.apikey=t,o.apisecret=r;var s=new n(e,o);return s},n.prototype.disconnect=function(e){this.transporter.disconnect(e)},n.prototype.reconnect=function(e){var t=this;this.transporter.disconnect(function(){t.connect(function(){t.listeners.get_subscribes().forEach(function(e){t.transporter.on(e.path,e.event)}),e&&e()})})},n.prototype.dataStore=function(e){if("string"!=typeof e)throw new Error("path must be string");return new a(this,e)},n.prototype.authWithToken=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginwithtoken",{token:e},function(e,n){return e?void t(e):n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.authAsAdmin=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginasadmin",{token:e},function(e,n){return n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.user=function(e){var t=this.storage.get("mlkcca_sid"),r={};t&&(r.mlkccasid=t.sid),this.transporter.auth_call("me",r,function(t,r){return r.err?void e(r.err):"notloggedin"==r.content.condition?void e(null,null):void e(r.err,r.content.account)})},n.prototype.getCurrentUser=function(e){this.user(e)},n.prototype.logout=function(e){var t=this,r=this.storage.get("mlkcca_sid"),n={};r&&(n.mlkccasid=r.sid),this.transporter.auth_call("logout",n,function(r){return r&&e?void e(r):void t.reconnect(e)})},"browser"!==r.title?t.exports=n:window.MilkCocoa=n}).call(this,e("_process"))},{"./clientid":95,"./dataelement":96,"./datastore":97,"./idgenerator":99,"./listeners":100,"./logger":101,"./storage":103,"./transporter":106,_process:12}],103:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r)^s;t.push(n.toString(36))}return t.join(",")}function i(e){var t=e.split(","),r="";return t.forEach(function(e){r+=String.fromCharCode(parseInt(e,36)^s)}),r}var o=e("./logger"),s=80,a=null;if("browser"!==r.title){var u=e("fs"),c=e("path");a=function(e){return{set:function(t,r){var i=c.join(e,t);u.writeFileSync(i,n(JSON.stringify(r)))},get:function(t){var r=c.join(e,t);if(!u.existsSync(r))return null;var n=u.readFileSync(r),s=null;try{s=JSON.parse(i(String(n)))}catch(a){o.error("parse error",a)}return s}}}}else a=function(){return{set:function(e,t){window.localStorage&&window.localStorage.setItem(e,n(JSON.stringify(t)))},get:function(e){if(!window.localStorage)return null;var t=window.localStorage.getItem(e),r=null;try{r=JSON.parse(i(t))}catch(n){o.error("parse error",n)}return r}}};t.exports=a}).call(this,e("_process"))},{"./logger":101,_process:12,fs:1,path:11}],104:[function(e,t,r){function n(e,t){this.transporter=e,this.path=t,this._current_id=null,this._size=50,this._sort="DESC",this.onData=null,this.onError=null}var i=e("./dataelement");t.exports=n,n.prototype.sort=n.prototype.order=function(e){return this._sort=e.toUpperCase(),this},n.prototype.size=n.prototype.limit=function(e){return e>999&&(e=999,window.console&&window.console.log("size too large")),this._size=e,this},n.prototype.onData=function(e){this.onData=e},n.prototype.onError=function(e){this.onError=e},n.prototype.next=function(e){return this.exec(e),this},n.prototype.setTimestamp=function(e){return this._current_id=e.toString(36),this},n.prototype.exec=function(e){var t=this,r={path:this.path,limit:this._size,sort:this._sort};this._current_id&&(r.th=this._current_id),this.transporter.call("query",r,function(r,n){if(r)return t.onError&&t.onError(n.err),void(e&&e(r,null));if(null!=n.err)return t.onError&&t.onError(n.err),void(e&&e(n.err,[]));var o=n.content.d.map(i.format);o=o.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),o.length>0&&(t._current_id="ASC"==t._sort?o[o.length-1].id:o[0].id),t.onData&&t.onData(o),e&&e(null,o)})}},{"./dataelement":96}],105:[function(e,t,r){function n(e,t){this.stream=new i(e,t)}var i=e("./streaming");n.prototype.sort=i.prototype.order=function(e){return this.stream.sort(e),this},n.prototype.size=i.prototype.limit=function(e){return this.stream.size(e),this},n.prototype.onData=function(e){this.stream.onData(e)},n.prototype.onError=function(e){this.stream.onError(e)},n.prototype.next=function(e){var t=this;return this.stream.next(function(r,n){null==r&&"DESC"==t.stream._sort?e(r,n.reverse()):e(r,n)}),this},n.prototype.setTimestamp=function(e){return this.stream.setTimestamp(e),this},t.exports=n},{"./streaming":104}],106:[function(e,t,r){(function(r){function n(e,t,n,s){function u(e){h._is_connected=!0,h.flush(),i.log("transporter:onopen",e),s&&s(e),h._onConnected&&h._onConnected()}function c(e){h._is_connected=!1,i.log("transporter:onclose",e),h._onClosed&&h._onClosed()}function f(e){i.log("transporter:onerror",e.message),h._onError&&h._onError(e)}function l(e,t){var r={};if(e==h.app_id+"/$sys/error"){var n=t.readUInt16BE(0),i=t.readUInt16BE(2);return void h.recvError(i,n)}try{r=JSON.parse(h.decode(t))}catch(o){r=JSON.parse(t)}var s=e.indexOf("/"),a=e.lastIndexOf("/"),u=e.substr(s+1,a-s-1),c=e.substr(a+1),f={path:u,event:c,content:r};h._onMessage(f)}var h=this;this.sid=n,this.queue=[],this.error_callbacks={},this.comp_callbacks={},this.request_id=1,this.app_id=t.app_id,this.host=e,this.port=t.port||443,this.http_port=t.http_port||443,this.useSSL=!0,this.qos=0;var p="s"+n||"dammy";t.token&&(p="j"+t.token),t.apikey&&t.apisecret&&(p="k"+t.apikey+":"+t.apisecret,this.apikey={key:t.apikey,secret:t.apisecret}),t.hasOwnProperty("qos")&&(this.qos=t.qos),t.hasOwnProperty("useSSL")&&(this.useSSL=t.useSSL);var d=(this.useSSL?"wss://":"ws://")+e+":"+this.port+"/websocket";"browser"!==r.title?(this.port=this.useSSL?8883:1883,d=(this.useSSL?"mqtts://":"mqtt://")+e+":"+this.port):o.isAndroidStandardBrowser()&&(d=(this.useSSL?"sockjss://":"sockjs://")+e+":"+this.port+"/sockjs"),this.client=a.connect(d,{username:p,clientId:t.clientId,password:t.app_id,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:7e3,clean:!1}),this.client.onConnectionLost=c,this.client.onMessageArrived=l,this.client.on("connect",u),this.client.on("close",c),this.client.on("error",f),this.client.on("message",l),this._is_connected=!1}var i=e("./logger"),o=e("./ua"),s=e("./ajax"),a=e("mqtt"),u=e("./dataelement");t.exports=n,n.prototype.encode=function(e){return e},n.decode=function(e){return decodeURIComponent(e)},n.prototype.decode=function(e){return n.decode(e)},n.prototype.onMessage=function(e){this._onMessage=e},n.prototype.onConnected=function(e){this._onConnected=e},n.prototype.onClosed=function(e){this._onClosed=e},n.prototype.onError=function(e){this._onError=e},n.prototype.auth_call=function(e,t,r){t.cmd=e,t.appid=this.app_id,s.request("POST",this.useSSL,this.host,this.http_port,"/auth",t,{},r)},n.prototype.call=function(e,t,r){t.api=e,t.appid=this.app_id;var n={};this.sid&&(n.Authorization="MLKCCASID "+this.sid),this.apikey&&(n.Authorization="MLKCCAKEY "+this.apikey.key+":"+this.apikey.secret),s.request("GET",this.useSSL,this.host,this.http_port,"/api",t,n,r)},n.prototype.on=function(e,t){this.send({type:"s",topic:this.create_topic(e,t)})},n.prototype.off=function(e,t){this.send({type:"u",topic:this.create_topic(e,t)})},n.prototype.send_operation_request=function(e,t,r,n,i){this.request_id++,this.request_id>12287&&(this.request_id=1),r.r=this.request_id,this.error_callbacks[this.request_id]=i,this.comp_callbacks[this.request_id]=n,this.send({type:"p",topic:this.create_topic(e,t),msg:JSON.stringify(r),request_id:this.request_id})},n.prototype.create_topic=function(e,t){return this.app_id+"/"+e+"/"+t},n.prototype.send=function(e){var t=this;t._is_connected?t.send_op(e):t.queue.push(e)},n.prototype.flush=function(){this.send_next()},n.prototype.send_next=function(){var e=this;if(e._is_connected){var t=e.queue.shift();t&&(e.send_op(t),e.send_next())}},n.prototype.send_op=function(e){var t=this;switch(e.type){case"p":var r=t.encode(e.msg);t.client.publish(e.topic,r,{qos:t.qos,retain:!1},function(r,n){t.recvComp(e.request_id,null,u.format(JSON.parse(e.msg)))});break;case"s":t.client.subscribe(e.topic,{qos:3==t.qos?0:t.qos});break;case"u":t.client.unsubscribe(e.topic)}},n.prototype.recvError=function(e,t){function r(e){switch(e){case 3:return"permission denied";default:return"unknown error"}}var n=r(t);this.error_callbacks[e]?(this.error_callbacks[e](n),delete this.error_callbacks[e]):this._onError&&this._onError(n)},n.prototype.recvComp=function(e,t,r){this.comp_callbacks[e]&&this.comp_callbacks[e](t,r),delete this.comp_callbacks[e]},n.prototype.disconnect=function(e){this.client.end(e)}}).call(this,e("_process"))},{"./ajax":94,"./dataelement":96,"./logger":101,"./ua":107,_process:12,mqtt:46}],107:[function(e,t,r){t.exports={isAndroidStandardBrowser:function(){var e=navigator.userAgent;return e.indexOf("Android")>=0&&e.indexOf("Chrome")<0&&e.indexOf("Firefox")<0?!0:e.indexOf("MSIE 10")>=0?!0:!1}}},{}]},{},[102]);","ﾂ�":"\\u008b","ﾂ�":"\\u008c","ﾂ�":"\\u008d","ﾂ�":"\\u008e","ﾂ�":"\\u008f","ﾂ�":"\\u0090","ﾂ�":"\\u0091","ﾂ�":"\\u0092","ﾂ�":"\\u0093","ﾂ�":"\\u0094","ﾂ�":"\\u0095","ﾂ�":"\\u0096","ﾂ�":"\\u0097","ﾂ�":"\\u0098","ﾂ�":"\\u0099","ﾂ�":"\\u009a","ﾂ�":"\\u009b","ﾂ�":"\\u009c","ﾂ�":"\\u009d","ﾂ�":"\\u009e","ﾂ�":"\\u009f","ﾂｭ":"\\u00ad","ﾘ":"\\u0600","ﾘ�":"\\u0601","ﾘ�":"\\u0602","ﾘ�":"\\u0603","ﾘ�":"\\u0604","ﾜ�":"\\u070f","癰ｴ":"\\u17b4","癰ｵ":"\\u17b5","窶�":"\\u200c","窶�":"\\u200d","窶�":"\\u200e","窶�":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","窶ｪ":"\\u202a","窶ｫ":"\\u202b","窶ｬ":"\\u202c","窶ｭ":"\\u202d","窶ｮ":"\\u202e","窶ｯ":"\\u202f","竅�":"\\u2060","竅｡":"\\u2061","竅｢":"\\u2062","竅｣":"\\u2063","竅､":"\\u2064","竅･":"\\u2065","竅ｦ":"\\u2066","竅ｧ":"\\u2067","竅ｨ":"\\u2068","竅ｩ":"\\u2069","竅ｪ":"\\u206a","竅ｫ":"\\u206b","竅ｬ":"\\u206c","竅ｭ":"\\u206d","竅ｮ":"\\u206e","竅ｯ":"\\u206f","\ufeff":"\\ufeff","�ｰ":"\\ufff0","�ｱ":"\\ufff1","�ｲ":"\\ufff2","�ｳ":"\\ufff3","�ｴ":"\\ufff4","�ｵ":"\\ufff5","�ｶ":"\\ufff6","�ｷ":"\\ufff7","�ｸ":"\\ufff8","�ｹ":"\\ufff9","�ｺ":"\\ufffa","�ｻ":"\\ufffb","�ｼ":"\\ufffc","�ｽ":"\\ufffd","�ｾ":"\\ufffe","�ｿ":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h=JSON&&JSON.stringify||function(e){
return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,r={},n=[];for(t=0;65536>t;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return r[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,r};r.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(u||(u=p(l)),t.replace(l,function(e){return u[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){for(var e={},t=0;t<d.length;t++){var r=d[t];e[r]=k[r]&&k[r].enabled()}return e},r.detectProtocols=function(e,t,r){var n={},i=[];t||(t=d);for(var o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}var a=function(e){var t=e.shift();n[t]?i.push(t):e.length>0&&a(e)};return r.websocket!==!1&&a(["websocket"]),n["xhr-streaming"]&&!r.null_origin?i.push("xhr-streaming"):!n["xdr-streaming"]||r.cookie_needed||r.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),n["xhr-polling"]&&!r.null_origin?i.push("xhr-polling"):!n["xdr-polling"]||r.cookie_needed||r.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";r.createHook=function(){var t="a"+r.random_string(8);if(!(g in e)){var n={};e[g]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return e[g](t)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.addEventListener(r,n,!1):(t.attachEvent("on"+r,n),e.attachEvent("on"+r,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.removeEventListener(r,n,!1):(t.detachEvent("on"+r,n),e.detachEvent("on"+r,n))};var m={},v=!1,b=function(){for(var e in m)m[e](),delete m[e]},_=function(){v||(v=!0,b())};r.attachEvent("unload",_),r.unload_add=function(e){var t=r.random_string(8);return m[t]=e,v&&r.delay(b),t},r.unload_del=function(e){e in m&&delete m[e]},r.createIframe=function(e,n){var i,o,s=t.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unload_del(o))},c=function(e){s&&(u(),n(e))},f=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),i=setTimeout(function(){c("timeout")},15e3),o=r.unload_add(u),{post:f,cleanup:u,loaded:a}},r.createHtmlfile=function(t,n){var i,o,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},f=function(){u&&(c(),r.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(e){u&&(f(),n(e))},h=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var p=u.createElement("div");return u.body.appendChild(p),s=u.createElement("iframe"),p.appendChild(s),s.src=t,i=setTimeout(function(){l("timeout")},15e3),o=r.unload_add(f),{post:h,cleanup:f,loaded:c}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(t,n,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=r.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,n,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var c in o.headers)s.xhr.setRequestHeader(c,o.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,r=e.responseText}catch(e){}1223===t&&(t=204),r&&r.length>0&&s.emit("chunk",t,r);break;case 4:var t=e.status;1223===t&&(t=204),s.emit("finish",t,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};S.prototype=new y;var E=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,n){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:B.enabled()?3:4};var k=function(t,n,i){if(this===e)return new k(t,n,i);var o,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&r.objectExtend(s._options,i),s._base_url=r.amendUrl(t),s._server=s._options.server||r.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?o=s._options.protocols_whitelist:(o="string"==typeof n&&n.length>0?[n]:r.isArray(n)?n:null,o&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=z(s._base_url),s._ir.onfinish=function(e,t){s._ir=null,e?(s._options.info&&(e=r.objectExtend(e,s._options.info)),s._options.rtt&&(t=s._options.rtt),s._applyInfo(e,t,o),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new n,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},k.prototype._dispatchOpen=function(){var e=this;e.readyState===k.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=k.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("message",{data:e}))},k.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},k.prototype._didClose=function(e,t,n){var o=this;if(o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN&&o.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:r.userSetCode(e)});if(!r.userSetCode(e)&&o.readyState===k.CONNECTING&&!n){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=k.CLOSED,r.delay(function(){o.dispatchEvent(s)})},k.prototype._didMessage=function(e){var t=this,r=e.slice(0,1);switch(r){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var i=n.protocol=n._protocols.shift();if(!i)return!1;if(k[i]&&k[i].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(i),n.protocol="waiting-for-load",r.attachEvent("load",function(){n._try_next_protocol()}),!0;if(k[i]&&k[i].enabled(n._options)){var o=k[i].roundTrips||1,s=(n._options.rto||0)*o||5e3;n._transport_tref=r.delay(s,function(){n.readyState===k.CONNECTING&&n._didClose(2007,"Transport timeouted")});var a=r.random_string(8),u=n._base_url+"/"+n._server+"/"+a;return n._debug("Opening transport:",i," url:"+u," RTO:"+n._options.rto),n._transport=new k[i](n,u,n._base_url),!0}n._debug("Skipping transport:",i)}},k.prototype.close=function(e,t){var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==k.CONNECTING&&n.readyState!==k.OPEN?!1:(n.readyState=k.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},k.prototype.send=function(e){var t=this;if(t.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===k.OPEN&&t._transport.doSend(r.quote(""+e)),!0},k.prototype._applyInfo=function(e,n,i){var o=this;o._options.info=e,o._options.rtt=n,o._options.rto=r.countRTO(n),o._options.info.null_origin=!t.domain;var s=r.probeProtocols();o._protocols=r.detectProtocols(s,i,e)};var x=k.websocket=function(t,n){var i=this,o=n+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=t,i.url=o;var s=e.WebSocket||e.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=r.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(e){this.ws.send("["+e+"]")},x.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var j=function(){};j.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},j.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},j.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},j.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,r){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+r):e.send_schedule_wait()}),e.send_buffer=[]}},j.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(e,n,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=t.createElement("form"),a=o._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+r.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=n}catch(l){r.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var h=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,r.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",i(!0))};return c.onerror=c.onload=h,c.onreadystatechange=function(e){"complete"==c.readyState&&h()},h},M=function(e){return function(t,r,n){var i=new e("POST",t+"/xhr_send",r);return i.onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},O=function(e,n){var i,o,s=t.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,n(e),n=null)},u=!1,c=null;if(s.id="a"+r.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){c||(c=setTimeout(function(){u||a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))o=t.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),o&&l.insertBefore(o,l.firstChild),a},R=k["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(I),n._schedule_recv()};R.prototype=new j,R.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",O,t)},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(t,n,i){var o="a"+r.random_string(6),s=t+"?c="+escape(a+"."+o),u=0,c=function(t){switch(u){case 0:delete e[a][o],i(t);break;case 1:i(t),u=2;break;case 2:delete e[a][o]}},f=n(s,c);e[a][o]=f;var l=function(){e[a][o]&&(u=1,e[a][o](r.closeFrame(1e3,"JSONP user aborted read")))};return l},T=function(){};T.prototype=new j,T.prototype.run=function(e,t,r,n,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(M(i)),o.poll=new V(e,n,t+r,i)},T.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var C=k["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XHRCorsObject)};C.prototype=new T,C.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},C.roundTrips=2,C.need_body=!0;var A=k["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XDRObject)};A.prototype=new T,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var U=k["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRCorsObject)};U.prototype=new T,U.enabled=C.enabled,U.roundTrips=2;var q=k["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XDRObject)};q.prototype=new T,q.enabled=A.enabled,q.roundTrips=2;var B=function(){};B.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},B.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},B.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var r=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(r===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([k.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},B.prototype.postMessage=function(e,t){var r=this;r.iframeObj.post(r.window_id+e+(t||""),r.origin)},B.prototype.doSend=function(e){this.postMessage("m",e)},B.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var N,P=function(t,n){parent!==e?parent.postMessage(N+t+(n||""),"*"):r.log("Can't postMessage, no parent window.",t,n)},D=function(){};D.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},D.prototype._didMessage=function(e){P("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},r.parent_origin=void 0,k.bootstrap_iframe=function(){var n;N=t.location.hash.slice(1);var i=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var i=t.data.slice(0,8),o=t.data.slice(8,9),s=t.data.slice(9);if(i===N)switch(o){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==k.version&&r.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+k.version+'".'),!r.flatUrl(f)||!r.flatUrl(l))return void r.log("Only basic urls are supported in SockJS");if(!r.isSameOriginUrl(f)||!r.isSameOriginUrl(l))return void r.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");n=new D,n._transport=new D[c](n,f,l);break;case"m":n._doSend(s);break;case"c":n&&n._doCleanup(),n=null}}};r.attachMessage(i),P("s")};var W=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};W.prototype=new o(["finish"]),W.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=r.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var r=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var H=function(e){var n=this,i=function(){var t=new B;t.protocol="w-iframe-info-receiver";var r=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var r=JSON.parse(e.substr(1)),i=r[0],o=r[1];n.emit("finish",i,o)}else n.emit("finish");t.doCleanup(),t=null},i={_options:{},_didClose:r,_didMessage:r};t.i_constructor(i,e,e)};t.body?i():r.attachEvent("load",i)};H.prototype=new o(["finish"]);var F=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new o(["finish"]);var z=function(e){if(r.isSameOriginUrl(e))return new W(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new W(e,r.XHRLocalObject);case 2:return new W(e,r.XDRObject);case 3:return new H(e);default:return new F}},J=D["w-iframe-info-receiver"]=function(e,t,n){var i=new W(n,r.XHRLocalObject);i.onfinish=function(t,r){e._didMessage("m"+JSON.stringify([t,r])),e._didClose()}};J.prototype.doCleanup=function(){};var X=k["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};X.prototype=new B,X.enabled=function(){return"EventSource"in e&&B.enabled()},X.need_body=!0,X.roundTrips=3;var G=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,r.XHRLocalObject)};G.prototype=new T;var K=k["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};K.prototype=new B,K.enabled=function(){return e.XMLHttpRequest&&B.enabled()},K.need_body=!0,K.roundTrips=3;var Y=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRLocalObject)};Y.prototype=new T;var Q=k["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new B,Q.enabled=function(){return B.enabled()},Q.need_body=!0,Q.roundTrips=3;var $=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",re,r.XHRLocalObject)};$.prototype=new T;var V=function(e,t,r,n){var i=this;i.ri=e,i.Receiver=t,i.recv_url=r,i.AjaxObject=n,i._scheduleRecv()};V.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),r=0;t.onmessage=function(t){r+=1,e.ri._didMessage(t.data)},t.onclose=function(r){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===r.reason?e.ri._didClose(1006,"Polling error ("+r.reason+")"):e._scheduleRecv())}},V.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,o){var s=o?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Z.prototype=new n,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var ee,te=function(){if(void 0===ee)if("ActiveXObject"in e)try{ee=!!new ActiveXObject("htmlfile")}catch(t){}else ee=!1;return ee},re=function(t){var n=this;r.polluteGlobalNamespace(),n.id="a"+r.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+n.id);var o,s=te()?r.createHtmlfile:r.createIframe;e[a][n.id]={start:function(){o.loaded()},message:function(e){n.dispatchEvent(new i("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,r){o.cleanup(),n.iframe_close=o=null,delete e[a][n.id],n.dispatchEvent(new i("close",{reason:r}))},o=s(t,function(e){n.iframe_close({},"permanent")})};re.prototype=new n,re.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var ne=function(e,t){var r=this,n=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(n),s=o.indexOf("\n");if(-1===s)break;n+=s+1;var a=o.slice(0,s);r.dispatchEvent(new i("message",{data:a}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null;var n=200===e?"network":"permanent";r.dispatchEvent(new i("close",{reason:n}))}};return ne.prototype=new n,ne.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},k.getUtils=function(){return r},k.getIframeTransport=function(){return B},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}],94:[function(e,t,r){(function(r){function n(e,t,r,n,i,o,c,f){function l(e){if(f){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){f(null,JSON.parse(t))})}}var h=t?a:s;c["Content-Type"]="application/x-www-form-urlencoded";var p={hostname:r,port:n||(t?443:80),path:i,method:e,headers:c};if("GET"==e){var d=u.stringify(o);p.path+="?"+d,h.get(p,l).on("error",function(e){f(e)})}else{var g=h.request(p,l);g.setTimeout(5e3),g.on("timeout",function(){f&&f(new Error("timed out"),null),g.abort()}),g.on("error",function(e){f&&f(e,null)});var d=u.stringify(o);g.write(d),g.end()}}function i(e,t,r,n,i,s,a,c){var f=u.stringify(s),l=(t?"https://":"http://")+r+":"+n+i;"GET"==e&&(l+="?"+f);var h=o(e,l);h.withCredentials=!0,h.onload=function(){decoded="";try{var e=JSON.parse(h.responseText);c(null,e)}catch(t){c(null,JSON.parse(h.responseText))}},h.onerror=function(){c(h.statusText||"unknown error")},h.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(header_key in a)h.setRequestHeader(header_key,a[header_key]);h.send(f)}function o(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}var s=e("http"),a=e("https"),u=e("querystring");t.exports="browser"!==r.title?{request:n}:{request:i}}).call(this,e("_process"))},{_process:12,http:31,https:8,querystring:16}],95:[function(e,t,r){function n(e){if(0==e)return"";var t=Math.floor(62*Math.random())%62;return n(e-1)+i[t]}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.exports=n},{}],96:[function(e,t,r){function n(){}var i=e("./transporter");t.exports=n,n.format=function(e){var t="";e.params&&(e.value=e.params);try{t=i.decode(e.value)}catch(r){t=e.value}return{id:e.id,value:t?"string"==typeof t?JSON.parse(t):t:null,timestamp:e.timestamp}}},{"./transporter":106}],97:[function(e,t,r){function n(e,t){this.milkcocoa=e,this.idGenerator=e.idGenerator,this.path=t}var i=e("./streaming"),o=e("./streaming2"),s=e("./history"),a=e("./dataelement");t.exports=n,n.prototype.transporter=function(){return this.milkcocoa.transporter},n.prototype.push=function(e,t,r){var n=this;if(e instanceof Array)throw new Error("params must not be Array");if("object"!=typeof e)throw new Error("params must be object");this.idGenerator.getNextId(function(i,o){var s=n.milkcocoa.get_time();n.transporter().send_operation_request(n.path,"push",{id:o,ts:s,params:e},t,r)})},n.prototype.set=function(e,t,r,n){if("string"!=typeof e)throw new Error("id must be string");if(t instanceof Array)throw new Error("params must not be Array");if("object"!=typeof t)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"set",{path:this.path,id:e,params:t},r,n)},n.prototype.send=function(e,t,r){if("object"!=typeof e)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"send",{path:this.path,params:e},t,r)},n.prototype.remove=function(e,t,r){if("string"!=typeof e)throw new Error("id must be string");this.transporter().send_operation_request(this.path,"remove",{path:this.path,id:e},t,r)},n.prototype.get=function(e,t){if("string"!=typeof e)throw new Error("id must be string");this.transporter().call("get",{path:this.path,id:e},function(e,r){return r.err?void t(r.err):void t(null,a.format(r.content.d))})},n.prototype.get_many=function(e,t){this.transporter().call("get_many",{path:this.path,ids:JSON.stringify(e)},function(e,r){return r.err?void t(r.err):void t(null,r.content.d.map(a.format))})},n.prototype.count=function(e){e(new Error("deprecated"))},n.prototype.stream=function(){return new i(this.transporter(),this.path)},n.prototype.stream2=function(){return new o(this.transporter(),this.path)},n.prototype.history=function(){return new s(this.transporter(),this.path)},n.prototype.on=function(e,t){this.milkcocoa.listeners.add(e,this.path,t),this.transporter().on(this.path,e)},n.prototype.off=function(e){this.milkcocoa.listeners.del(e,this.path),this.transporter().off(this.path,e)},n.prototype.child=function(e){return new n(this.milkcocoa,this.path+"/"+e)}},{"./dataelement":96,"./history":98,"./streaming":104,"./streaming2":105}],98:[function(e,t,r){function n(e,t){this.stream=new i(e,t),this._times=1,this._limit=null,this._span=null,this.listeners={}}var i=e("./streaming2");n.prototype.sort=function(e){return this.stream.sort(e),this},n.prototype.size=function(e){return this.stream.size(e),this},n.prototype.times=function(e){return this._times=e,this},n.prototype.limit=function(e){return this._limit=e,this},n.prototype.span=function(e,t){return this._span={start:e,end:t},this},n.prototype.on=function(e,t){this.listeners[e]=t},n.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},n.prototype.runTimes=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e--,t.fire("data",n),void(e>0?t.runTimes(e):t.fire("end")))})},n.prototype.runLimit=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e-=n.length,0>e?"DESC"==t.stream.stream._sort?t.fire("data",n.slice(0,n.length+e)):t.fire("data",n.slice(0,n.length+e)):n.length>0&&t.fire("data",n),void(e>0&&n.length>0?t.runLimit(e):t.fire("end")))})},n.prototype.runSpan=function(e){var t=this;this.stream.next(function(r,n){if(r)return void t.fire("error",r);if("DESC"==t.stream.stream._sort)var i=function(t){return t.id>=e};else var i=function(t){return t.id<=e};var o=n.filter(i);o.length>0?(t.fire("data",o),t.runSpan(e)):t.fire("end")})},n.prototype.fire=function(e,t){this.listeners[e]&&this.listeners[e](t)},t.exports=n},{"./streaming2":105}],99:[function(e,t,r){(function(e){function r(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e%62,i=Math.floor(e/62);return 1>i?"":r(i)+t[n]}function n(){var t="ybfghijam6cpqdrw71nx34eo5suz0t9vkl28",n=(new Date).getTime(),i=n,o=null,s=[],a=0,u=1,c=a,f="0000";return{init:function(e){if(e&&"number"==typeof e){n=(new Date).getTime(),i=Math.floor(e/1e3);var t=r(i);f=t.substr(t.length-4)}},getHeader:function(e,t){var r=this,i=(new Date).getTime();if(o==i)setTimeout(function(){r.getHeader(e,t)},1);else{o=i;var s=i-n;t((e+s).toString(36))}},getNextId:function(e){s.push(e),c==a&&this._exec_getNextId()},_exec_getNextId:function(){var e=this,t=s.shift();t?(c=u,this._getNextId(function(r,n){t(r,n),e._exec_getNextId()})):c=a},_getNextId:function(r){function n(e){return 1>=e?t[Math.floor(36*Math.random())]:t[Math.floor(36*Math.random())]+n(e-1)}this.getHeader(i,function(t){var i=t+f+n(3);15!=i.length&&(e.console&&console.error("generated id is wrong.",i.length),i=i.substr(0,15)),r(null,i)})}}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(e,t,r){function n(){var e={push:{},set:{},remove:{},send:{}};return{add:function(t,r,n){e[t][r]||(e[t][r]=[]),e[t][r].push(n)},del:function(t,r){e[t][r]=[]},fire:function(t,r,n){e[t][r].forEach(function(e){e(n)})},get_subscribes:function(){var t=[];for(var r in e)for(var n in e[r])t.push({event:r,path:n});return t}}}t.exports=n},{}],101:[function(e,t,r){(function(e){t.exports="browser"!==e.title?{mode:!1,log:function(){this.mode&&console.log(arguments)},error:function(){this.mode&&console.error(arguments)}}:{mode:!1,log:function(){window.console&&this.mode&&console.log(arguments)},error:function(){window.console&&this.mode&&console.error(arguments)}}}).call(this,e("_process"))},{_process:12}],102:[function(e,t,r){(function(r){function n(e,t){if(this.host=e,this.option=t||{},this.file_path=this.option.file_path||"/var/lib/mlkcca",this.storage=new u(this.file_path),this.app_id=this.option.app_id||this.host.match(/([a-z0-9]+)\.mlkcca\.com/)[1],!this.app_id)throw new Error("app_id must be specified");this.option.clientId||(this.option.clientId="js"+this.app_id.substr(this.app_id.length-5)+c(16)),this.option.app_id=this.app_id,this.listeners=new o,this.idGenerator=new i,this.connect()}var i=e("./idgenerator"),o=e("./listeners"),s=e("./transporter"),a=e("./datastore"),u=(e("./logger"),e("./storage")),c=(e("./dataelement"),e("./clientid"));n.prototype.connect=function(e){function t(t){r.start_ts=(new Date).getTime(),r.idGenerator.init(t),r.server_ts=Math.floor(t/1e3),e&&e()}var r=this,n=null,i=this.storage.get("mlkcca_sid");i&&(n=i.sid),this.transporter=new s(this.host,this.option,n,t),this.transporter.onMessage(function(e){if(e.content.hasOwnProperty("params"))if("string"==typeof e.content.params)e.content.params=JSON.parse(e.content.params);else if("object"!=typeof e.content.params)throw new Error("unknown params");switch(e.event){case"push":r.listeners.fire("push",e.path,{id:e.content.id,path:e.path,value:e.content.params,timestamp:e.content.ts});break;case"set":r.listeners.fire("set",e.path,{id:e.content.id,path:e.path,value:e.content.params});break;case"remove":r.listeners.fire("remove",e.path,{id:e.content.id,path:e.path});break;case"send":r.listeners.fire("send",e.path,{path:e.path,value:e.content.params});break;case"success":console.log("success",e)}}),this.server_ts=(new Date).getTime(),this.start_ts=(new Date).getTime()},n.prototype.onConnected=function(e){this.transporter.onConnected(e);

},n.prototype.onClosed=function(e){this.transporter.onClosed(e)},n.prototype.onError=function(e){this.transporter.onError(e)},n.prototype.get_time=function(){var e=(new Date).getTime()-this.start_ts;return Math.floor(this.server_ts+e)},n.connectWithAuth=function(e,t,r){var i=r||{};i.token=t;var o=new n(e,i);return o.authWithToken(t,function(e){}),o},n.connectWithApiKey=function(e,t,r,i){var o=i||{};o.apikey=t,o.apisecret=r;var s=new n(e,o);return s},n.prototype.disconnect=function(e){this.transporter.disconnect(e)},n.prototype.reconnect=function(e){var t=this;this.transporter.disconnect(function(){t.connect(function(){t.listeners.get_subscribes().forEach(function(e){t.transporter.on(e.path,e.event)}),e&&e()})})},n.prototype.dataStore=function(e){if("string"!=typeof e)throw new Error("path must be string");return new a(this,e)},n.prototype.authWithToken=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginwithtoken",{token:e},function(e,n){return e?void t(e):n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.authAsAdmin=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginasadmin",{token:e},function(e,n){return n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.user=function(e){var t=this.storage.get("mlkcca_sid"),r={};t&&(r.mlkccasid=t.sid),this.transporter.auth_call("me",r,function(t,r){return r.err?void e(r.err):"notloggedin"==r.content.condition?void e(null,null):void e(r.err,r.content.account)})},n.prototype.getCurrentUser=function(e){this.user(e)},n.prototype.logout=function(e){var t=this,r=this.storage.get("mlkcca_sid"),n={};r&&(n.mlkccasid=r.sid),this.transporter.auth_call("logout",n,function(r){return r&&e?void e(r):void t.reconnect(e)})},"browser"!==r.title?t.exports=n:window.MilkCocoa=n}).call(this,e("_process"))},{"./clientid":95,"./dataelement":96,"./datastore":97,"./idgenerator":99,"./listeners":100,"./logger":101,"./storage":103,"./transporter":106,_process:12}],103:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r)^s;t.push(n.toString(36))}return t.join(",")}function i(e){var t=e.split(","),r="";return t.forEach(function(e){r+=String.fromCharCode(parseInt(e,36)^s)}),r}var o=e("./logger"),s=80,a=null;if("browser"!==r.title){var u=e("fs"),c=e("path");a=function(e){return{set:function(t,r){var i=c.join(e,t);u.writeFileSync(i,n(JSON.stringify(r)))},get:function(t){var r=c.join(e,t);if(!u.existsSync(r))return null;var n=u.readFileSync(r),s=null;try{s=JSON.parse(i(String(n)))}catch(a){o.error("parse error",a)}return s}}}}else a=function(){return{set:function(e,t){window.localStorage&&window.localStorage.setItem(e,n(JSON.stringify(t)))},get:function(e){if(!window.localStorage)return null;var t=window.localStorage.getItem(e),r=null;try{r=JSON.parse(i(t))}catch(n){o.error("parse error",n)}return r}}};t.exports=a}).call(this,e("_process"))},{"./logger":101,_process:12,fs:1,path:11}],104:[function(e,t,r){function n(e,t){this.transporter=e,this.path=t,this._current_id=null,this._size=50,this._sort="DESC",this.onData=null,this.onError=null}var i=e("./dataelement");t.exports=n,n.prototype.sort=n.prototype.order=function(e){return this._sort=e.toUpperCase(),this},n.prototype.size=n.prototype.limit=function(e){return e>999&&(e=999,window.console&&window.console.log("size too large")),this._size=e,this},n.prototype.onData=function(e){this.onData=e},n.prototype.onError=function(e){this.onError=e},n.prototype.next=function(e){return this.exec(e),this},n.prototype.setTimestamp=function(e){return this._current_id=e.toString(36),this},n.prototype.exec=function(e){var t=this,r={path:this.path,limit:this._size,sort:this._sort};this._current_id&&(r.th=this._current_id),this.transporter.call("query",r,function(r,n){if(r)return t.onError&&t.onError(n.err),void(e&&e(r,null));if(null!=n.err)return t.onError&&t.onError(n.err),void(e&&e(n.err,[]));var o=n.content.d.map(i.format);o=o.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),o.length>0&&(t._current_id="ASC"==t._sort?o[o.length-1].id:o[0].id),t.onData&&t.onData(o),e&&e(null,o)})}},{"./dataelement":96}],105:[function(e,t,r){function n(e,t){this.stream=new i(e,t)}var i=e("./streaming");n.prototype.sort=i.prototype.order=function(e){return this.stream.sort(e),this},n.prototype.size=i.prototype.limit=function(e){return this.stream.size(e),this},n.prototype.onData=function(e){this.stream.onData(e)},n.prototype.onError=function(e){this.stream.onError(e)},n.prototype.next=function(e){var t=this;return this.stream.next(function(r,n){null==r&&"DESC"==t.stream._sort?e(r,n.reverse()):e(r,n)}),this},n.prototype.setTimestamp=function(e){return this.stream.setTimestamp(e),this},t.exports=n},{"./streaming":104}],106:[function(e,t,r){(function(r){function n(e,t,n,s){function u(e){h._is_connected=!0,h.flush(),i.log("transporter:onopen",e),s&&s(e),h._onConnected&&h._onConnected()}function c(e){h._is_connected=!1,i.log("transporter:onclose",e),h._onClosed&&h._onClosed()}function f(e){i.log("transporter:onerror",e.message),h._onError&&h._onError(e)}function l(e,t){var r={};if(e==h.app_id+"/$sys/error"){var n=t.readUInt16BE(0),i=t.readUInt16BE(2);return void h.recvError(i,n)}try{r=JSON.parse(h.decode(t))}catch(o){r=JSON.parse(t)}var s=e.indexOf("/"),a=e.lastIndexOf("/"),u=e.substr(s+1,a-s-1),c=e.substr(a+1),f={path:u,event:c,content:r};h._onMessage(f)}var h=this;this.sid=n,this.queue=[],this.error_callbacks={},this.comp_callbacks={},this.request_id=1,this.app_id=t.app_id,this.host=e,this.port=t.port||443,this.http_port=t.http_port||443,this.useSSL=!0,this.qos=0;var p="s"+n||"dammy";t.token&&(p="j"+t.token),t.apikey&&t.apisecret&&(p="k"+t.apikey+":"+t.apisecret,this.apikey={key:t.apikey,secret:t.apisecret}),t.hasOwnProperty("qos")&&(this.qos=t.qos),t.hasOwnProperty("useSSL")&&(this.useSSL=t.useSSL);var d=(this.useSSL?"wss://":"ws://")+e+":"+this.port+"/websocket";"browser"!==r.title?(this.port=this.useSSL?8883:1883,d=(this.useSSL?"mqtts://":"mqtt://")+e+":"+this.port):o.isAndroidStandardBrowser()&&(d=(this.useSSL?"sockjss://":"sockjs://")+e+":"+this.port+"/sockjs"),this.client=a.connect(d,{username:p,clientId:t.clientId,password:t.app_id,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:7e3,clean:!1}),this.client.onConnectionLost=c,this.client.onMessageArrived=l,this.client.on("connect",u),this.client.on("close",c),this.client.on("error",f),this.client.on("message",l),this._is_connected=!1}var i=e("./logger"),o=e("./ua"),s=e("./ajax"),a=e("mqtt"),u=e("./dataelement");t.exports=n,n.prototype.encode=function(e){return e},n.decode=function(e){return decodeURIComponent(e)},n.prototype.decode=function(e){return n.decode(e)},n.prototype.onMessage=function(e){this._onMessage=e},n.prototype.onConnected=function(e){this._onConnected=e},n.prototype.onClosed=function(e){this._onClosed=e},n.prototype.onError=function(e){this._onError=e},n.prototype.auth_call=function(e,t,r){t.cmd=e,t.appid=this.app_id,s.request("POST",this.useSSL,this.host,this.http_port,"/auth",t,{},r)},n.prototype.call=function(e,t,r){t.api=e,t.appid=this.app_id;var n={};this.sid&&(n.Authorization="MLKCCASID "+this.sid),this.apikey&&(n.Authorization="MLKCCAKEY "+this.apikey.key+":"+this.apikey.secret),s.request("GET",this.useSSL,this.host,this.http_port,"/api",t,n,r)},n.prototype.on=function(e,t){this.send({type:"s",topic:this.create_topic(e,t)})},n.prototype.off=function(e,t){this.send({type:"u",topic:this.create_topic(e,t)})},n.prototype.send_operation_request=function(e,t,r,n,i){this.request_id++,this.request_id>12287&&(this.request_id=1),r.r=this.request_id,this.error_callbacks[this.request_id]=i,this.comp_callbacks[this.request_id]=n,this.send({type:"p",topic:this.create_topic(e,t),msg:JSON.stringify(r),request_id:this.request_id})},n.prototype.create_topic=function(e,t){return this.app_id+"/"+e+"/"+t},n.prototype.send=function(e){var t=this;t._is_connected?t.send_op(e):t.queue.push(e)},n.prototype.flush=function(){this.send_next()},n.prototype.send_next=function(){var e=this;if(e._is_connected){var t=e.queue.shift();t&&(e.send_op(t),e.send_next())}},n.prototype.send_op=function(e){var t=this;switch(e.type){case"p":var r=t.encode(e.msg);t.client.publish(e.topic,r,{qos:t.qos,retain:!1},function(r,n){t.recvComp(e.request_id,null,u.format(JSON.parse(e.msg)))});break;case"s":t.client.subscribe(e.topic,{qos:3==t.qos?0:t.qos});break;case"u":t.client.unsubscribe(e.topic)}},n.prototype.recvError=function(e,t){function r(e){switch(e){case 3:return"permission denied";default:return"unknown error"}}var n=r(t);this.error_callbacks[e]?(this.error_callbacks[e](n),delete this.error_callbacks[e]):this._onError&&this._onError(n)},n.prototype.recvComp=function(e,t,r){this.comp_callbacks[e]&&this.comp_callbacks[e](t,r),delete this.comp_callbacks[e]},n.prototype.disconnect=function(e){this.client.end(e)}}).call(this,e("_process"))},{"./ajax":94,"./dataelement":96,"./logger":101,"./ua":107,_process:12,mqtt:46}],107:[function(e,t,r){t.exports={isAndroidStandardBrowser:function(){var e=navigator.userAgent;return e.indexOf("Android")>=0&&e.indexOf("Chrome")<0&&e.indexOf("Firefox")<0?!0:e.indexOf("MSIE 10")>=0?!0:!1}}},{}]},{},[102]);","ﾂ�":"\\u008b","ﾂ�":"\\u008c","ﾂ�":"\\u008d","ﾂ�":"\\u008e","ﾂ�":"\\u008f","ﾂ�":"\\u0090","ﾂ�":"\\u0091","ﾂ�":"\\u0092","ﾂ�":"\\u0093","ﾂ�":"\\u0094","ﾂ�":"\\u0095","ﾂ�":"\\u0096","ﾂ�":"\\u0097","ﾂ�":"\\u0098","ﾂ�":"\\u0099","ﾂ�":"\\u009a","ﾂ�":"\\u009b","ﾂ�":"\\u009c","ﾂ�":"\\u009d","ﾂ�":"\\u009e","ﾂ�":"\\u009f","ﾂｭ":"\\u00ad","ﾘ":"\\u0600","ﾘ�":"\\u0601","ﾘ�":"\\u0602","ﾘ�":"\\u0603","ﾘ�":"\\u0604","ﾜ�":"\\u070f","癰ｴ":"\\u17b4","癰ｵ":"\\u17b5","窶�":"\\u200c","窶�":"\\u200d","窶�":"\\u200e","窶�":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","窶ｪ":"\\u202a","窶ｫ":"\\u202b","窶ｬ":"\\u202c","窶ｭ":"\\u202d","窶ｮ":"\\u202e","窶ｯ":"\\u202f","竅�":"\\u2060","竅｡":"\\u2061","竅｢":"\\u2062","竅｣":"\\u2063","竅､":"\\u2064","竅･":"\\u2065","竅ｦ":"\\u2066","竅ｧ":"\\u2067","竅ｨ":"\\u2068","竅ｩ":"\\u2069","竅ｪ":"\\u206a","竅ｫ":"\\u206b","竅ｬ":"\\u206c","竅ｭ":"\\u206d","竅ｮ":"\\u206e","竅ｯ":"\\u206f","\ufeff":"\\ufeff","�ｰ":"\\ufff0","�ｱ":"\\ufff1","�ｲ":"\\ufff2","�ｳ":"\\ufff3","�ｴ":"\\ufff4","�ｵ":"\\ufff5","�ｶ":"\\ufff6","�ｷ":"\\ufff7","�ｸ":"\\ufff8","�ｹ":"\\ufff9","�ｺ":"\\ufffa","�ｻ":"\\ufffb","�ｼ":"\\ufffc","�ｽ":"\\ufffd","�ｾ":"\\ufffe","�ｿ":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h=JSON&&JSON.stringify||function(e){
return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,r={},n=[];for(t=0;65536>t;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return r[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,r};r.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(u||(u=p(l)),t.replace(l,function(e){return u[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){for(var e={},t=0;t<d.length;t++){var r=d[t];e[r]=k[r]&&k[r].enabled()}return e},r.detectProtocols=function(e,t,r){var n={},i=[];t||(t=d);for(var o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}var a=function(e){var t=e.shift();n[t]?i.push(t):e.length>0&&a(e)};return r.websocket!==!1&&a(["websocket"]),n["xhr-streaming"]&&!r.null_origin?i.push("xhr-streaming"):!n["xdr-streaming"]||r.cookie_needed||r.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),n["xhr-polling"]&&!r.null_origin?i.push("xhr-polling"):!n["xdr-polling"]||r.cookie_needed||r.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";r.createHook=function(){var t="a"+r.random_string(8);if(!(g in e)){var n={};e[g]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return e[g](t)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.addEventListener(r,n,!1):(t.attachEvent("on"+r,n),e.attachEvent("on"+r,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.removeEventListener(r,n,!1):(t.detachEvent("on"+r,n),e.detachEvent("on"+r,n))};var m={},v=!1,b=function(){for(var e in m)m[e](),delete m[e]},_=function(){v||(v=!0,b())};r.attachEvent("unload",_),r.unload_add=function(e){var t=r.random_string(8);return m[t]=e,v&&r.delay(b),t},r.unload_del=function(e){e in m&&delete m[e]},r.createIframe=function(e,n){var i,o,s=t.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unload_del(o))},c=function(e){s&&(u(),n(e))},f=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),i=setTimeout(function(){c("timeout")},15e3),o=r.unload_add(u),{post:f,cleanup:u,loaded:a}},r.createHtmlfile=function(t,n){var i,o,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},f=function(){u&&(c(),r.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(e){u&&(f(),n(e))},h=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var p=u.createElement("div");return u.body.appendChild(p),s=u.createElement("iframe"),p.appendChild(s),s.src=t,i=setTimeout(function(){l("timeout")},15e3),o=r.unload_add(f),{post:h,cleanup:f,loaded:c}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(t,n,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=r.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,n,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var c in o.headers)s.xhr.setRequestHeader(c,o.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,r=e.responseText}catch(e){}1223===t&&(t=204),r&&r.length>0&&s.emit("chunk",t,r);break;case 4:var t=e.status;1223===t&&(t=204),s.emit("finish",t,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};S.prototype=new y;var E=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,n){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:B.enabled()?3:4};var k=function(t,n,i){if(this===e)return new k(t,n,i);var o,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&r.objectExtend(s._options,i),s._base_url=r.amendUrl(t),s._server=s._options.server||r.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?o=s._options.protocols_whitelist:(o="string"==typeof n&&n.length>0?[n]:r.isArray(n)?n:null,o&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=z(s._base_url),s._ir.onfinish=function(e,t){s._ir=null,e?(s._options.info&&(e=r.objectExtend(e,s._options.info)),s._options.rtt&&(t=s._options.rtt),s._applyInfo(e,t,o),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new n,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},k.prototype._dispatchOpen=function(){var e=this;e.readyState===k.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=k.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("message",{data:e}))},k.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},k.prototype._didClose=function(e,t,n){var o=this;if(o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN&&o.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:r.userSetCode(e)});if(!r.userSetCode(e)&&o.readyState===k.CONNECTING&&!n){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=k.CLOSED,r.delay(function(){o.dispatchEvent(s)})},k.prototype._didMessage=function(e){var t=this,r=e.slice(0,1);switch(r){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var i=n.protocol=n._protocols.shift();if(!i)return!1;if(k[i]&&k[i].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(i),n.protocol="waiting-for-load",r.attachEvent("load",function(){n._try_next_protocol()}),!0;if(k[i]&&k[i].enabled(n._options)){var o=k[i].roundTrips||1,s=(n._options.rto||0)*o||5e3;n._transport_tref=r.delay(s,function(){n.readyState===k.CONNECTING&&n._didClose(2007,"Transport timeouted")});var a=r.random_string(8),u=n._base_url+"/"+n._server+"/"+a;return n._debug("Opening transport:",i," url:"+u," RTO:"+n._options.rto),n._transport=new k[i](n,u,n._base_url),!0}n._debug("Skipping transport:",i)}},k.prototype.close=function(e,t){var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==k.CONNECTING&&n.readyState!==k.OPEN?!1:(n.readyState=k.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},k.prototype.send=function(e){var t=this;if(t.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===k.OPEN&&t._transport.doSend(r.quote(""+e)),!0},k.prototype._applyInfo=function(e,n,i){var o=this;o._options.info=e,o._options.rtt=n,o._options.rto=r.countRTO(n),o._options.info.null_origin=!t.domain;var s=r.probeProtocols();o._protocols=r.detectProtocols(s,i,e)};var x=k.websocket=function(t,n){var i=this,o=n+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=t,i.url=o;var s=e.WebSocket||e.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=r.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(e){this.ws.send("["+e+"]")},x.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var j=function(){};j.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},j.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},j.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},j.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,r){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+r):e.send_schedule_wait()}),e.send_buffer=[]}},j.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(e,n,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=t.createElement("form"),a=o._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+r.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=n}catch(l){r.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var h=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,r.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",i(!0))};return c.onerror=c.onload=h,c.onreadystatechange=function(e){"complete"==c.readyState&&h()},h},M=function(e){return function(t,r,n){var i=new e("POST",t+"/xhr_send",r);return i.onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},O=function(e,n){var i,o,s=t.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,n(e),n=null)},u=!1,c=null;if(s.id="a"+r.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){c||(c=setTimeout(function(){u||a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))o=t.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),o&&l.insertBefore(o,l.firstChild),a},R=k["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(I),n._schedule_recv()};R.prototype=new j,R.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",O,t)},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(t,n,i){var o="a"+r.random_string(6),s=t+"?c="+escape(a+"."+o),u=0,c=function(t){switch(u){case 0:delete e[a][o],i(t);break;case 1:i(t),u=2;break;case 2:delete e[a][o]}},f=n(s,c);e[a][o]=f;var l=function(){e[a][o]&&(u=1,e[a][o](r.closeFrame(1e3,"JSONP user aborted read")))};return l},T=function(){};T.prototype=new j,T.prototype.run=function(e,t,r,n,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(M(i)),o.poll=new V(e,n,t+r,i)},T.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var C=k["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XHRCorsObject)};C.prototype=new T,C.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},C.roundTrips=2,C.need_body=!0;var A=k["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XDRObject)};A.prototype=new T,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var U=k["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRCorsObject)};U.prototype=new T,U.enabled=C.enabled,U.roundTrips=2;var q=k["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XDRObject)};q.prototype=new T,q.enabled=A.enabled,q.roundTrips=2;var B=function(){};B.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},B.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},B.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var r=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(r===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([k.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},B.prototype.postMessage=function(e,t){var r=this;r.iframeObj.post(r.window_id+e+(t||""),r.origin)},B.prototype.doSend=function(e){this.postMessage("m",e)},B.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var N,P=function(t,n){parent!==e?parent.postMessage(N+t+(n||""),"*"):r.log("Can't postMessage, no parent window.",t,n)},D=function(){};D.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},D.prototype._didMessage=function(e){P("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},r.parent_origin=void 0,k.bootstrap_iframe=function(){var n;N=t.location.hash.slice(1);var i=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var i=t.data.slice(0,8),o=t.data.slice(8,9),s=t.data.slice(9);if(i===N)switch(o){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==k.version&&r.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+k.version+'".'),!r.flatUrl(f)||!r.flatUrl(l))return void r.log("Only basic urls are supported in SockJS");if(!r.isSameOriginUrl(f)||!r.isSameOriginUrl(l))return void r.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");n=new D,n._transport=new D[c](n,f,l);break;case"m":n._doSend(s);break;case"c":n&&n._doCleanup(),n=null}}};r.attachMessage(i),P("s")};var W=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};W.prototype=new o(["finish"]),W.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=r.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var r=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var H=function(e){var n=this,i=function(){var t=new B;t.protocol="w-iframe-info-receiver";var r=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var r=JSON.parse(e.substr(1)),i=r[0],o=r[1];n.emit("finish",i,o)}else n.emit("finish");t.doCleanup(),t=null},i={_options:{},_didClose:r,_didMessage:r};t.i_constructor(i,e,e)};t.body?i():r.attachEvent("load",i)};H.prototype=new o(["finish"]);var F=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new o(["finish"]);var z=function(e){if(r.isSameOriginUrl(e))return new W(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new W(e,r.XHRLocalObject);case 2:return new W(e,r.XDRObject);case 3:return new H(e);default:return new F}},J=D["w-iframe-info-receiver"]=function(e,t,n){var i=new W(n,r.XHRLocalObject);i.onfinish=function(t,r){e._didMessage("m"+JSON.stringify([t,r])),e._didClose()}};J.prototype.doCleanup=function(){};var X=k["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};X.prototype=new B,X.enabled=function(){return"EventSource"in e&&B.enabled()},X.need_body=!0,X.roundTrips=3;var G=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,r.XHRLocalObject)};G.prototype=new T;var K=k["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};K.prototype=new B,K.enabled=function(){return e.XMLHttpRequest&&B.enabled()},K.need_body=!0,K.roundTrips=3;var Y=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRLocalObject)};Y.prototype=new T;var Q=k["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new B,Q.enabled=function(){return B.enabled()},Q.need_body=!0,Q.roundTrips=3;var $=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",re,r.XHRLocalObject)};$.prototype=new T;var V=function(e,t,r,n){var i=this;i.ri=e,i.Receiver=t,i.recv_url=r,i.AjaxObject=n,i._scheduleRecv()};V.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),r=0;t.onmessage=function(t){r+=1,e.ri._didMessage(t.data)},t.onclose=function(r){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===r.reason?e.ri._didClose(1006,"Polling error ("+r.reason+")"):e._scheduleRecv())}},V.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,o){var s=o?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Z.prototype=new n,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var ee,te=function(){if(void 0===ee)if("ActiveXObject"in e)try{ee=!!new ActiveXObject("htmlfile")}catch(t){}else ee=!1;return ee},re=function(t){var n=this;r.polluteGlobalNamespace(),n.id="a"+r.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+n.id);var o,s=te()?r.createHtmlfile:r.createIframe;e[a][n.id]={start:function(){o.loaded()},message:function(e){n.dispatchEvent(new i("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,r){o.cleanup(),n.iframe_close=o=null,delete e[a][n.id],n.dispatchEvent(new i("close",{reason:r}))},o=s(t,function(e){n.iframe_close({},"permanent")})};re.prototype=new n,re.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var ne=function(e,t){var r=this,n=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(n),s=o.indexOf("\n");if(-1===s)break;n+=s+1;var a=o.slice(0,s);r.dispatchEvent(new i("message",{data:a}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null;var n=200===e?"network":"permanent";r.dispatchEvent(new i("close",{reason:n}))}};return ne.prototype=new n,ne.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},k.getUtils=function(){return r},k.getIframeTransport=function(){return B},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}],94:[function(e,t,r){(function(r){function n(e,t,r,n,i,o,c,f){function l(e){if(f){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){f(null,JSON.parse(t))})}}var h=t?a:s;c["Content-Type"]="application/x-www-form-urlencoded";var p={hostname:r,port:n||(t?443:80),path:i,method:e,headers:c};if("GET"==e){var d=u.stringify(o);p.path+="?"+d,h.get(p,l).on("error",function(e){f(e)})}else{var g=h.request(p,l);g.setTimeout(5e3),g.on("timeout",function(){f&&f(new Error("timed out"),null),g.abort()}),g.on("error",function(e){f&&f(e,null)});var d=u.stringify(o);g.write(d),g.end()}}function i(e,t,r,n,i,s,a,c){var f=u.stringify(s),l=(t?"https://":"http://")+r+":"+n+i;"GET"==e&&(l+="?"+f);var h=o(e,l);h.withCredentials=!0,h.onload=function(){decoded="";try{var e=JSON.parse(h.responseText);c(null,e)}catch(t){c(null,JSON.parse(h.responseText))}},h.onerror=function(){c(h.statusText||"unknown error")},h.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(header_key in a)h.setRequestHeader(header_key,a[header_key]);h.send(f)}function o(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}var s=e("http"),a=e("https"),u=e("querystring");t.exports="browser"!==r.title?{request:n}:{request:i}}).call(this,e("_process"))},{_process:12,http:31,https:8,querystring:16}],95:[function(e,t,r){function n(e){if(0==e)return"";var t=Math.floor(62*Math.random())%62;return n(e-1)+i[t]}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.exports=n},{}],96:[function(e,t,r){function n(){}var i=e("./transporter");t.exports=n,n.format=function(e){var t="";e.params&&(e.value=e.params);try{t=i.decode(e.value)}catch(r){t=e.value}return{id:e.id,value:t?"string"==typeof t?JSON.parse(t):t:null,timestamp:e.timestamp}}},{"./transporter":106}],97:[function(e,t,r){function n(e,t){this.milkcocoa=e,this.idGenerator=e.idGenerator,this.path=t}var i=e("./streaming"),o=e("./streaming2"),s=e("./history"),a=e("./dataelement");t.exports=n,n.prototype.transporter=function(){return this.milkcocoa.transporter},n.prototype.push=function(e,t,r){var n=this;if(e instanceof Array)throw new Error("params must not be Array");if("object"!=typeof e)throw new Error("params must be object");this.idGenerator.getNextId(function(i,o){var s=n.milkcocoa.get_time();n.transporter().send_operation_request(n.path,"push",{id:o,ts:s,params:e},t,r)})},n.prototype.set=function(e,t,r,n){if("string"!=typeof e)throw new Error("id must be string");if(t instanceof Array)throw new Error("params must not be Array");if("object"!=typeof t)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"set",{path:this.path,id:e,params:t},r,n)},n.prototype.send=function(e,t,r){if("object"!=typeof e)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"send",{path:this.path,params:e},t,r)},n.prototype.remove=function(e,t,r){if("string"!=typeof e)throw new Error("id must be string");this.transporter().send_operation_request(this.path,"remove",{path:this.path,id:e},t,r)},n.prototype.get=function(e,t){if("string"!=typeof e)throw new Error("id must be string");this.transporter().call("get",{path:this.path,id:e},function(e,r){return r.err?void t(r.err):void t(null,a.format(r.content.d))})},n.prototype.get_many=function(e,t){this.transporter().call("get_many",{path:this.path,ids:JSON.stringify(e)},function(e,r){return r.err?void t(r.err):void t(null,r.content.d.map(a.format))})},n.prototype.count=function(e){e(new Error("deprecated"))},n.prototype.stream=function(){return new i(this.transporter(),this.path)},n.prototype.stream2=function(){return new o(this.transporter(),this.path)},n.prototype.history=function(){return new s(this.transporter(),this.path)},n.prototype.on=function(e,t){this.milkcocoa.listeners.add(e,this.path,t),this.transporter().on(this.path,e)},n.prototype.off=function(e){this.milkcocoa.listeners.del(e,this.path),this.transporter().off(this.path,e)},n.prototype.child=function(e){return new n(this.milkcocoa,this.path+"/"+e)}},{"./dataelement":96,"./history":98,"./streaming":104,"./streaming2":105}],98:[function(e,t,r){function n(e,t){this.stream=new i(e,t),this._times=1,this._limit=null,this._span=null,this.listeners={}}var i=e("./streaming2");n.prototype.sort=function(e){return this.stream.sort(e),this},n.prototype.size=function(e){return this.stream.size(e),this},n.prototype.times=function(e){return this._times=e,this},n.prototype.limit=function(e){return this._limit=e,this},n.prototype.span=function(e,t){return this._span={start:e,end:t},this},n.prototype.on=function(e,t){this.listeners[e]=t},n.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},n.prototype.runTimes=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e--,t.fire("data",n),void(e>0?t.runTimes(e):t.fire("end")))})},n.prototype.runLimit=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e-=n.length,0>e?"DESC"==t.stream.stream._sort?t.fire("data",n.slice(0,n.length+e)):t.fire("data",n.slice(0,n.length+e)):n.length>0&&t.fire("data",n),void(e>0&&n.length>0?t.runLimit(e):t.fire("end")))})},n.prototype.runSpan=function(e){var t=this;this.stream.next(function(r,n){if(r)return void t.fire("error",r);if("DESC"==t.stream.stream._sort)var i=function(t){return t.id>=e};else var i=function(t){return t.id<=e};var o=n.filter(i);o.length>0?(t.fire("data",o),t.runSpan(e)):t.fire("end")})},n.prototype.fire=function(e,t){this.listeners[e]&&this.listeners[e](t)},t.exports=n},{"./streaming2":105}],99:[function(e,t,r){(function(e){function r(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e%62,i=Math.floor(e/62);return 1>i?"":r(i)+t[n]}function n(){var t="ybfghijam6cpqdrw71nx34eo5suz0t9vkl28",n=(new Date).getTime(),i=n,o=null,s=[],a=0,u=1,c=a,f="0000";return{init:function(e){if(e&&"number"==typeof e){n=(new Date).getTime(),i=Math.floor(e/1e3);var t=r(i);f=t.substr(t.length-4)}},getHeader:function(e,t){var r=this,i=(new Date).getTime();if(o==i)setTimeout(function(){r.getHeader(e,t)},1);else{o=i;var s=i-n;t((e+s).toString(36))}},getNextId:function(e){s.push(e),c==a&&this._exec_getNextId()},_exec_getNextId:function(){var e=this,t=s.shift();t?(c=u,this._getNextId(function(r,n){t(r,n),e._exec_getNextId()})):c=a},_getNextId:function(r){function n(e){return 1>=e?t[Math.floor(36*Math.random())]:t[Math.floor(36*Math.random())]+n(e-1)}this.getHeader(i,function(t){var i=t+f+n(3);15!=i.length&&(e.console&&console.error("generated id is wrong.",i.length),i=i.substr(0,15)),r(null,i)})}}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(e,t,r){function n(){var e={push:{},set:{},remove:{},send:{}};return{add:function(t,r,n){e[t][r]||(e[t][r]=[]),e[t][r].push(n)},del:function(t,r){e[t][r]=[]},fire:function(t,r,n){e[t][r].forEach(function(e){e(n)})},get_subscribes:function(){var t=[];for(var r in e)for(var n in e[r])t.push({event:r,path:n});return t}}}t.exports=n},{}],101:[function(e,t,r){(function(e){t.exports="browser"!==e.title?{mode:!1,log:function(){this.mode&&console.log(arguments)},error:function(){this.mode&&console.error(arguments)}}:{mode:!1,log:function(){window.console&&this.mode&&console.log(arguments)},error:function(){window.console&&this.mode&&console.error(arguments)}}}).call(this,e("_process"))},{_process:12}],102:[function(e,t,r){(function(r){function n(e,t){if(this.host=e,this.option=t||{},this.file_path=this.option.file_path||"/var/lib/mlkcca",this.storage=new u(this.file_path),this.app_id=this.option.app_id||this.host.match(/([a-z0-9]+)\.mlkcca\.com/)[1],!this.app_id)throw new Error("app_id must be specified");this.option.clientId||(this.option.clientId="js"+this.app_id.substr(this.app_id.length-5)+c(16)),this.option.app_id=this.app_id,this.listeners=new o,this.idGenerator=new i,this.connect()}var i=e("./idgenerator"),o=e("./listeners"),s=e("./transporter"),a=e("./datastore"),u=(e("./logger"),e("./storage")),c=(e("./dataelement"),e("./clientid"));n.prototype.connect=function(e){function t(t){r.start_ts=(new Date).getTime(),r.idGenerator.init(t),r.server_ts=Math.floor(t/1e3),e&&e()}var r=this,n=null,i=this.storage.get("mlkcca_sid");i&&(n=i.sid),this.transporter=new s(this.host,this.option,n,t),this.transporter.onMessage(function(e){if(e.content.hasOwnProperty("params"))if("string"==typeof e.content.params)e.content.params=JSON.parse(e.content.params);else if("object"!=typeof e.content.params)throw new Error("unknown params");switch(e.event){case"push":r.listeners.fire("push",e.path,{id:e.content.id,path:e.path,value:e.content.params,timestamp:e.content.ts});break;case"set":r.listeners.fire("set",e.path,{id:e.content.id,path:e.path,value:e.content.params});break;case"remove":r.listeners.fire("remove",e.path,{id:e.content.id,path:e.path});break;case"send":r.listeners.fire("send",e.path,{path:e.path,value:e.content.params});break;case"success":console.log("success",e)}}),this.server_ts=(new Date).getTime(),this.start_ts=(new Date).getTime()},n.prototype.onConnected=function(e){this.transporter.onConnected(e);

},n.prototype.onClosed=function(e){this.transporter.onClosed(e)},n.prototype.onError=function(e){this.transporter.onError(e)},n.prototype.get_time=function(){var e=(new Date).getTime()-this.start_ts;return Math.floor(this.server_ts+e)},n.connectWithAuth=function(e,t,r){var i=r||{};i.token=t;var o=new n(e,i);return o.authWithToken(t,function(e){}),o},n.connectWithApiKey=function(e,t,r,i){var o=i||{};o.apikey=t,o.apisecret=r;var s=new n(e,o);return s},n.prototype.disconnect=function(e){this.transporter.disconnect(e)},n.prototype.reconnect=function(e){var t=this;this.transporter.disconnect(function(){t.connect(function(){t.listeners.get_subscribes().forEach(function(e){t.transporter.on(e.path,e.event)}),e&&e()})})},n.prototype.dataStore=function(e){if("string"!=typeof e)throw new Error("path must be string");return new a(this,e)},n.prototype.authWithToken=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginwithtoken",{token:e},function(e,n){return e?void t(e):n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.authAsAdmin=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginasadmin",{token:e},function(e,n){return n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.user=function(e){var t=this.storage.get("mlkcca_sid"),r={};t&&(r.mlkccasid=t.sid),this.transporter.auth_call("me",r,function(t,r){return r.err?void e(r.err):"notloggedin"==r.content.condition?void e(null,null):void e(r.err,r.content.account)})},n.prototype.getCurrentUser=function(e){this.user(e)},n.prototype.logout=function(e){var t=this,r=this.storage.get("mlkcca_sid"),n={};r&&(n.mlkccasid=r.sid),this.transporter.auth_call("logout",n,function(r){return r&&e?void e(r):void t.reconnect(e)})},"browser"!==r.title?t.exports=n:window.MilkCocoa=n}).call(this,e("_process"))},{"./clientid":95,"./dataelement":96,"./datastore":97,"./idgenerator":99,"./listeners":100,"./logger":101,"./storage":103,"./transporter":106,_process:12}],103:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r)^s;t.push(n.toString(36))}return t.join(",")}function i(e){var t=e.split(","),r="";return t.forEach(function(e){r+=String.fromCharCode(parseInt(e,36)^s)}),r}var o=e("./logger"),s=80,a=null;if("browser"!==r.title){var u=e("fs"),c=e("path");a=function(e){return{set:function(t,r){var i=c.join(e,t);u.writeFileSync(i,n(JSON.stringify(r)))},get:function(t){var r=c.join(e,t);if(!u.existsSync(r))return null;var n=u.readFileSync(r),s=null;try{s=JSON.parse(i(String(n)))}catch(a){o.error("parse error",a)}return s}}}}else a=function(){return{set:function(e,t){window.localStorage&&window.localStorage.setItem(e,n(JSON.stringify(t)))},get:function(e){if(!window.localStorage)return null;var t=window.localStorage.getItem(e),r=null;try{r=JSON.parse(i(t))}catch(n){o.error("parse error",n)}return r}}};t.exports=a}).call(this,e("_process"))},{"./logger":101,_process:12,fs:1,path:11}],104:[function(e,t,r){function n(e,t){this.transporter=e,this.path=t,this._current_id=null,this._size=50,this._sort="DESC",this.onData=null,this.onError=null}var i=e("./dataelement");t.exports=n,n.prototype.sort=n.prototype.order=function(e){return this._sort=e.toUpperCase(),this},n.prototype.size=n.prototype.limit=function(e){return e>999&&(e=999,window.console&&window.console.log("size too large")),this._size=e,this},n.prototype.onData=function(e){this.onData=e},n.prototype.onError=function(e){this.onError=e},n.prototype.next=function(e){return this.exec(e),this},n.prototype.setTimestamp=function(e){return this._current_id=e.toString(36),this},n.prototype.exec=function(e){var t=this,r={path:this.path,limit:this._size,sort:this._sort};this._current_id&&(r.th=this._current_id),this.transporter.call("query",r,function(r,n){if(r)return t.onError&&t.onError(n.err),void(e&&e(r,null));if(null!=n.err)return t.onError&&t.onError(n.err),void(e&&e(n.err,[]));var o=n.content.d.map(i.format);o=o.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),o.length>0&&(t._current_id="ASC"==t._sort?o[o.length-1].id:o[0].id),t.onData&&t.onData(o),e&&e(null,o)})}},{"./dataelement":96}],105:[function(e,t,r){function n(e,t){this.stream=new i(e,t)}var i=e("./streaming");n.prototype.sort=i.prototype.order=function(e){return this.stream.sort(e),this},n.prototype.size=i.prototype.limit=function(e){return this.stream.size(e),this},n.prototype.onData=function(e){this.stream.onData(e)},n.prototype.onError=function(e){this.stream.onError(e)},n.prototype.next=function(e){var t=this;return this.stream.next(function(r,n){null==r&&"DESC"==t.stream._sort?e(r,n.reverse()):e(r,n)}),this},n.prototype.setTimestamp=function(e){return this.stream.setTimestamp(e),this},t.exports=n},{"./streaming":104}],106:[function(e,t,r){(function(r){function n(e,t,n,s){function u(e){h._is_connected=!0,h.flush(),i.log("transporter:onopen",e),s&&s(e),h._onConnected&&h._onConnected()}function c(e){h._is_connected=!1,i.log("transporter:onclose",e),h._onClosed&&h._onClosed()}function f(e){i.log("transporter:onerror",e.message),h._onError&&h._onError(e)}function l(e,t){var r={};if(e==h.app_id+"/$sys/error"){var n=t.readUInt16BE(0),i=t.readUInt16BE(2);return void h.recvError(i,n)}try{r=JSON.parse(h.decode(t))}catch(o){r=JSON.parse(t)}var s=e.indexOf("/"),a=e.lastIndexOf("/"),u=e.substr(s+1,a-s-1),c=e.substr(a+1),f={path:u,event:c,content:r};h._onMessage(f)}var h=this;this.sid=n,this.queue=[],this.error_callbacks={},this.comp_callbacks={},this.request_id=1,this.app_id=t.app_id,this.host=e,this.port=t.port||443,this.http_port=t.http_port||443,this.useSSL=!0,this.qos=0;var p="s"+n||"dammy";t.token&&(p="j"+t.token),t.apikey&&t.apisecret&&(p="k"+t.apikey+":"+t.apisecret,this.apikey={key:t.apikey,secret:t.apisecret}),t.hasOwnProperty("qos")&&(this.qos=t.qos),t.hasOwnProperty("useSSL")&&(this.useSSL=t.useSSL);var d=(this.useSSL?"wss://":"ws://")+e+":"+this.port+"/websocket";"browser"!==r.title?(this.port=this.useSSL?8883:1883,d=(this.useSSL?"mqtts://":"mqtt://")+e+":"+this.port):o.isAndroidStandardBrowser()&&(d=(this.useSSL?"sockjss://":"sockjs://")+e+":"+this.port+"/sockjs"),this.client=a.connect(d,{username:p,clientId:t.clientId,password:t.app_id,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:7e3,clean:!1}),this.client.onConnectionLost=c,this.client.onMessageArrived=l,this.client.on("connect",u),this.client.on("close",c),this.client.on("error",f),this.client.on("message",l),this._is_connected=!1}var i=e("./logger"),o=e("./ua"),s=e("./ajax"),a=e("mqtt"),u=e("./dataelement");t.exports=n,n.prototype.encode=function(e){return e},n.decode=function(e){return decodeURIComponent(e)},n.prototype.decode=function(e){return n.decode(e)},n.prototype.onMessage=function(e){this._onMessage=e},n.prototype.onConnected=function(e){this._onConnected=e},n.prototype.onClosed=function(e){this._onClosed=e},n.prototype.onError=function(e){this._onError=e},n.prototype.auth_call=function(e,t,r){t.cmd=e,t.appid=this.app_id,s.request("POST",this.useSSL,this.host,this.http_port,"/auth",t,{},r)},n.prototype.call=function(e,t,r){t.api=e,t.appid=this.app_id;var n={};this.sid&&(n.Authorization="MLKCCASID "+this.sid),this.apikey&&(n.Authorization="MLKCCAKEY "+this.apikey.key+":"+this.apikey.secret),s.request("GET",this.useSSL,this.host,this.http_port,"/api",t,n,r)},n.prototype.on=function(e,t){this.send({type:"s",topic:this.create_topic(e,t)})},n.prototype.off=function(e,t){this.send({type:"u",topic:this.create_topic(e,t)})},n.prototype.send_operation_request=function(e,t,r,n,i){this.request_id++,this.request_id>12287&&(this.request_id=1),r.r=this.request_id,this.error_callbacks[this.request_id]=i,this.comp_callbacks[this.request_id]=n,this.send({type:"p",topic:this.create_topic(e,t),msg:JSON.stringify(r),request_id:this.request_id})},n.prototype.create_topic=function(e,t){return this.app_id+"/"+e+"/"+t},n.prototype.send=function(e){var t=this;t._is_connected?t.send_op(e):t.queue.push(e)},n.prototype.flush=function(){this.send_next()},n.prototype.send_next=function(){var e=this;if(e._is_connected){var t=e.queue.shift();t&&(e.send_op(t),e.send_next())}},n.prototype.send_op=function(e){var t=this;switch(e.type){case"p":var r=t.encode(e.msg);t.client.publish(e.topic,r,{qos:t.qos,retain:!1},function(r,n){t.recvComp(e.request_id,null,u.format(JSON.parse(e.msg)))});break;case"s":t.client.subscribe(e.topic,{qos:3==t.qos?0:t.qos});break;case"u":t.client.unsubscribe(e.topic)}},n.prototype.recvError=function(e,t){function r(e){switch(e){case 3:return"permission denied";default:return"unknown error"}}var n=r(t);this.error_callbacks[e]?(this.error_callbacks[e](n),delete this.error_callbacks[e]):this._onError&&this._onError(n)},n.prototype.recvComp=function(e,t,r){this.comp_callbacks[e]&&this.comp_callbacks[e](t,r),delete this.comp_callbacks[e]},n.prototype.disconnect=function(e){this.client.end(e)}}).call(this,e("_process"))},{"./ajax":94,"./dataelement":96,"./logger":101,"./ua":107,_process:12,mqtt:46}],107:[function(e,t,r){t.exports={isAndroidStandardBrowser:function(){var e=navigator.userAgent;return e.indexOf("Android")>=0&&e.indexOf("Chrome")<0&&e.indexOf("Firefox")<0?!0:e.indexOf("MSIE 10")>=0?!0:!1}}},{}]},{},[102]);","ﾂ�":"\\u008b","ﾂ�":"\\u008c","ﾂ�":"\\u008d","ﾂ�":"\\u008e","ﾂ�":"\\u008f","ﾂ�":"\\u0090","ﾂ�":"\\u0091","ﾂ�":"\\u0092","ﾂ�":"\\u0093","ﾂ�":"\\u0094","ﾂ�":"\\u0095","ﾂ�":"\\u0096","ﾂ�":"\\u0097","ﾂ�":"\\u0098","ﾂ�":"\\u0099","ﾂ�":"\\u009a","ﾂ�":"\\u009b","ﾂ�":"\\u009c","ﾂ�":"\\u009d","ﾂ�":"\\u009e","ﾂ�":"\\u009f","ﾂｭ":"\\u00ad","ﾘ":"\\u0600","ﾘ�":"\\u0601","ﾘ�":"\\u0602","ﾘ�":"\\u0603","ﾘ�":"\\u0604","ﾜ�":"\\u070f","癰ｴ":"\\u17b4","癰ｵ":"\\u17b5","窶�":"\\u200c","窶�":"\\u200d","窶�":"\\u200e","窶�":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","窶ｪ":"\\u202a","窶ｫ":"\\u202b","窶ｬ":"\\u202c","窶ｭ":"\\u202d","窶ｮ":"\\u202e","窶ｯ":"\\u202f","竅�":"\\u2060","竅｡":"\\u2061","竅｢":"\\u2062","竅｣":"\\u2063","竅､":"\\u2064","竅･":"\\u2065","竅ｦ":"\\u2066","竅ｧ":"\\u2067","竅ｨ":"\\u2068","竅ｩ":"\\u2069","竅ｪ":"\\u206a","竅ｫ":"\\u206b","竅ｬ":"\\u206c","竅ｭ":"\\u206d","竅ｮ":"\\u206e","竅ｯ":"\\u206f","\ufeff":"\\ufeff","�ｰ":"\\ufff0","�ｱ":"\\ufff1","�ｲ":"\\ufff2","�ｳ":"\\ufff3","�ｴ":"\\ufff4","�ｵ":"\\ufff5","�ｶ":"\\ufff6","�ｷ":"\\ufff7","�ｸ":"\\ufff8","�ｹ":"\\ufff9","�ｺ":"\\ufffa","�ｻ":"\\ufffb","�ｼ":"\\ufffc","�ｽ":"\\ufffd","�ｾ":"\\ufffe","�ｿ":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h=JSON&&JSON.stringify||function(e){
return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,r={},n=[];for(t=0;65536>t;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return r[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,r};r.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(u||(u=p(l)),t.replace(l,function(e){return u[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){for(var e={},t=0;t<d.length;t++){var r=d[t];e[r]=k[r]&&k[r].enabled()}return e},r.detectProtocols=function(e,t,r){var n={},i=[];t||(t=d);for(var o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}var a=function(e){var t=e.shift();n[t]?i.push(t):e.length>0&&a(e)};return r.websocket!==!1&&a(["websocket"]),n["xhr-streaming"]&&!r.null_origin?i.push("xhr-streaming"):!n["xdr-streaming"]||r.cookie_needed||r.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),n["xhr-polling"]&&!r.null_origin?i.push("xhr-polling"):!n["xdr-polling"]||r.cookie_needed||r.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";r.createHook=function(){var t="a"+r.random_string(8);if(!(g in e)){var n={};e[g]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return e[g](t)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.addEventListener(r,n,!1):(t.attachEvent("on"+r,n),e.attachEvent("on"+r,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.removeEventListener(r,n,!1):(t.detachEvent("on"+r,n),e.detachEvent("on"+r,n))};var m={},v=!1,b=function(){for(var e in m)m[e](),delete m[e]},_=function(){v||(v=!0,b())};r.attachEvent("unload",_),r.unload_add=function(e){var t=r.random_string(8);return m[t]=e,v&&r.delay(b),t},r.unload_del=function(e){e in m&&delete m[e]},r.createIframe=function(e,n){var i,o,s=t.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unload_del(o))},c=function(e){s&&(u(),n(e))},f=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),i=setTimeout(function(){c("timeout")},15e3),o=r.unload_add(u),{post:f,cleanup:u,loaded:a}},r.createHtmlfile=function(t,n){var i,o,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},f=function(){u&&(c(),r.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(e){u&&(f(),n(e))},h=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var p=u.createElement("div");return u.body.appendChild(p),s=u.createElement("iframe"),p.appendChild(s),s.src=t,i=setTimeout(function(){l("timeout")},15e3),o=r.unload_add(f),{post:h,cleanup:f,loaded:c}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(t,n,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=r.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,n,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var c in o.headers)s.xhr.setRequestHeader(c,o.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,r=e.responseText}catch(e){}1223===t&&(t=204),r&&r.length>0&&s.emit("chunk",t,r);break;case 4:var t=e.status;1223===t&&(t=204),s.emit("finish",t,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};S.prototype=new y;var E=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,n){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:B.enabled()?3:4};var k=function(t,n,i){if(this===e)return new k(t,n,i);var o,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&r.objectExtend(s._options,i),s._base_url=r.amendUrl(t),s._server=s._options.server||r.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?o=s._options.protocols_whitelist:(o="string"==typeof n&&n.length>0?[n]:r.isArray(n)?n:null,o&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=z(s._base_url),s._ir.onfinish=function(e,t){s._ir=null,e?(s._options.info&&(e=r.objectExtend(e,s._options.info)),s._options.rtt&&(t=s._options.rtt),s._applyInfo(e,t,o),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new n,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},k.prototype._dispatchOpen=function(){var e=this;e.readyState===k.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=k.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("message",{data:e}))},k.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},k.prototype._didClose=function(e,t,n){var o=this;if(o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN&&o.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:r.userSetCode(e)});if(!r.userSetCode(e)&&o.readyState===k.CONNECTING&&!n){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=k.CLOSED,r.delay(function(){o.dispatchEvent(s)})},k.prototype._didMessage=function(e){var t=this,r=e.slice(0,1);switch(r){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var i=n.protocol=n._protocols.shift();if(!i)return!1;if(k[i]&&k[i].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(i),n.protocol="waiting-for-load",r.attachEvent("load",function(){n._try_next_protocol()}),!0;if(k[i]&&k[i].enabled(n._options)){var o=k[i].roundTrips||1,s=(n._options.rto||0)*o||5e3;n._transport_tref=r.delay(s,function(){n.readyState===k.CONNECTING&&n._didClose(2007,"Transport timeouted")});var a=r.random_string(8),u=n._base_url+"/"+n._server+"/"+a;return n._debug("Opening transport:",i," url:"+u," RTO:"+n._options.rto),n._transport=new k[i](n,u,n._base_url),!0}n._debug("Skipping transport:",i)}},k.prototype.close=function(e,t){var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==k.CONNECTING&&n.readyState!==k.OPEN?!1:(n.readyState=k.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},k.prototype.send=function(e){var t=this;if(t.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===k.OPEN&&t._transport.doSend(r.quote(""+e)),!0},k.prototype._applyInfo=function(e,n,i){var o=this;o._options.info=e,o._options.rtt=n,o._options.rto=r.countRTO(n),o._options.info.null_origin=!t.domain;var s=r.probeProtocols();o._protocols=r.detectProtocols(s,i,e)};var x=k.websocket=function(t,n){var i=this,o=n+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=t,i.url=o;var s=e.WebSocket||e.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=r.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(e){this.ws.send("["+e+"]")},x.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var j=function(){};j.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},j.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},j.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},j.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,r){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+r):e.send_schedule_wait()}),e.send_buffer=[]}},j.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(e,n,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=t.createElement("form"),a=o._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+r.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=n}catch(l){r.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var h=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,r.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",i(!0))};return c.onerror=c.onload=h,c.onreadystatechange=function(e){"complete"==c.readyState&&h()},h},M=function(e){return function(t,r,n){var i=new e("POST",t+"/xhr_send",r);return i.onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},O=function(e,n){var i,o,s=t.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,n(e),n=null)},u=!1,c=null;if(s.id="a"+r.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){c||(c=setTimeout(function(){u||a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))o=t.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),o&&l.insertBefore(o,l.firstChild),a},R=k["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(I),n._schedule_recv()};R.prototype=new j,R.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",O,t)},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(t,n,i){var o="a"+r.random_string(6),s=t+"?c="+escape(a+"."+o),u=0,c=function(t){switch(u){case 0:delete e[a][o],i(t);break;case 1:i(t),u=2;break;case 2:delete e[a][o]}},f=n(s,c);e[a][o]=f;var l=function(){e[a][o]&&(u=1,e[a][o](r.closeFrame(1e3,"JSONP user aborted read")))};return l},T=function(){};T.prototype=new j,T.prototype.run=function(e,t,r,n,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(M(i)),o.poll=new V(e,n,t+r,i)},T.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var C=k["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XHRCorsObject)};C.prototype=new T,C.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},C.roundTrips=2,C.need_body=!0;var A=k["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XDRObject)};A.prototype=new T,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var U=k["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRCorsObject)};U.prototype=new T,U.enabled=C.enabled,U.roundTrips=2;var q=k["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XDRObject)};q.prototype=new T,q.enabled=A.enabled,q.roundTrips=2;var B=function(){};B.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},B.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},B.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var r=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(r===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([k.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},B.prototype.postMessage=function(e,t){var r=this;r.iframeObj.post(r.window_id+e+(t||""),r.origin)},B.prototype.doSend=function(e){this.postMessage("m",e)},B.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var N,P=function(t,n){parent!==e?parent.postMessage(N+t+(n||""),"*"):r.log("Can't postMessage, no parent window.",t,n)},D=function(){};D.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},D.prototype._didMessage=function(e){P("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},r.parent_origin=void 0,k.bootstrap_iframe=function(){var n;N=t.location.hash.slice(1);var i=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var i=t.data.slice(0,8),o=t.data.slice(8,9),s=t.data.slice(9);if(i===N)switch(o){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==k.version&&r.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+k.version+'".'),!r.flatUrl(f)||!r.flatUrl(l))return void r.log("Only basic urls are supported in SockJS");if(!r.isSameOriginUrl(f)||!r.isSameOriginUrl(l))return void r.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");n=new D,n._transport=new D[c](n,f,l);break;case"m":n._doSend(s);break;case"c":n&&n._doCleanup(),n=null}}};r.attachMessage(i),P("s")};var W=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};W.prototype=new o(["finish"]),W.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=r.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var r=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var H=function(e){var n=this,i=function(){var t=new B;t.protocol="w-iframe-info-receiver";var r=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var r=JSON.parse(e.substr(1)),i=r[0],o=r[1];n.emit("finish",i,o)}else n.emit("finish");t.doCleanup(),t=null},i={_options:{},_didClose:r,_didMessage:r};t.i_constructor(i,e,e)};t.body?i():r.attachEvent("load",i)};H.prototype=new o(["finish"]);var F=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new o(["finish"]);var z=function(e){if(r.isSameOriginUrl(e))return new W(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new W(e,r.XHRLocalObject);case 2:return new W(e,r.XDRObject);case 3:return new H(e);default:return new F}},J=D["w-iframe-info-receiver"]=function(e,t,n){var i=new W(n,r.XHRLocalObject);i.onfinish=function(t,r){e._didMessage("m"+JSON.stringify([t,r])),e._didClose()}};J.prototype.doCleanup=function(){};var X=k["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};X.prototype=new B,X.enabled=function(){return"EventSource"in e&&B.enabled()},X.need_body=!0,X.roundTrips=3;var G=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,r.XHRLocalObject)};G.prototype=new T;var K=k["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};K.prototype=new B,K.enabled=function(){return e.XMLHttpRequest&&B.enabled()},K.need_body=!0,K.roundTrips=3;var Y=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRLocalObject)};Y.prototype=new T;var Q=k["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new B,Q.enabled=function(){return B.enabled()},Q.need_body=!0,Q.roundTrips=3;var $=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",re,r.XHRLocalObject)};$.prototype=new T;var V=function(e,t,r,n){var i=this;i.ri=e,i.Receiver=t,i.recv_url=r,i.AjaxObject=n,i._scheduleRecv()};V.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),r=0;t.onmessage=function(t){r+=1,e.ri._didMessage(t.data)},t.onclose=function(r){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===r.reason?e.ri._didClose(1006,"Polling error ("+r.reason+")"):e._scheduleRecv())}},V.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,o){var s=o?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Z.prototype=new n,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var ee,te=function(){if(void 0===ee)if("ActiveXObject"in e)try{ee=!!new ActiveXObject("htmlfile")}catch(t){}else ee=!1;return ee},re=function(t){var n=this;r.polluteGlobalNamespace(),n.id="a"+r.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+n.id);var o,s=te()?r.createHtmlfile:r.createIframe;e[a][n.id]={start:function(){o.loaded()},message:function(e){n.dispatchEvent(new i("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,r){o.cleanup(),n.iframe_close=o=null,delete e[a][n.id],n.dispatchEvent(new i("close",{reason:r}))},o=s(t,function(e){n.iframe_close({},"permanent")})};re.prototype=new n,re.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var ne=function(e,t){var r=this,n=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(n),s=o.indexOf("\n");if(-1===s)break;n+=s+1;var a=o.slice(0,s);r.dispatchEvent(new i("message",{data:a}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null;var n=200===e?"network":"permanent";r.dispatchEvent(new i("close",{reason:n}))}};return ne.prototype=new n,ne.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},k.getUtils=function(){return r},k.getIframeTransport=function(){return B},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}],94:[function(e,t,r){(function(r){function n(e,t,r,n,i,o,c,f){function l(e){if(f){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){f(null,JSON.parse(t))})}}var h=t?a:s;c["Content-Type"]="application/x-www-form-urlencoded";var p={hostname:r,port:n||(t?443:80),path:i,method:e,headers:c};if("GET"==e){var d=u.stringify(o);p.path+="?"+d,h.get(p,l).on("error",function(e){f(e)})}else{var g=h.request(p,l);g.setTimeout(5e3),g.on("timeout",function(){f&&f(new Error("timed out"),null),g.abort()}),g.on("error",function(e){f&&f(e,null)});var d=u.stringify(o);g.write(d),g.end()}}function i(e,t,r,n,i,s,a,c){var f=u.stringify(s),l=(t?"https://":"http://")+r+":"+n+i;"GET"==e&&(l+="?"+f);var h=o(e,l);h.withCredentials=!0,h.onload=function(){decoded="";try{var e=JSON.parse(h.responseText);c(null,e)}catch(t){c(null,JSON.parse(h.responseText))}},h.onerror=function(){c(h.statusText||"unknown error")},h.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(header_key in a)h.setRequestHeader(header_key,a[header_key]);h.send(f)}function o(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}var s=e("http"),a=e("https"),u=e("querystring");t.exports="browser"!==r.title?{request:n}:{request:i}}).call(this,e("_process"))},{_process:12,http:31,https:8,querystring:16}],95:[function(e,t,r){function n(e){if(0==e)return"";var t=Math.floor(62*Math.random())%62;return n(e-1)+i[t]}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.exports=n},{}],96:[function(e,t,r){function n(){}var i=e("./transporter");t.exports=n,n.format=function(e){var t="";e.params&&(e.value=e.params);try{t=i.decode(e.value)}catch(r){t=e.value}return{id:e.id,value:t?"string"==typeof t?JSON.parse(t):t:null,timestamp:e.timestamp}}},{"./transporter":106}],97:[function(e,t,r){function n(e,t){this.milkcocoa=e,this.idGenerator=e.idGenerator,this.path=t}var i=e("./streaming"),o=e("./streaming2"),s=e("./history"),a=e("./dataelement");t.exports=n,n.prototype.transporter=function(){return this.milkcocoa.transporter},n.prototype.push=function(e,t,r){var n=this;if(e instanceof Array)throw new Error("params must not be Array");if("object"!=typeof e)throw new Error("params must be object");this.idGenerator.getNextId(function(i,o){var s=n.milkcocoa.get_time();n.transporter().send_operation_request(n.path,"push",{id:o,ts:s,params:e},t,r)})},n.prototype.set=function(e,t,r,n){if("string"!=typeof e)throw new Error("id must be string");if(t instanceof Array)throw new Error("params must not be Array");if("object"!=typeof t)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"set",{path:this.path,id:e,params:t},r,n)},n.prototype.send=function(e,t,r){if("object"!=typeof e)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"send",{path:this.path,params:e},t,r)},n.prototype.remove=function(e,t,r){if("string"!=typeof e)throw new Error("id must be string");this.transporter().send_operation_request(this.path,"remove",{path:this.path,id:e},t,r)},n.prototype.get=function(e,t){if("string"!=typeof e)throw new Error("id must be string");this.transporter().call("get",{path:this.path,id:e},function(e,r){return r.err?void t(r.err):void t(null,a.format(r.content.d))})},n.prototype.get_many=function(e,t){this.transporter().call("get_many",{path:this.path,ids:JSON.stringify(e)},function(e,r){return r.err?void t(r.err):void t(null,r.content.d.map(a.format))})},n.prototype.count=function(e){e(new Error("deprecated"))},n.prototype.stream=function(){return new i(this.transporter(),this.path)},n.prototype.stream2=function(){return new o(this.transporter(),this.path)},n.prototype.history=function(){return new s(this.transporter(),this.path)},n.prototype.on=function(e,t){this.milkcocoa.listeners.add(e,this.path,t),this.transporter().on(this.path,e)},n.prototype.off=function(e){this.milkcocoa.listeners.del(e,this.path),this.transporter().off(this.path,e)},n.prototype.child=function(e){return new n(this.milkcocoa,this.path+"/"+e)}},{"./dataelement":96,"./history":98,"./streaming":104,"./streaming2":105}],98:[function(e,t,r){function n(e,t){this.stream=new i(e,t),this._times=1,this._limit=null,this._span=null,this.listeners={}}var i=e("./streaming2");n.prototype.sort=function(e){return this.stream.sort(e),this},n.prototype.size=function(e){return this.stream.size(e),this},n.prototype.times=function(e){return this._times=e,this},n.prototype.limit=function(e){return this._limit=e,this},n.prototype.span=function(e,t){return this._span={start:e,end:t},this},n.prototype.on=function(e,t){this.listeners[e]=t},n.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},n.prototype.runTimes=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e--,t.fire("data",n),void(e>0?t.runTimes(e):t.fire("end")))})},n.prototype.runLimit=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e-=n.length,0>e?"DESC"==t.stream.stream._sort?t.fire("data",n.slice(0,n.length+e)):t.fire("data",n.slice(0,n.length+e)):n.length>0&&t.fire("data",n),void(e>0&&n.length>0?t.runLimit(e):t.fire("end")))})},n.prototype.runSpan=function(e){var t=this;this.stream.next(function(r,n){if(r)return void t.fire("error",r);if("DESC"==t.stream.stream._sort)var i=function(t){return t.id>=e};else var i=function(t){return t.id<=e};var o=n.filter(i);o.length>0?(t.fire("data",o),t.runSpan(e)):t.fire("end")})},n.prototype.fire=function(e,t){this.listeners[e]&&this.listeners[e](t)},t.exports=n},{"./streaming2":105}],99:[function(e,t,r){(function(e){function r(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e%62,i=Math.floor(e/62);return 1>i?"":r(i)+t[n]}function n(){var t="ybfghijam6cpqdrw71nx34eo5suz0t9vkl28",n=(new Date).getTime(),i=n,o=null,s=[],a=0,u=1,c=a,f="0000";return{init:function(e){if(e&&"number"==typeof e){n=(new Date).getTime(),i=Math.floor(e/1e3);var t=r(i);f=t.substr(t.length-4)}},getHeader:function(e,t){var r=this,i=(new Date).getTime();if(o==i)setTimeout(function(){r.getHeader(e,t)},1);else{o=i;var s=i-n;t((e+s).toString(36))}},getNextId:function(e){s.push(e),c==a&&this._exec_getNextId()},_exec_getNextId:function(){var e=this,t=s.shift();t?(c=u,this._getNextId(function(r,n){t(r,n),e._exec_getNextId()})):c=a},_getNextId:function(r){function n(e){return 1>=e?t[Math.floor(36*Math.random())]:t[Math.floor(36*Math.random())]+n(e-1)}this.getHeader(i,function(t){var i=t+f+n(3);15!=i.length&&(e.console&&console.error("generated id is wrong.",i.length),i=i.substr(0,15)),r(null,i)})}}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(e,t,r){function n(){var e={push:{},set:{},remove:{},send:{}};return{add:function(t,r,n){e[t][r]||(e[t][r]=[]),e[t][r].push(n)},del:function(t,r){e[t][r]=[]},fire:function(t,r,n){e[t][r].forEach(function(e){e(n)})},get_subscribes:function(){var t=[];for(var r in e)for(var n in e[r])t.push({event:r,path:n});return t}}}t.exports=n},{}],101:[function(e,t,r){(function(e){t.exports="browser"!==e.title?{mode:!1,log:function(){this.mode&&console.log(arguments)},error:function(){this.mode&&console.error(arguments)}}:{mode:!1,log:function(){window.console&&this.mode&&console.log(arguments)},error:function(){window.console&&this.mode&&console.error(arguments)}}}).call(this,e("_process"))},{_process:12}],102:[function(e,t,r){(function(r){function n(e,t){if(this.host=e,this.option=t||{},this.file_path=this.option.file_path||"/var/lib/mlkcca",this.storage=new u(this.file_path),this.app_id=this.option.app_id||this.host.match(/([a-z0-9]+)\.mlkcca\.com/)[1],!this.app_id)throw new Error("app_id must be specified");this.option.clientId||(this.option.clientId="js"+this.app_id.substr(this.app_id.length-5)+c(16)),this.option.app_id=this.app_id,this.listeners=new o,this.idGenerator=new i,this.connect()}var i=e("./idgenerator"),o=e("./listeners"),s=e("./transporter"),a=e("./datastore"),u=(e("./logger"),e("./storage")),c=(e("./dataelement"),e("./clientid"));n.prototype.connect=function(e){function t(t){r.start_ts=(new Date).getTime(),r.idGenerator.init(t),r.server_ts=Math.floor(t/1e3),e&&e()}var r=this,n=null,i=this.storage.get("mlkcca_sid");i&&(n=i.sid),this.transporter=new s(this.host,this.option,n,t),this.transporter.onMessage(function(e){if(e.content.hasOwnProperty("params"))if("string"==typeof e.content.params)e.content.params=JSON.parse(e.content.params);else if("object"!=typeof e.content.params)throw new Error("unknown params");switch(e.event){case"push":r.listeners.fire("push",e.path,{id:e.content.id,path:e.path,value:e.content.params,timestamp:e.content.ts});break;case"set":r.listeners.fire("set",e.path,{id:e.content.id,path:e.path,value:e.content.params});break;case"remove":r.listeners.fire("remove",e.path,{id:e.content.id,path:e.path});break;case"send":r.listeners.fire("send",e.path,{path:e.path,value:e.content.params});break;case"success":console.log("success",e)}}),this.server_ts=(new Date).getTime(),this.start_ts=(new Date).getTime()},n.prototype.onConnected=function(e){this.transporter.onConnected(e);

},n.prototype.onClosed=function(e){this.transporter.onClosed(e)},n.prototype.onError=function(e){this.transporter.onError(e)},n.prototype.get_time=function(){var e=(new Date).getTime()-this.start_ts;return Math.floor(this.server_ts+e)},n.connectWithAuth=function(e,t,r){var i=r||{};i.token=t;var o=new n(e,i);return o.authWithToken(t,function(e){}),o},n.connectWithApiKey=function(e,t,r,i){var o=i||{};o.apikey=t,o.apisecret=r;var s=new n(e,o);return s},n.prototype.disconnect=function(e){this.transporter.disconnect(e)},n.prototype.reconnect=function(e){var t=this;this.transporter.disconnect(function(){t.connect(function(){t.listeners.get_subscribes().forEach(function(e){t.transporter.on(e.path,e.event)}),e&&e()})})},n.prototype.dataStore=function(e){if("string"!=typeof e)throw new Error("path must be string");return new a(this,e)},n.prototype.authWithToken=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginwithtoken",{token:e},function(e,n){return e?void t(e):n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.authAsAdmin=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginasadmin",{token:e},function(e,n){return n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.user=function(e){var t=this.storage.get("mlkcca_sid"),r={};t&&(r.mlkccasid=t.sid),this.transporter.auth_call("me",r,function(t,r){return r.err?void e(r.err):"notloggedin"==r.content.condition?void e(null,null):void e(r.err,r.content.account)})},n.prototype.getCurrentUser=function(e){this.user(e)},n.prototype.logout=function(e){var t=this,r=this.storage.get("mlkcca_sid"),n={};r&&(n.mlkccasid=r.sid),this.transporter.auth_call("logout",n,function(r){return r&&e?void e(r):void t.reconnect(e)})},"browser"!==r.title?t.exports=n:window.MilkCocoa=n}).call(this,e("_process"))},{"./clientid":95,"./dataelement":96,"./datastore":97,"./idgenerator":99,"./listeners":100,"./logger":101,"./storage":103,"./transporter":106,_process:12}],103:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r)^s;t.push(n.toString(36))}return t.join(",")}function i(e){var t=e.split(","),r="";return t.forEach(function(e){r+=String.fromCharCode(parseInt(e,36)^s)}),r}var o=e("./logger"),s=80,a=null;if("browser"!==r.title){var u=e("fs"),c=e("path");a=function(e){return{set:function(t,r){var i=c.join(e,t);u.writeFileSync(i,n(JSON.stringify(r)))},get:function(t){var r=c.join(e,t);if(!u.existsSync(r))return null;var n=u.readFileSync(r),s=null;try{s=JSON.parse(i(String(n)))}catch(a){o.error("parse error",a)}return s}}}}else a=function(){return{set:function(e,t){window.localStorage&&window.localStorage.setItem(e,n(JSON.stringify(t)))},get:function(e){if(!window.localStorage)return null;var t=window.localStorage.getItem(e),r=null;try{r=JSON.parse(i(t))}catch(n){o.error("parse error",n)}return r}}};t.exports=a}).call(this,e("_process"))},{"./logger":101,_process:12,fs:1,path:11}],104:[function(e,t,r){function n(e,t){this.transporter=e,this.path=t,this._current_id=null,this._size=50,this._sort="DESC",this.onData=null,this.onError=null}var i=e("./dataelement");t.exports=n,n.prototype.sort=n.prototype.order=function(e){return this._sort=e.toUpperCase(),this},n.prototype.size=n.prototype.limit=function(e){return e>999&&(e=999,window.console&&window.console.log("size too large")),this._size=e,this},n.prototype.onData=function(e){this.onData=e},n.prototype.onError=function(e){this.onError=e},n.prototype.next=function(e){return this.exec(e),this},n.prototype.setTimestamp=function(e){return this._current_id=e.toString(36),this},n.prototype.exec=function(e){var t=this,r={path:this.path,limit:this._size,sort:this._sort};this._current_id&&(r.th=this._current_id),this.transporter.call("query",r,function(r,n){if(r)return t.onError&&t.onError(n.err),void(e&&e(r,null));if(null!=n.err)return t.onError&&t.onError(n.err),void(e&&e(n.err,[]));var o=n.content.d.map(i.format);o=o.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),o.length>0&&(t._current_id="ASC"==t._sort?o[o.length-1].id:o[0].id),t.onData&&t.onData(o),e&&e(null,o)})}},{"./dataelement":96}],105:[function(e,t,r){function n(e,t){this.stream=new i(e,t)}var i=e("./streaming");n.prototype.sort=i.prototype.order=function(e){return this.stream.sort(e),this},n.prototype.size=i.prototype.limit=function(e){return this.stream.size(e),this},n.prototype.onData=function(e){this.stream.onData(e)},n.prototype.onError=function(e){this.stream.onError(e)},n.prototype.next=function(e){var t=this;return this.stream.next(function(r,n){null==r&&"DESC"==t.stream._sort?e(r,n.reverse()):e(r,n)}),this},n.prototype.setTimestamp=function(e){return this.stream.setTimestamp(e),this},t.exports=n},{"./streaming":104}],106:[function(e,t,r){(function(r){function n(e,t,n,s){function u(e){h._is_connected=!0,h.flush(),i.log("transporter:onopen",e),s&&s(e),h._onConnected&&h._onConnected()}function c(e){h._is_connected=!1,i.log("transporter:onclose",e),h._onClosed&&h._onClosed()}function f(e){i.log("transporter:onerror",e.message),h._onError&&h._onError(e)}function l(e,t){var r={};if(e==h.app_id+"/$sys/error"){var n=t.readUInt16BE(0),i=t.readUInt16BE(2);return void h.recvError(i,n)}try{r=JSON.parse(h.decode(t))}catch(o){r=JSON.parse(t)}var s=e.indexOf("/"),a=e.lastIndexOf("/"),u=e.substr(s+1,a-s-1),c=e.substr(a+1),f={path:u,event:c,content:r};h._onMessage(f)}var h=this;this.sid=n,this.queue=[],this.error_callbacks={},this.comp_callbacks={},this.request_id=1,this.app_id=t.app_id,this.host=e,this.port=t.port||443,this.http_port=t.http_port||443,this.useSSL=!0,this.qos=0;var p="s"+n||"dammy";t.token&&(p="j"+t.token),t.apikey&&t.apisecret&&(p="k"+t.apikey+":"+t.apisecret,this.apikey={key:t.apikey,secret:t.apisecret}),t.hasOwnProperty("qos")&&(this.qos=t.qos),t.hasOwnProperty("useSSL")&&(this.useSSL=t.useSSL);var d=(this.useSSL?"wss://":"ws://")+e+":"+this.port+"/websocket";"browser"!==r.title?(this.port=this.useSSL?8883:1883,d=(this.useSSL?"mqtts://":"mqtt://")+e+":"+this.port):o.isAndroidStandardBrowser()&&(d=(this.useSSL?"sockjss://":"sockjs://")+e+":"+this.port+"/sockjs"),this.client=a.connect(d,{username:p,clientId:t.clientId,password:t.app_id,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:7e3,clean:!1}),this.client.onConnectionLost=c,this.client.onMessageArrived=l,this.client.on("connect",u),this.client.on("close",c),this.client.on("error",f),this.client.on("message",l),this._is_connected=!1}var i=e("./logger"),o=e("./ua"),s=e("./ajax"),a=e("mqtt"),u=e("./dataelement");t.exports=n,n.prototype.encode=function(e){return e},n.decode=function(e){return decodeURIComponent(e)},n.prototype.decode=function(e){return n.decode(e)},n.prototype.onMessage=function(e){this._onMessage=e},n.prototype.onConnected=function(e){this._onConnected=e},n.prototype.onClosed=function(e){this._onClosed=e},n.prototype.onError=function(e){this._onError=e},n.prototype.auth_call=function(e,t,r){t.cmd=e,t.appid=this.app_id,s.request("POST",this.useSSL,this.host,this.http_port,"/auth",t,{},r)},n.prototype.call=function(e,t,r){t.api=e,t.appid=this.app_id;var n={};this.sid&&(n.Authorization="MLKCCASID "+this.sid),this.apikey&&(n.Authorization="MLKCCAKEY "+this.apikey.key+":"+this.apikey.secret),s.request("GET",this.useSSL,this.host,this.http_port,"/api",t,n,r)},n.prototype.on=function(e,t){this.send({type:"s",topic:this.create_topic(e,t)})},n.prototype.off=function(e,t){this.send({type:"u",topic:this.create_topic(e,t)})},n.prototype.send_operation_request=function(e,t,r,n,i){this.request_id++,this.request_id>12287&&(this.request_id=1),r.r=this.request_id,this.error_callbacks[this.request_id]=i,this.comp_callbacks[this.request_id]=n,this.send({type:"p",topic:this.create_topic(e,t),msg:JSON.stringify(r),request_id:this.request_id})},n.prototype.create_topic=function(e,t){return this.app_id+"/"+e+"/"+t},n.prototype.send=function(e){var t=this;t._is_connected?t.send_op(e):t.queue.push(e)},n.prototype.flush=function(){this.send_next()},n.prototype.send_next=function(){var e=this;if(e._is_connected){var t=e.queue.shift();t&&(e.send_op(t),e.send_next())}},n.prototype.send_op=function(e){var t=this;switch(e.type){case"p":var r=t.encode(e.msg);t.client.publish(e.topic,r,{qos:t.qos,retain:!1},function(r,n){t.recvComp(e.request_id,null,u.format(JSON.parse(e.msg)))});break;case"s":t.client.subscribe(e.topic,{qos:3==t.qos?0:t.qos});break;case"u":t.client.unsubscribe(e.topic)}},n.prototype.recvError=function(e,t){function r(e){switch(e){case 3:return"permission denied";default:return"unknown error"}}var n=r(t);this.error_callbacks[e]?(this.error_callbacks[e](n),delete this.error_callbacks[e]):this._onError&&this._onError(n)},n.prototype.recvComp=function(e,t,r){this.comp_callbacks[e]&&this.comp_callbacks[e](t,r),delete this.comp_callbacks[e]},n.prototype.disconnect=function(e){this.client.end(e)}}).call(this,e("_process"))},{"./ajax":94,"./dataelement":96,"./logger":101,"./ua":107,_process:12,mqtt:46}],107:[function(e,t,r){t.exports={isAndroidStandardBrowser:function(){var e=navigator.userAgent;return e.indexOf("Android")>=0&&e.indexOf("Chrome")<0&&e.indexOf("Firefox")<0?!0:e.indexOf("MSIE 10")>=0?!0:!1}}},{}]},{},[102]);","ﾂ�":"\\u008b","ﾂ�":"\\u008c","ﾂ�":"\\u008d","ﾂ�":"\\u008e","ﾂ�":"\\u008f","ﾂ�":"\\u0090","ﾂ�":"\\u0091","ﾂ�":"\\u0092","ﾂ�":"\\u0093","ﾂ�":"\\u0094","ﾂ�":"\\u0095","ﾂ�":"\\u0096","ﾂ�":"\\u0097","ﾂ�":"\\u0098","ﾂ�":"\\u0099","ﾂ�":"\\u009a","ﾂ�":"\\u009b","ﾂ�":"\\u009c","ﾂ�":"\\u009d","ﾂ�":"\\u009e","ﾂ�":"\\u009f","ﾂｭ":"\\u00ad","ﾘ":"\\u0600","ﾘ�":"\\u0601","ﾘ�":"\\u0602","ﾘ�":"\\u0603","ﾘ�":"\\u0604","ﾜ�":"\\u070f","癰ｴ":"\\u17b4","癰ｵ":"\\u17b5","窶�":"\\u200c","窶�":"\\u200d","窶�":"\\u200e","窶�":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","窶ｪ":"\\u202a","窶ｫ":"\\u202b","窶ｬ":"\\u202c","窶ｭ":"\\u202d","窶ｮ":"\\u202e","窶ｯ":"\\u202f","竅�":"\\u2060","竅｡":"\\u2061","竅｢":"\\u2062","竅｣":"\\u2063","竅､":"\\u2064","竅･":"\\u2065","竅ｦ":"\\u2066","竅ｧ":"\\u2067","竅ｨ":"\\u2068","竅ｩ":"\\u2069","竅ｪ":"\\u206a","竅ｫ":"\\u206b","竅ｬ":"\\u206c","竅ｭ":"\\u206d","竅ｮ":"\\u206e","竅ｯ":"\\u206f","\ufeff":"\\ufeff","�ｰ":"\\ufff0","�ｱ":"\\ufff1","�ｲ":"\\ufff2","�ｳ":"\\ufff3","�ｴ":"\\ufff4","�ｵ":"\\ufff5","�ｶ":"\\ufff6","�ｷ":"\\ufff7","�ｸ":"\\ufff8","�ｹ":"\\ufff9","�ｺ":"\\ufffa","�ｻ":"\\ufffb","�ｼ":"\\ufffc","�ｽ":"\\ufffd","�ｾ":"\\ufffe","�ｿ":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h=JSON&&JSON.stringify||function(e){
return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,r={},n=[];for(t=0;65536>t;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return r[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,r};r.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(u||(u=p(l)),t.replace(l,function(e){return u[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){for(var e={},t=0;t<d.length;t++){var r=d[t];e[r]=k[r]&&k[r].enabled()}return e},r.detectProtocols=function(e,t,r){var n={},i=[];t||(t=d);for(var o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}var a=function(e){var t=e.shift();n[t]?i.push(t):e.length>0&&a(e)};return r.websocket!==!1&&a(["websocket"]),n["xhr-streaming"]&&!r.null_origin?i.push("xhr-streaming"):!n["xdr-streaming"]||r.cookie_needed||r.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),n["xhr-polling"]&&!r.null_origin?i.push("xhr-polling"):!n["xdr-polling"]||r.cookie_needed||r.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";r.createHook=function(){var t="a"+r.random_string(8);if(!(g in e)){var n={};e[g]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return e[g](t)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.addEventListener(r,n,!1):(t.attachEvent("on"+r,n),e.attachEvent("on"+r,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.removeEventListener(r,n,!1):(t.detachEvent("on"+r,n),e.detachEvent("on"+r,n))};var m={},v=!1,b=function(){for(var e in m)m[e](),delete m[e]},_=function(){v||(v=!0,b())};r.attachEvent("unload",_),r.unload_add=function(e){var t=r.random_string(8);return m[t]=e,v&&r.delay(b),t},r.unload_del=function(e){e in m&&delete m[e]},r.createIframe=function(e,n){var i,o,s=t.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unload_del(o))},c=function(e){s&&(u(),n(e))},f=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),i=setTimeout(function(){c("timeout")},15e3),o=r.unload_add(u),{post:f,cleanup:u,loaded:a}},r.createHtmlfile=function(t,n){var i,o,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},f=function(){u&&(c(),r.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(e){u&&(f(),n(e))},h=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var p=u.createElement("div");return u.body.appendChild(p),s=u.createElement("iframe"),p.appendChild(s),s.src=t,i=setTimeout(function(){l("timeout")},15e3),o=r.unload_add(f),{post:h,cleanup:f,loaded:c}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(t,n,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=r.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,n,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var c in o.headers)s.xhr.setRequestHeader(c,o.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,r=e.responseText}catch(e){}1223===t&&(t=204),r&&r.length>0&&s.emit("chunk",t,r);break;case 4:var t=e.status;1223===t&&(t=204),s.emit("finish",t,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};S.prototype=new y;var E=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,n){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:B.enabled()?3:4};var k=function(t,n,i){if(this===e)return new k(t,n,i);var o,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&r.objectExtend(s._options,i),s._base_url=r.amendUrl(t),s._server=s._options.server||r.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?o=s._options.protocols_whitelist:(o="string"==typeof n&&n.length>0?[n]:r.isArray(n)?n:null,o&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=z(s._base_url),s._ir.onfinish=function(e,t){s._ir=null,e?(s._options.info&&(e=r.objectExtend(e,s._options.info)),s._options.rtt&&(t=s._options.rtt),s._applyInfo(e,t,o),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new n,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},k.prototype._dispatchOpen=function(){var e=this;e.readyState===k.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=k.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("message",{data:e}))},k.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},k.prototype._didClose=function(e,t,n){var o=this;if(o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN&&o.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:r.userSetCode(e)});if(!r.userSetCode(e)&&o.readyState===k.CONNECTING&&!n){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=k.CLOSED,r.delay(function(){o.dispatchEvent(s)})},k.prototype._didMessage=function(e){var t=this,r=e.slice(0,1);switch(r){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var i=n.protocol=n._protocols.shift();if(!i)return!1;if(k[i]&&k[i].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(i),n.protocol="waiting-for-load",r.attachEvent("load",function(){n._try_next_protocol()}),!0;if(k[i]&&k[i].enabled(n._options)){var o=k[i].roundTrips||1,s=(n._options.rto||0)*o||5e3;n._transport_tref=r.delay(s,function(){n.readyState===k.CONNECTING&&n._didClose(2007,"Transport timeouted")});var a=r.random_string(8),u=n._base_url+"/"+n._server+"/"+a;return n._debug("Opening transport:",i," url:"+u," RTO:"+n._options.rto),n._transport=new k[i](n,u,n._base_url),!0}n._debug("Skipping transport:",i)}},k.prototype.close=function(e,t){var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==k.CONNECTING&&n.readyState!==k.OPEN?!1:(n.readyState=k.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},k.prototype.send=function(e){var t=this;if(t.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===k.OPEN&&t._transport.doSend(r.quote(""+e)),!0},k.prototype._applyInfo=function(e,n,i){var o=this;o._options.info=e,o._options.rtt=n,o._options.rto=r.countRTO(n),o._options.info.null_origin=!t.domain;var s=r.probeProtocols();o._protocols=r.detectProtocols(s,i,e)};var x=k.websocket=function(t,n){var i=this,o=n+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=t,i.url=o;var s=e.WebSocket||e.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=r.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(e){this.ws.send("["+e+"]")},x.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var j=function(){};j.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},j.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},j.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},j.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,r){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+r):e.send_schedule_wait()}),e.send_buffer=[]}},j.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(e,n,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=t.createElement("form"),a=o._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+r.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=n}catch(l){r.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var h=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,r.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",i(!0))};return c.onerror=c.onload=h,c.onreadystatechange=function(e){"complete"==c.readyState&&h()},h},M=function(e){return function(t,r,n){var i=new e("POST",t+"/xhr_send",r);return i.onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},O=function(e,n){var i,o,s=t.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,n(e),n=null)},u=!1,c=null;if(s.id="a"+r.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){c||(c=setTimeout(function(){u||a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))o=t.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),o&&l.insertBefore(o,l.firstChild),a},R=k["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(I),n._schedule_recv()};R.prototype=new j,R.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",O,t)},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(t,n,i){var o="a"+r.random_string(6),s=t+"?c="+escape(a+"."+o),u=0,c=function(t){switch(u){case 0:delete e[a][o],i(t);break;case 1:i(t),u=2;break;case 2:delete e[a][o]}},f=n(s,c);e[a][o]=f;var l=function(){e[a][o]&&(u=1,e[a][o](r.closeFrame(1e3,"JSONP user aborted read")))};return l},T=function(){};T.prototype=new j,T.prototype.run=function(e,t,r,n,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(M(i)),o.poll=new V(e,n,t+r,i)},T.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var C=k["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XHRCorsObject)};C.prototype=new T,C.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},C.roundTrips=2,C.need_body=!0;var A=k["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XDRObject)};A.prototype=new T,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var U=k["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRCorsObject)};U.prototype=new T,U.enabled=C.enabled,U.roundTrips=2;var q=k["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XDRObject)};q.prototype=new T,q.enabled=A.enabled,q.roundTrips=2;var B=function(){};B.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},B.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},B.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var r=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(r===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([k.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},B.prototype.postMessage=function(e,t){var r=this;r.iframeObj.post(r.window_id+e+(t||""),r.origin)},B.prototype.doSend=function(e){this.postMessage("m",e)},B.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var N,P=function(t,n){parent!==e?parent.postMessage(N+t+(n||""),"*"):r.log("Can't postMessage, no parent window.",t,n)},D=function(){};D.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},D.prototype._didMessage=function(e){P("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},r.parent_origin=void 0,k.bootstrap_iframe=function(){var n;N=t.location.hash.slice(1);var i=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var i=t.data.slice(0,8),o=t.data.slice(8,9),s=t.data.slice(9);if(i===N)switch(o){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==k.version&&r.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+k.version+'".'),!r.flatUrl(f)||!r.flatUrl(l))return void r.log("Only basic urls are supported in SockJS");if(!r.isSameOriginUrl(f)||!r.isSameOriginUrl(l))return void r.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");n=new D,n._transport=new D[c](n,f,l);break;case"m":n._doSend(s);break;case"c":n&&n._doCleanup(),n=null}}};r.attachMessage(i),P("s")};var W=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};W.prototype=new o(["finish"]),W.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=r.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var r=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var H=function(e){var n=this,i=function(){var t=new B;t.protocol="w-iframe-info-receiver";var r=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var r=JSON.parse(e.substr(1)),i=r[0],o=r[1];n.emit("finish",i,o)}else n.emit("finish");t.doCleanup(),t=null},i={_options:{},_didClose:r,_didMessage:r};t.i_constructor(i,e,e)};t.body?i():r.attachEvent("load",i)};H.prototype=new o(["finish"]);var F=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new o(["finish"]);var z=function(e){if(r.isSameOriginUrl(e))return new W(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new W(e,r.XHRLocalObject);case 2:return new W(e,r.XDRObject);case 3:return new H(e);default:return new F}},J=D["w-iframe-info-receiver"]=function(e,t,n){var i=new W(n,r.XHRLocalObject);i.onfinish=function(t,r){e._didMessage("m"+JSON.stringify([t,r])),e._didClose()}};J.prototype.doCleanup=function(){};var X=k["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};X.prototype=new B,X.enabled=function(){return"EventSource"in e&&B.enabled()},X.need_body=!0,X.roundTrips=3;var G=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,r.XHRLocalObject)};G.prototype=new T;var K=k["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};K.prototype=new B,K.enabled=function(){return e.XMLHttpRequest&&B.enabled()},K.need_body=!0,K.roundTrips=3;var Y=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRLocalObject)};Y.prototype=new T;var Q=k["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new B,Q.enabled=function(){return B.enabled()},Q.need_body=!0,Q.roundTrips=3;var $=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",re,r.XHRLocalObject)};$.prototype=new T;var V=function(e,t,r,n){var i=this;i.ri=e,i.Receiver=t,i.recv_url=r,i.AjaxObject=n,i._scheduleRecv()};V.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),r=0;t.onmessage=function(t){r+=1,e.ri._didMessage(t.data)},t.onclose=function(r){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===r.reason?e.ri._didClose(1006,"Polling error ("+r.reason+")"):e._scheduleRecv())}},V.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,o){var s=o?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Z.prototype=new n,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var ee,te=function(){if(void 0===ee)if("ActiveXObject"in e)try{ee=!!new ActiveXObject("htmlfile")}catch(t){}else ee=!1;return ee},re=function(t){var n=this;r.polluteGlobalNamespace(),n.id="a"+r.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+n.id);var o,s=te()?r.createHtmlfile:r.createIframe;e[a][n.id]={start:function(){o.loaded()},message:function(e){n.dispatchEvent(new i("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,r){o.cleanup(),n.iframe_close=o=null,delete e[a][n.id],n.dispatchEvent(new i("close",{reason:r}))},o=s(t,function(e){n.iframe_close({},"permanent")})};re.prototype=new n,re.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var ne=function(e,t){var r=this,n=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(n),s=o.indexOf("\n");if(-1===s)break;n+=s+1;var a=o.slice(0,s);r.dispatchEvent(new i("message",{data:a}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null;var n=200===e?"network":"permanent";r.dispatchEvent(new i("close",{reason:n}))}};return ne.prototype=new n,ne.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},k.getUtils=function(){return r},k.getIframeTransport=function(){return B},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}],94:[function(e,t,r){(function(r){function n(e,t,r,n,i,o,c,f){function l(e){if(f){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){f(null,JSON.parse(t))})}}var h=t?a:s;c["Content-Type"]="application/x-www-form-urlencoded";var p={hostname:r,port:n||(t?443:80),path:i,method:e,headers:c};if("GET"==e){var d=u.stringify(o);p.path+="?"+d,h.get(p,l).on("error",function(e){f(e)})}else{var g=h.request(p,l);g.setTimeout(5e3),g.on("timeout",function(){f&&f(new Error("timed out"),null),g.abort()}),g.on("error",function(e){f&&f(e,null)});var d=u.stringify(o);g.write(d),g.end()}}function i(e,t,r,n,i,s,a,c){var f=u.stringify(s),l=(t?"https://":"http://")+r+":"+n+i;"GET"==e&&(l+="?"+f);var h=o(e,l);h.withCredentials=!0,h.onload=function(){decoded="";try{var e=JSON.parse(h.responseText);c(null,e)}catch(t){c(null,JSON.parse(h.responseText))}},h.onerror=function(){c(h.statusText||"unknown error")},h.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(header_key in a)h.setRequestHeader(header_key,a[header_key]);h.send(f)}function o(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}var s=e("http"),a=e("https"),u=e("querystring");t.exports="browser"!==r.title?{request:n}:{request:i}}).call(this,e("_process"))},{_process:12,http:31,https:8,querystring:16}],95:[function(e,t,r){function n(e){if(0==e)return"";var t=Math.floor(62*Math.random())%62;return n(e-1)+i[t]}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.exports=n},{}],96:[function(e,t,r){function n(){}var i=e("./transporter");t.exports=n,n.format=function(e){var t="";e.params&&(e.value=e.params);try{t=i.decode(e.value)}catch(r){t=e.value}return{id:e.id,value:t?"string"==typeof t?JSON.parse(t):t:null,timestamp:e.timestamp}}},{"./transporter":106}],97:[function(e,t,r){function n(e,t){this.milkcocoa=e,this.idGenerator=e.idGenerator,this.path=t}var i=e("./streaming"),o=e("./streaming2"),s=e("./history"),a=e("./dataelement");t.exports=n,n.prototype.transporter=function(){return this.milkcocoa.transporter},n.prototype.push=function(e,t,r){var n=this;if(e instanceof Array)throw new Error("params must not be Array");if("object"!=typeof e)throw new Error("params must be object");this.idGenerator.getNextId(function(i,o){var s=n.milkcocoa.get_time();n.transporter().send_operation_request(n.path,"push",{id:o,ts:s,params:e},t,r)})},n.prototype.set=function(e,t,r,n){if("string"!=typeof e)throw new Error("id must be string");if(t instanceof Array)throw new Error("params must not be Array");if("object"!=typeof t)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"set",{path:this.path,id:e,params:t},r,n)},n.prototype.send=function(e,t,r){if("object"!=typeof e)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"send",{path:this.path,params:e},t,r)},n.prototype.remove=function(e,t,r){if("string"!=typeof e)throw new Error("id must be string");this.transporter().send_operation_request(this.path,"remove",{path:this.path,id:e},t,r)},n.prototype.get=function(e,t){if("string"!=typeof e)throw new Error("id must be string");this.transporter().call("get",{path:this.path,id:e},function(e,r){return r.err?void t(r.err):void t(null,a.format(r.content.d))})},n.prototype.get_many=function(e,t){this.transporter().call("get_many",{path:this.path,ids:JSON.stringify(e)},function(e,r){return r.err?void t(r.err):void t(null,r.content.d.map(a.format))})},n.prototype.count=function(e){e(new Error("deprecated"))},n.prototype.stream=function(){return new i(this.transporter(),this.path)},n.prototype.stream2=function(){return new o(this.transporter(),this.path)},n.prototype.history=function(){return new s(this.transporter(),this.path)},n.prototype.on=function(e,t){this.milkcocoa.listeners.add(e,this.path,t),this.transporter().on(this.path,e)},n.prototype.off=function(e){this.milkcocoa.listeners.del(e,this.path),this.transporter().off(this.path,e)},n.prototype.child=function(e){return new n(this.milkcocoa,this.path+"/"+e)}},{"./dataelement":96,"./history":98,"./streaming":104,"./streaming2":105}],98:[function(e,t,r){function n(e,t){this.stream=new i(e,t),this._times=1,this._limit=null,this._span=null,this.listeners={}}var i=e("./streaming2");n.prototype.sort=function(e){return this.stream.sort(e),this},n.prototype.size=function(e){return this.stream.size(e),this},n.prototype.times=function(e){return this._times=e,this},n.prototype.limit=function(e){return this._limit=e,this},n.prototype.span=function(e,t){return this._span={start:e,end:t},this},n.prototype.on=function(e,t){this.listeners[e]=t},n.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},n.prototype.runTimes=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e--,t.fire("data",n),void(e>0?t.runTimes(e):t.fire("end")))})},n.prototype.runLimit=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e-=n.length,0>e?"DESC"==t.stream.stream._sort?t.fire("data",n.slice(0,n.length+e)):t.fire("data",n.slice(0,n.length+e)):n.length>0&&t.fire("data",n),void(e>0&&n.length>0?t.runLimit(e):t.fire("end")))})},n.prototype.runSpan=function(e){var t=this;this.stream.next(function(r,n){if(r)return void t.fire("error",r);if("DESC"==t.stream.stream._sort)var i=function(t){return t.id>=e};else var i=function(t){return t.id<=e};var o=n.filter(i);o.length>0?(t.fire("data",o),t.runSpan(e)):t.fire("end")})},n.prototype.fire=function(e,t){this.listeners[e]&&this.listeners[e](t)},t.exports=n},{"./streaming2":105}],99:[function(e,t,r){(function(e){function r(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e%62,i=Math.floor(e/62);return 1>i?"":r(i)+t[n]}function n(){var t="ybfghijam6cpqdrw71nx34eo5suz0t9vkl28",n=(new Date).getTime(),i=n,o=null,s=[],a=0,u=1,c=a,f="0000";return{init:function(e){if(e&&"number"==typeof e){n=(new Date).getTime(),i=Math.floor(e/1e3);var t=r(i);f=t.substr(t.length-4)}},getHeader:function(e,t){var r=this,i=(new Date).getTime();if(o==i)setTimeout(function(){r.getHeader(e,t)},1);else{o=i;var s=i-n;t((e+s).toString(36))}},getNextId:function(e){s.push(e),c==a&&this._exec_getNextId()},_exec_getNextId:function(){var e=this,t=s.shift();t?(c=u,this._getNextId(function(r,n){t(r,n),e._exec_getNextId()})):c=a},_getNextId:function(r){function n(e){return 1>=e?t[Math.floor(36*Math.random())]:t[Math.floor(36*Math.random())]+n(e-1)}this.getHeader(i,function(t){var i=t+f+n(3);15!=i.length&&(e.console&&console.error("generated id is wrong.",i.length),i=i.substr(0,15)),r(null,i)})}}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(e,t,r){function n(){var e={push:{},set:{},remove:{},send:{}};return{add:function(t,r,n){e[t][r]||(e[t][r]=[]),e[t][r].push(n)},del:function(t,r){e[t][r]=[]},fire:function(t,r,n){e[t][r].forEach(function(e){e(n)})},get_subscribes:function(){var t=[];for(var r in e)for(var n in e[r])t.push({event:r,path:n});return t}}}t.exports=n},{}],101:[function(e,t,r){(function(e){t.exports="browser"!==e.title?{mode:!1,log:function(){this.mode&&console.log(arguments)},error:function(){this.mode&&console.error(arguments)}}:{mode:!1,log:function(){window.console&&this.mode&&console.log(arguments)},error:function(){window.console&&this.mode&&console.error(arguments)}}}).call(this,e("_process"))},{_process:12}],102:[function(e,t,r){(function(r){function n(e,t){if(this.host=e,this.option=t||{},this.file_path=this.option.file_path||"/var/lib/mlkcca",this.storage=new u(this.file_path),this.app_id=this.option.app_id||this.host.match(/([a-z0-9]+)\.mlkcca\.com/)[1],!this.app_id)throw new Error("app_id must be specified");this.option.clientId||(this.option.clientId="js"+this.app_id.substr(this.app_id.length-5)+c(16)),this.option.app_id=this.app_id,this.listeners=new o,this.idGenerator=new i,this.connect()}var i=e("./idgenerator"),o=e("./listeners"),s=e("./transporter"),a=e("./datastore"),u=(e("./logger"),e("./storage")),c=(e("./dataelement"),e("./clientid"));n.prototype.connect=function(e){function t(t){r.start_ts=(new Date).getTime(),r.idGenerator.init(t),r.server_ts=Math.floor(t/1e3),e&&e()}var r=this,n=null,i=this.storage.get("mlkcca_sid");i&&(n=i.sid),this.transporter=new s(this.host,this.option,n,t),this.transporter.onMessage(function(e){if(e.content.hasOwnProperty("params"))if("string"==typeof e.content.params)e.content.params=JSON.parse(e.content.params);else if("object"!=typeof e.content.params)throw new Error("unknown params");switch(e.event){case"push":r.listeners.fire("push",e.path,{id:e.content.id,path:e.path,value:e.content.params,timestamp:e.content.ts});break;case"set":r.listeners.fire("set",e.path,{id:e.content.id,path:e.path,value:e.content.params});break;case"remove":r.listeners.fire("remove",e.path,{id:e.content.id,path:e.path});break;case"send":r.listeners.fire("send",e.path,{path:e.path,value:e.content.params});break;case"success":console.log("success",e)}}),this.server_ts=(new Date).getTime(),this.start_ts=(new Date).getTime()},n.prototype.onConnected=function(e){this.transporter.onConnected(e);

},n.prototype.onClosed=function(e){this.transporter.onClosed(e)},n.prototype.onError=function(e){this.transporter.onError(e)},n.prototype.get_time=function(){var e=(new Date).getTime()-this.start_ts;return Math.floor(this.server_ts+e)},n.connectWithAuth=function(e,t,r){var i=r||{};i.token=t;var o=new n(e,i);return o.authWithToken(t,function(e){}),o},n.connectWithApiKey=function(e,t,r,i){var o=i||{};o.apikey=t,o.apisecret=r;var s=new n(e,o);return s},n.prototype.disconnect=function(e){this.transporter.disconnect(e)},n.prototype.reconnect=function(e){var t=this;this.transporter.disconnect(function(){t.connect(function(){t.listeners.get_subscribes().forEach(function(e){t.transporter.on(e.path,e.event)}),e&&e()})})},n.prototype.dataStore=function(e){if("string"!=typeof e)throw new Error("path must be string");return new a(this,e)},n.prototype.authWithToken=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginwithtoken",{token:e},function(e,n){return e?void t(e):n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.authAsAdmin=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginasadmin",{token:e},function(e,n){return n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.user=function(e){var t=this.storage.get("mlkcca_sid"),r={};t&&(r.mlkccasid=t.sid),this.transporter.auth_call("me",r,function(t,r){return r.err?void e(r.err):"notloggedin"==r.content.condition?void e(null,null):void e(r.err,r.content.account)})},n.prototype.getCurrentUser=function(e){this.user(e)},n.prototype.logout=function(e){var t=this,r=this.storage.get("mlkcca_sid"),n={};r&&(n.mlkccasid=r.sid),this.transporter.auth_call("logout",n,function(r){return r&&e?void e(r):void t.reconnect(e)})},"browser"!==r.title?t.exports=n:window.MilkCocoa=n}).call(this,e("_process"))},{"./clientid":95,"./dataelement":96,"./datastore":97,"./idgenerator":99,"./listeners":100,"./logger":101,"./storage":103,"./transporter":106,_process:12}],103:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r)^s;t.push(n.toString(36))}return t.join(",")}function i(e){var t=e.split(","),r="";return t.forEach(function(e){r+=String.fromCharCode(parseInt(e,36)^s)}),r}var o=e("./logger"),s=80,a=null;if("browser"!==r.title){var u=e("fs"),c=e("path");a=function(e){return{set:function(t,r){var i=c.join(e,t);u.writeFileSync(i,n(JSON.stringify(r)))},get:function(t){var r=c.join(e,t);if(!u.existsSync(r))return null;var n=u.readFileSync(r),s=null;try{s=JSON.parse(i(String(n)))}catch(a){o.error("parse error",a)}return s}}}}else a=function(){return{set:function(e,t){window.localStorage&&window.localStorage.setItem(e,n(JSON.stringify(t)))},get:function(e){if(!window.localStorage)return null;var t=window.localStorage.getItem(e),r=null;try{r=JSON.parse(i(t))}catch(n){o.error("parse error",n)}return r}}};t.exports=a}).call(this,e("_process"))},{"./logger":101,_process:12,fs:1,path:11}],104:[function(e,t,r){function n(e,t){this.transporter=e,this.path=t,this._current_id=null,this._size=50,this._sort="DESC",this.onData=null,this.onError=null}var i=e("./dataelement");t.exports=n,n.prototype.sort=n.prototype.order=function(e){return this._sort=e.toUpperCase(),this},n.prototype.size=n.prototype.limit=function(e){return e>999&&(e=999,window.console&&window.console.log("size too large")),this._size=e,this},n.prototype.onData=function(e){this.onData=e},n.prototype.onError=function(e){this.onError=e},n.prototype.next=function(e){return this.exec(e),this},n.prototype.setTimestamp=function(e){return this._current_id=e.toString(36),this},n.prototype.exec=function(e){var t=this,r={path:this.path,limit:this._size,sort:this._sort};this._current_id&&(r.th=this._current_id),this.transporter.call("query",r,function(r,n){if(r)return t.onError&&t.onError(n.err),void(e&&e(r,null));if(null!=n.err)return t.onError&&t.onError(n.err),void(e&&e(n.err,[]));var o=n.content.d.map(i.format);o=o.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),o.length>0&&(t._current_id="ASC"==t._sort?o[o.length-1].id:o[0].id),t.onData&&t.onData(o),e&&e(null,o)})}},{"./dataelement":96}],105:[function(e,t,r){function n(e,t){this.stream=new i(e,t)}var i=e("./streaming");n.prototype.sort=i.prototype.order=function(e){return this.stream.sort(e),this},n.prototype.size=i.prototype.limit=function(e){return this.stream.size(e),this},n.prototype.onData=function(e){this.stream.onData(e)},n.prototype.onError=function(e){this.stream.onError(e)},n.prototype.next=function(e){var t=this;return this.stream.next(function(r,n){null==r&&"DESC"==t.stream._sort?e(r,n.reverse()):e(r,n)}),this},n.prototype.setTimestamp=function(e){return this.stream.setTimestamp(e),this},t.exports=n},{"./streaming":104}],106:[function(e,t,r){(function(r){function n(e,t,n,s){function u(e){h._is_connected=!0,h.flush(),i.log("transporter:onopen",e),s&&s(e),h._onConnected&&h._onConnected()}function c(e){h._is_connected=!1,i.log("transporter:onclose",e),h._onClosed&&h._onClosed()}function f(e){i.log("transporter:onerror",e.message),h._onError&&h._onError(e)}function l(e,t){var r={};if(e==h.app_id+"/$sys/error"){var n=t.readUInt16BE(0),i=t.readUInt16BE(2);return void h.recvError(i,n)}try{r=JSON.parse(h.decode(t))}catch(o){r=JSON.parse(t)}var s=e.indexOf("/"),a=e.lastIndexOf("/"),u=e.substr(s+1,a-s-1),c=e.substr(a+1),f={path:u,event:c,content:r};h._onMessage(f)}var h=this;this.sid=n,this.queue=[],this.error_callbacks={},this.comp_callbacks={},this.request_id=1,this.app_id=t.app_id,this.host=e,this.port=t.port||443,this.http_port=t.http_port||443,this.useSSL=!0,this.qos=0;var p="s"+n||"dammy";t.token&&(p="j"+t.token),t.apikey&&t.apisecret&&(p="k"+t.apikey+":"+t.apisecret,this.apikey={key:t.apikey,secret:t.apisecret}),t.hasOwnProperty("qos")&&(this.qos=t.qos),t.hasOwnProperty("useSSL")&&(this.useSSL=t.useSSL);var d=(this.useSSL?"wss://":"ws://")+e+":"+this.port+"/websocket";"browser"!==r.title?(this.port=this.useSSL?8883:1883,d=(this.useSSL?"mqtts://":"mqtt://")+e+":"+this.port):o.isAndroidStandardBrowser()&&(d=(this.useSSL?"sockjss://":"sockjs://")+e+":"+this.port+"/sockjs"),this.client=a.connect(d,{username:p,clientId:t.clientId,password:t.app_id,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:7e3,clean:!1}),this.client.onConnectionLost=c,this.client.onMessageArrived=l,this.client.on("connect",u),this.client.on("close",c),this.client.on("error",f),this.client.on("message",l),this._is_connected=!1}var i=e("./logger"),o=e("./ua"),s=e("./ajax"),a=e("mqtt"),u=e("./dataelement");t.exports=n,n.prototype.encode=function(e){return e},n.decode=function(e){return decodeURIComponent(e)},n.prototype.decode=function(e){return n.decode(e)},n.prototype.onMessage=function(e){this._onMessage=e},n.prototype.onConnected=function(e){this._onConnected=e},n.prototype.onClosed=function(e){this._onClosed=e},n.prototype.onError=function(e){this._onError=e},n.prototype.auth_call=function(e,t,r){t.cmd=e,t.appid=this.app_id,s.request("POST",this.useSSL,this.host,this.http_port,"/auth",t,{},r)},n.prototype.call=function(e,t,r){t.api=e,t.appid=this.app_id;var n={};this.sid&&(n.Authorization="MLKCCASID "+this.sid),this.apikey&&(n.Authorization="MLKCCAKEY "+this.apikey.key+":"+this.apikey.secret),s.request("GET",this.useSSL,this.host,this.http_port,"/api",t,n,r)},n.prototype.on=function(e,t){this.send({type:"s",topic:this.create_topic(e,t)})},n.prototype.off=function(e,t){this.send({type:"u",topic:this.create_topic(e,t)})},n.prototype.send_operation_request=function(e,t,r,n,i){this.request_id++,this.request_id>12287&&(this.request_id=1),r.r=this.request_id,this.error_callbacks[this.request_id]=i,this.comp_callbacks[this.request_id]=n,this.send({type:"p",topic:this.create_topic(e,t),msg:JSON.stringify(r),request_id:this.request_id})},n.prototype.create_topic=function(e,t){return this.app_id+"/"+e+"/"+t},n.prototype.send=function(e){var t=this;t._is_connected?t.send_op(e):t.queue.push(e)},n.prototype.flush=function(){this.send_next()},n.prototype.send_next=function(){var e=this;if(e._is_connected){var t=e.queue.shift();t&&(e.send_op(t),e.send_next())}},n.prototype.send_op=function(e){var t=this;switch(e.type){case"p":var r=t.encode(e.msg);t.client.publish(e.topic,r,{qos:t.qos,retain:!1},function(r,n){t.recvComp(e.request_id,null,u.format(JSON.parse(e.msg)))});break;case"s":t.client.subscribe(e.topic,{qos:3==t.qos?0:t.qos});break;case"u":t.client.unsubscribe(e.topic)}},n.prototype.recvError=function(e,t){function r(e){switch(e){case 3:return"permission denied";default:return"unknown error"}}var n=r(t);this.error_callbacks[e]?(this.error_callbacks[e](n),delete this.error_callbacks[e]):this._onError&&this._onError(n)},n.prototype.recvComp=function(e,t,r){this.comp_callbacks[e]&&this.comp_callbacks[e](t,r),delete this.comp_callbacks[e]},n.prototype.disconnect=function(e){this.client.end(e)}}).call(this,e("_process"))},{"./ajax":94,"./dataelement":96,"./logger":101,"./ua":107,_process:12,mqtt:46}],107:[function(e,t,r){t.exports={isAndroidStandardBrowser:function(){var e=navigator.userAgent;return e.indexOf("Android")>=0&&e.indexOf("Chrome")<0&&e.indexOf("Firefox")<0?!0:e.indexOf("MSIE 10")>=0?!0:!1}}},{}]},{},[102]);","ﾂ�":"\\u008b","ﾂ�":"\\u008c","ﾂ�":"\\u008d","ﾂ�":"\\u008e","ﾂ�":"\\u008f","ﾂ�":"\\u0090","ﾂ�":"\\u0091","ﾂ�":"\\u0092","ﾂ�":"\\u0093","ﾂ�":"\\u0094","ﾂ�":"\\u0095","ﾂ�":"\\u0096","ﾂ�":"\\u0097","ﾂ�":"\\u0098","ﾂ�":"\\u0099","ﾂ�":"\\u009a","ﾂ�":"\\u009b","ﾂ�":"\\u009c","ﾂ�":"\\u009d","ﾂ�":"\\u009e","ﾂ�":"\\u009f","ﾂｭ":"\\u00ad","ﾘ":"\\u0600","ﾘ�":"\\u0601","ﾘ�":"\\u0602","ﾘ�":"\\u0603","ﾘ�":"\\u0604","ﾜ�":"\\u070f","癰ｴ":"\\u17b4","癰ｵ":"\\u17b5","窶�":"\\u200c","窶�":"\\u200d","窶�":"\\u200e","窶�":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","窶ｪ":"\\u202a","窶ｫ":"\\u202b","窶ｬ":"\\u202c","窶ｭ":"\\u202d","窶ｮ":"\\u202e","窶ｯ":"\\u202f","竅�":"\\u2060","竅｡":"\\u2061","竅｢":"\\u2062","竅｣":"\\u2063","竅､":"\\u2064","竅･":"\\u2065","竅ｦ":"\\u2066","竅ｧ":"\\u2067","竅ｨ":"\\u2068","竅ｩ":"\\u2069","竅ｪ":"\\u206a","竅ｫ":"\\u206b","竅ｬ":"\\u206c","竅ｭ":"\\u206d","竅ｮ":"\\u206e","竅ｯ":"\\u206f","\ufeff":"\\ufeff","�ｰ":"\\ufff0","�ｱ":"\\ufff1","�ｲ":"\\ufff2","�ｳ":"\\ufff3","�ｴ":"\\ufff4","�ｵ":"\\ufff5","�ｶ":"\\ufff6","�ｷ":"\\ufff7","�ｸ":"\\ufff8","�ｹ":"\\ufff9","�ｺ":"\\ufffa","�ｻ":"\\ufffb","�ｼ":"\\ufffc","�ｽ":"\\ufffd","�ｾ":"\\ufffe","�ｿ":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h=JSON&&JSON.stringify||function(e){
return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,r={},n=[];for(t=0;65536>t;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return r[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,r};r.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(u||(u=p(l)),t.replace(l,function(e){return u[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){for(var e={},t=0;t<d.length;t++){var r=d[t];e[r]=k[r]&&k[r].enabled()}return e},r.detectProtocols=function(e,t,r){var n={},i=[];t||(t=d);for(var o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}var a=function(e){var t=e.shift();n[t]?i.push(t):e.length>0&&a(e)};return r.websocket!==!1&&a(["websocket"]),n["xhr-streaming"]&&!r.null_origin?i.push("xhr-streaming"):!n["xdr-streaming"]||r.cookie_needed||r.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),n["xhr-polling"]&&!r.null_origin?i.push("xhr-polling"):!n["xdr-polling"]||r.cookie_needed||r.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";r.createHook=function(){var t="a"+r.random_string(8);if(!(g in e)){var n={};e[g]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return e[g](t)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.addEventListener(r,n,!1):(t.attachEvent("on"+r,n),e.attachEvent("on"+r,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.removeEventListener(r,n,!1):(t.detachEvent("on"+r,n),e.detachEvent("on"+r,n))};var m={},v=!1,b=function(){for(var e in m)m[e](),delete m[e]},_=function(){v||(v=!0,b())};r.attachEvent("unload",_),r.unload_add=function(e){var t=r.random_string(8);return m[t]=e,v&&r.delay(b),t},r.unload_del=function(e){e in m&&delete m[e]},r.createIframe=function(e,n){var i,o,s=t.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unload_del(o))},c=function(e){s&&(u(),n(e))},f=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),i=setTimeout(function(){c("timeout")},15e3),o=r.unload_add(u),{post:f,cleanup:u,loaded:a}},r.createHtmlfile=function(t,n){var i,o,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},f=function(){u&&(c(),r.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(e){u&&(f(),n(e))},h=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var p=u.createElement("div");return u.body.appendChild(p),s=u.createElement("iframe"),p.appendChild(s),s.src=t,i=setTimeout(function(){l("timeout")},15e3),o=r.unload_add(f),{post:h,cleanup:f,loaded:c}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(t,n,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=r.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,n,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var c in o.headers)s.xhr.setRequestHeader(c,o.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,r=e.responseText}catch(e){}1223===t&&(t=204),r&&r.length>0&&s.emit("chunk",t,r);break;case 4:var t=e.status;1223===t&&(t=204),s.emit("finish",t,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};S.prototype=new y;var E=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,n){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:B.enabled()?3:4};var k=function(t,n,i){if(this===e)return new k(t,n,i);var o,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&r.objectExtend(s._options,i),s._base_url=r.amendUrl(t),s._server=s._options.server||r.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?o=s._options.protocols_whitelist:(o="string"==typeof n&&n.length>0?[n]:r.isArray(n)?n:null,o&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=z(s._base_url),s._ir.onfinish=function(e,t){s._ir=null,e?(s._options.info&&(e=r.objectExtend(e,s._options.info)),s._options.rtt&&(t=s._options.rtt),s._applyInfo(e,t,o),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new n,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},k.prototype._dispatchOpen=function(){var e=this;e.readyState===k.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=k.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("message",{data:e}))},k.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},k.prototype._didClose=function(e,t,n){var o=this;if(o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN&&o.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:r.userSetCode(e)});if(!r.userSetCode(e)&&o.readyState===k.CONNECTING&&!n){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=k.CLOSED,r.delay(function(){o.dispatchEvent(s)})},k.prototype._didMessage=function(e){var t=this,r=e.slice(0,1);switch(r){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var i=n.protocol=n._protocols.shift();if(!i)return!1;if(k[i]&&k[i].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(i),n.protocol="waiting-for-load",r.attachEvent("load",function(){n._try_next_protocol()}),!0;if(k[i]&&k[i].enabled(n._options)){var o=k[i].roundTrips||1,s=(n._options.rto||0)*o||5e3;n._transport_tref=r.delay(s,function(){n.readyState===k.CONNECTING&&n._didClose(2007,"Transport timeouted")});var a=r.random_string(8),u=n._base_url+"/"+n._server+"/"+a;return n._debug("Opening transport:",i," url:"+u," RTO:"+n._options.rto),n._transport=new k[i](n,u,n._base_url),!0}n._debug("Skipping transport:",i)}},k.prototype.close=function(e,t){var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==k.CONNECTING&&n.readyState!==k.OPEN?!1:(n.readyState=k.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},k.prototype.send=function(e){var t=this;if(t.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===k.OPEN&&t._transport.doSend(r.quote(""+e)),!0},k.prototype._applyInfo=function(e,n,i){var o=this;o._options.info=e,o._options.rtt=n,o._options.rto=r.countRTO(n),o._options.info.null_origin=!t.domain;var s=r.probeProtocols();o._protocols=r.detectProtocols(s,i,e)};var x=k.websocket=function(t,n){var i=this,o=n+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=t,i.url=o;var s=e.WebSocket||e.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=r.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(e){this.ws.send("["+e+"]")},x.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var j=function(){};j.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},j.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},j.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},j.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,r){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+r):e.send_schedule_wait()}),e.send_buffer=[]}},j.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(e,n,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=t.createElement("form"),a=o._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+r.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=n}catch(l){r.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var h=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,r.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",i(!0))};return c.onerror=c.onload=h,c.onreadystatechange=function(e){"complete"==c.readyState&&h()},h},M=function(e){return function(t,r,n){var i=new e("POST",t+"/xhr_send",r);return i.onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},O=function(e,n){var i,o,s=t.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,n(e),n=null)},u=!1,c=null;if(s.id="a"+r.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){c||(c=setTimeout(function(){u||a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))o=t.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),o&&l.insertBefore(o,l.firstChild),a},R=k["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(I),n._schedule_recv()};R.prototype=new j,R.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",O,t)},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(t,n,i){var o="a"+r.random_string(6),s=t+"?c="+escape(a+"."+o),u=0,c=function(t){switch(u){case 0:delete e[a][o],i(t);break;case 1:i(t),u=2;break;case 2:delete e[a][o]}},f=n(s,c);e[a][o]=f;var l=function(){e[a][o]&&(u=1,e[a][o](r.closeFrame(1e3,"JSONP user aborted read")))};return l},T=function(){};T.prototype=new j,T.prototype.run=function(e,t,r,n,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(M(i)),o.poll=new V(e,n,t+r,i)},T.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var C=k["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XHRCorsObject)};C.prototype=new T,C.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},C.roundTrips=2,C.need_body=!0;var A=k["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XDRObject)};A.prototype=new T,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var U=k["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRCorsObject)};U.prototype=new T,U.enabled=C.enabled,U.roundTrips=2;var q=k["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XDRObject)};q.prototype=new T,q.enabled=A.enabled,q.roundTrips=2;var B=function(){};B.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},B.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},B.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var r=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(r===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([k.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},B.prototype.postMessage=function(e,t){var r=this;r.iframeObj.post(r.window_id+e+(t||""),r.origin)},B.prototype.doSend=function(e){this.postMessage("m",e)},B.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var N,P=function(t,n){parent!==e?parent.postMessage(N+t+(n||""),"*"):r.log("Can't postMessage, no parent window.",t,n)},D=function(){};D.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},D.prototype._didMessage=function(e){P("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},r.parent_origin=void 0,k.bootstrap_iframe=function(){var n;N=t.location.hash.slice(1);var i=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var i=t.data.slice(0,8),o=t.data.slice(8,9),s=t.data.slice(9);if(i===N)switch(o){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==k.version&&r.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+k.version+'".'),!r.flatUrl(f)||!r.flatUrl(l))return void r.log("Only basic urls are supported in SockJS");if(!r.isSameOriginUrl(f)||!r.isSameOriginUrl(l))return void r.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");n=new D,n._transport=new D[c](n,f,l);break;case"m":n._doSend(s);break;case"c":n&&n._doCleanup(),n=null}}};r.attachMessage(i),P("s")};var W=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};W.prototype=new o(["finish"]),W.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=r.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var r=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var H=function(e){var n=this,i=function(){var t=new B;t.protocol="w-iframe-info-receiver";var r=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var r=JSON.parse(e.substr(1)),i=r[0],o=r[1];n.emit("finish",i,o)}else n.emit("finish");t.doCleanup(),t=null},i={_options:{},_didClose:r,_didMessage:r};t.i_constructor(i,e,e)};t.body?i():r.attachEvent("load",i)};H.prototype=new o(["finish"]);var F=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new o(["finish"]);var z=function(e){if(r.isSameOriginUrl(e))return new W(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new W(e,r.XHRLocalObject);case 2:return new W(e,r.XDRObject);case 3:return new H(e);default:return new F}},J=D["w-iframe-info-receiver"]=function(e,t,n){var i=new W(n,r.XHRLocalObject);i.onfinish=function(t,r){e._didMessage("m"+JSON.stringify([t,r])),e._didClose()}};J.prototype.doCleanup=function(){};var X=k["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};X.prototype=new B,X.enabled=function(){return"EventSource"in e&&B.enabled()},X.need_body=!0,X.roundTrips=3;var G=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,r.XHRLocalObject)};G.prototype=new T;var K=k["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};K.prototype=new B,K.enabled=function(){return e.XMLHttpRequest&&B.enabled()},K.need_body=!0,K.roundTrips=3;var Y=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRLocalObject)};Y.prototype=new T;var Q=k["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new B,Q.enabled=function(){return B.enabled()},Q.need_body=!0,Q.roundTrips=3;var $=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",re,r.XHRLocalObject)};$.prototype=new T;var V=function(e,t,r,n){var i=this;i.ri=e,i.Receiver=t,i.recv_url=r,i.AjaxObject=n,i._scheduleRecv()};V.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),r=0;t.onmessage=function(t){r+=1,e.ri._didMessage(t.data)},t.onclose=function(r){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===r.reason?e.ri._didClose(1006,"Polling error ("+r.reason+")"):e._scheduleRecv())}},V.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,o){var s=o?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Z.prototype=new n,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var ee,te=function(){if(void 0===ee)if("ActiveXObject"in e)try{ee=!!new ActiveXObject("htmlfile")}catch(t){}else ee=!1;return ee},re=function(t){var n=this;r.polluteGlobalNamespace(),n.id="a"+r.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+n.id);var o,s=te()?r.createHtmlfile:r.createIframe;e[a][n.id]={start:function(){o.loaded()},message:function(e){n.dispatchEvent(new i("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,r){o.cleanup(),n.iframe_close=o=null,delete e[a][n.id],n.dispatchEvent(new i("close",{reason:r}))},o=s(t,function(e){n.iframe_close({},"permanent")})};re.prototype=new n,re.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var ne=function(e,t){var r=this,n=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(n),s=o.indexOf("\n");if(-1===s)break;n+=s+1;var a=o.slice(0,s);r.dispatchEvent(new i("message",{data:a}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null;var n=200===e?"network":"permanent";r.dispatchEvent(new i("close",{reason:n}))}};return ne.prototype=new n,ne.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},k.getUtils=function(){return r},k.getIframeTransport=function(){return B},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}],94:[function(e,t,r){(function(r){function n(e,t,r,n,i,o,c,f){function l(e){if(f){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){f(null,JSON.parse(t))})}}var h=t?a:s;c["Content-Type"]="application/x-www-form-urlencoded";var p={hostname:r,port:n||(t?443:80),path:i,method:e,headers:c};if("GET"==e){var d=u.stringify(o);p.path+="?"+d,h.get(p,l).on("error",function(e){f(e)})}else{var g=h.request(p,l);g.setTimeout(5e3),g.on("timeout",function(){f&&f(new Error("timed out"),null),g.abort()}),g.on("error",function(e){f&&f(e,null)});var d=u.stringify(o);g.write(d),g.end()}}function i(e,t,r,n,i,s,a,c){var f=u.stringify(s),l=(t?"https://":"http://")+r+":"+n+i;"GET"==e&&(l+="?"+f);var h=o(e,l);h.withCredentials=!0,h.onload=function(){decoded="";try{var e=JSON.parse(h.responseText);c(null,e)}catch(t){c(null,JSON.parse(h.responseText))}},h.onerror=function(){c(h.statusText||"unknown error")},h.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(header_key in a)h.setRequestHeader(header_key,a[header_key]);h.send(f)}function o(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}var s=e("http"),a=e("https"),u=e("querystring");t.exports="browser"!==r.title?{request:n}:{request:i}}).call(this,e("_process"))},{_process:12,http:31,https:8,querystring:16}],95:[function(e,t,r){function n(e){if(0==e)return"";var t=Math.floor(62*Math.random())%62;return n(e-1)+i[t]}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.exports=n},{}],96:[function(e,t,r){function n(){}var i=e("./transporter");t.exports=n,n.format=function(e){var t="";e.params&&(e.value=e.params);try{t=i.decode(e.value)}catch(r){t=e.value}return{id:e.id,value:t?"string"==typeof t?JSON.parse(t):t:null,timestamp:e.timestamp}}},{"./transporter":106}],97:[function(e,t,r){function n(e,t){this.milkcocoa=e,this.idGenerator=e.idGenerator,this.path=t}var i=e("./streaming"),o=e("./streaming2"),s=e("./history"),a=e("./dataelement");t.exports=n,n.prototype.transporter=function(){return this.milkcocoa.transporter},n.prototype.push=function(e,t,r){var n=this;if(e instanceof Array)throw new Error("params must not be Array");if("object"!=typeof e)throw new Error("params must be object");this.idGenerator.getNextId(function(i,o){var s=n.milkcocoa.get_time();n.transporter().send_operation_request(n.path,"push",{id:o,ts:s,params:e},t,r)})},n.prototype.set=function(e,t,r,n){if("string"!=typeof e)throw new Error("id must be string");if(t instanceof Array)throw new Error("params must not be Array");if("object"!=typeof t)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"set",{path:this.path,id:e,params:t},r,n)},n.prototype.send=function(e,t,r){if("object"!=typeof e)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"send",{path:this.path,params:e},t,r)},n.prototype.remove=function(e,t,r){if("string"!=typeof e)throw new Error("id must be string");this.transporter().send_operation_request(this.path,"remove",{path:this.path,id:e},t,r)},n.prototype.get=function(e,t){if("string"!=typeof e)throw new Error("id must be string");this.transporter().call("get",{path:this.path,id:e},function(e,r){return r.err?void t(r.err):void t(null,a.format(r.content.d))})},n.prototype.get_many=function(e,t){this.transporter().call("get_many",{path:this.path,ids:JSON.stringify(e)},function(e,r){return r.err?void t(r.err):void t(null,r.content.d.map(a.format))})},n.prototype.count=function(e){e(new Error("deprecated"))},n.prototype.stream=function(){return new i(this.transporter(),this.path)},n.prototype.stream2=function(){return new o(this.transporter(),this.path)},n.prototype.history=function(){return new s(this.transporter(),this.path)},n.prototype.on=function(e,t){this.milkcocoa.listeners.add(e,this.path,t),this.transporter().on(this.path,e)},n.prototype.off=function(e){this.milkcocoa.listeners.del(e,this.path),this.transporter().off(this.path,e)},n.prototype.child=function(e){return new n(this.milkcocoa,this.path+"/"+e)}},{"./dataelement":96,"./history":98,"./streaming":104,"./streaming2":105}],98:[function(e,t,r){function n(e,t){this.stream=new i(e,t),this._times=1,this._limit=null,this._span=null,this.listeners={}}var i=e("./streaming2");n.prototype.sort=function(e){return this.stream.sort(e),this},n.prototype.size=function(e){return this.stream.size(e),this},n.prototype.times=function(e){return this._times=e,this},n.prototype.limit=function(e){return this._limit=e,this},n.prototype.span=function(e,t){return this._span={start:e,end:t},this},n.prototype.on=function(e,t){this.listeners[e]=t},n.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},n.prototype.runTimes=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e--,t.fire("data",n),void(e>0?t.runTimes(e):t.fire("end")))})},n.prototype.runLimit=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e-=n.length,0>e?"DESC"==t.stream.stream._sort?t.fire("data",n.slice(0,n.length+e)):t.fire("data",n.slice(0,n.length+e)):n.length>0&&t.fire("data",n),void(e>0&&n.length>0?t.runLimit(e):t.fire("end")))})},n.prototype.runSpan=function(e){var t=this;this.stream.next(function(r,n){if(r)return void t.fire("error",r);if("DESC"==t.stream.stream._sort)var i=function(t){return t.id>=e};else var i=function(t){return t.id<=e};var o=n.filter(i);o.length>0?(t.fire("data",o),t.runSpan(e)):t.fire("end")})},n.prototype.fire=function(e,t){this.listeners[e]&&this.listeners[e](t)},t.exports=n},{"./streaming2":105}],99:[function(e,t,r){(function(e){function r(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e%62,i=Math.floor(e/62);return 1>i?"":r(i)+t[n]}function n(){var t="ybfghijam6cpqdrw71nx34eo5suz0t9vkl28",n=(new Date).getTime(),i=n,o=null,s=[],a=0,u=1,c=a,f="0000";return{init:function(e){if(e&&"number"==typeof e){n=(new Date).getTime(),i=Math.floor(e/1e3);var t=r(i);f=t.substr(t.length-4)}},getHeader:function(e,t){var r=this,i=(new Date).getTime();if(o==i)setTimeout(function(){r.getHeader(e,t)},1);else{o=i;var s=i-n;t((e+s).toString(36))}},getNextId:function(e){s.push(e),c==a&&this._exec_getNextId()},_exec_getNextId:function(){var e=this,t=s.shift();t?(c=u,this._getNextId(function(r,n){t(r,n),e._exec_getNextId()})):c=a},_getNextId:function(r){function n(e){return 1>=e?t[Math.floor(36*Math.random())]:t[Math.floor(36*Math.random())]+n(e-1)}this.getHeader(i,function(t){var i=t+f+n(3);15!=i.length&&(e.console&&console.error("generated id is wrong.",i.length),i=i.substr(0,15)),r(null,i)})}}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(e,t,r){function n(){var e={push:{},set:{},remove:{},send:{}};return{add:function(t,r,n){e[t][r]||(e[t][r]=[]),e[t][r].push(n)},del:function(t,r){e[t][r]=[]},fire:function(t,r,n){e[t][r].forEach(function(e){e(n)})},get_subscribes:function(){var t=[];for(var r in e)for(var n in e[r])t.push({event:r,path:n});return t}}}t.exports=n},{}],101:[function(e,t,r){(function(e){t.exports="browser"!==e.title?{mode:!1,log:function(){this.mode&&console.log(arguments)},error:function(){this.mode&&console.error(arguments)}}:{mode:!1,log:function(){window.console&&this.mode&&console.log(arguments)},error:function(){window.console&&this.mode&&console.error(arguments)}}}).call(this,e("_process"))},{_process:12}],102:[function(e,t,r){(function(r){function n(e,t){if(this.host=e,this.option=t||{},this.file_path=this.option.file_path||"/var/lib/mlkcca",this.storage=new u(this.file_path),this.app_id=this.option.app_id||this.host.match(/([a-z0-9]+)\.mlkcca\.com/)[1],!this.app_id)throw new Error("app_id must be specified");this.option.clientId||(this.option.clientId="js"+this.app_id.substr(this.app_id.length-5)+c(16)),this.option.app_id=this.app_id,this.listeners=new o,this.idGenerator=new i,this.connect()}var i=e("./idgenerator"),o=e("./listeners"),s=e("./transporter"),a=e("./datastore"),u=(e("./logger"),e("./storage")),c=(e("./dataelement"),e("./clientid"));n.prototype.connect=function(e){function t(t){r.start_ts=(new Date).getTime(),r.idGenerator.init(t),r.server_ts=Math.floor(t/1e3),e&&e()}var r=this,n=null,i=this.storage.get("mlkcca_sid");i&&(n=i.sid),this.transporter=new s(this.host,this.option,n,t),this.transporter.onMessage(function(e){if(e.content.hasOwnProperty("params"))if("string"==typeof e.content.params)e.content.params=JSON.parse(e.content.params);else if("object"!=typeof e.content.params)throw new Error("unknown params");switch(e.event){case"push":r.listeners.fire("push",e.path,{id:e.content.id,path:e.path,value:e.content.params,timestamp:e.content.ts});break;case"set":r.listeners.fire("set",e.path,{id:e.content.id,path:e.path,value:e.content.params});break;case"remove":r.listeners.fire("remove",e.path,{id:e.content.id,path:e.path});break;case"send":r.listeners.fire("send",e.path,{path:e.path,value:e.content.params});break;case"success":console.log("success",e)}}),this.server_ts=(new Date).getTime(),this.start_ts=(new Date).getTime()},n.prototype.onConnected=function(e){this.transporter.onConnected(e);

},n.prototype.onClosed=function(e){this.transporter.onClosed(e)},n.prototype.onError=function(e){this.transporter.onError(e)},n.prototype.get_time=function(){var e=(new Date).getTime()-this.start_ts;return Math.floor(this.server_ts+e)},n.connectWithAuth=function(e,t,r){var i=r||{};i.token=t;var o=new n(e,i);return o.authWithToken(t,function(e){}),o},n.connectWithApiKey=function(e,t,r,i){var o=i||{};o.apikey=t,o.apisecret=r;var s=new n(e,o);return s},n.prototype.disconnect=function(e){this.transporter.disconnect(e)},n.prototype.reconnect=function(e){var t=this;this.transporter.disconnect(function(){t.connect(function(){t.listeners.get_subscribes().forEach(function(e){t.transporter.on(e.path,e.event)}),e&&e()})})},n.prototype.dataStore=function(e){if("string"!=typeof e)throw new Error("path must be string");return new a(this,e)},n.prototype.authWithToken=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginwithtoken",{token:e},function(e,n){return e?void t(e):n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.authAsAdmin=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginasadmin",{token:e},function(e,n){return n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.user=function(e){var t=this.storage.get("mlkcca_sid"),r={};t&&(r.mlkccasid=t.sid),this.transporter.auth_call("me",r,function(t,r){return r.err?void e(r.err):"notloggedin"==r.content.condition?void e(null,null):void e(r.err,r.content.account)})},n.prototype.getCurrentUser=function(e){this.user(e)},n.prototype.logout=function(e){var t=this,r=this.storage.get("mlkcca_sid"),n={};r&&(n.mlkccasid=r.sid),this.transporter.auth_call("logout",n,function(r){return r&&e?void e(r):void t.reconnect(e)})},"browser"!==r.title?t.exports=n:window.MilkCocoa=n}).call(this,e("_process"))},{"./clientid":95,"./dataelement":96,"./datastore":97,"./idgenerator":99,"./listeners":100,"./logger":101,"./storage":103,"./transporter":106,_process:12}],103:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r)^s;t.push(n.toString(36))}return t.join(",")}function i(e){var t=e.split(","),r="";return t.forEach(function(e){r+=String.fromCharCode(parseInt(e,36)^s)}),r}var o=e("./logger"),s=80,a=null;if("browser"!==r.title){var u=e("fs"),c=e("path");a=function(e){return{set:function(t,r){var i=c.join(e,t);u.writeFileSync(i,n(JSON.stringify(r)))},get:function(t){var r=c.join(e,t);if(!u.existsSync(r))return null;var n=u.readFileSync(r),s=null;try{s=JSON.parse(i(String(n)))}catch(a){o.error("parse error",a)}return s}}}}else a=function(){return{set:function(e,t){window.localStorage&&window.localStorage.setItem(e,n(JSON.stringify(t)))},get:function(e){if(!window.localStorage)return null;var t=window.localStorage.getItem(e),r=null;try{r=JSON.parse(i(t))}catch(n){o.error("parse error",n)}return r}}};t.exports=a}).call(this,e("_process"))},{"./logger":101,_process:12,fs:1,path:11}],104:[function(e,t,r){function n(e,t){this.transporter=e,this.path=t,this._current_id=null,this._size=50,this._sort="DESC",this.onData=null,this.onError=null}var i=e("./dataelement");t.exports=n,n.prototype.sort=n.prototype.order=function(e){return this._sort=e.toUpperCase(),this},n.prototype.size=n.prototype.limit=function(e){return e>999&&(e=999,window.console&&window.console.log("size too large")),this._size=e,this},n.prototype.onData=function(e){this.onData=e},n.prototype.onError=function(e){this.onError=e},n.prototype.next=function(e){return this.exec(e),this},n.prototype.setTimestamp=function(e){return this._current_id=e.toString(36),this},n.prototype.exec=function(e){var t=this,r={path:this.path,limit:this._size,sort:this._sort};this._current_id&&(r.th=this._current_id),this.transporter.call("query",r,function(r,n){if(r)return t.onError&&t.onError(n.err),void(e&&e(r,null));if(null!=n.err)return t.onError&&t.onError(n.err),void(e&&e(n.err,[]));var o=n.content.d.map(i.format);o=o.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),o.length>0&&(t._current_id="ASC"==t._sort?o[o.length-1].id:o[0].id),t.onData&&t.onData(o),e&&e(null,o)})}},{"./dataelement":96}],105:[function(e,t,r){function n(e,t){this.stream=new i(e,t)}var i=e("./streaming");n.prototype.sort=i.prototype.order=function(e){return this.stream.sort(e),this},n.prototype.size=i.prototype.limit=function(e){return this.stream.size(e),this},n.prototype.onData=function(e){this.stream.onData(e)},n.prototype.onError=function(e){this.stream.onError(e)},n.prototype.next=function(e){var t=this;return this.stream.next(function(r,n){null==r&&"DESC"==t.stream._sort?e(r,n.reverse()):e(r,n)}),this},n.prototype.setTimestamp=function(e){return this.stream.setTimestamp(e),this},t.exports=n},{"./streaming":104}],106:[function(e,t,r){(function(r){function n(e,t,n,s){function u(e){h._is_connected=!0,h.flush(),i.log("transporter:onopen",e),s&&s(e),h._onConnected&&h._onConnected()}function c(e){h._is_connected=!1,i.log("transporter:onclose",e),h._onClosed&&h._onClosed()}function f(e){i.log("transporter:onerror",e.message),h._onError&&h._onError(e)}function l(e,t){var r={};if(e==h.app_id+"/$sys/error"){var n=t.readUInt16BE(0),i=t.readUInt16BE(2);return void h.recvError(i,n)}try{r=JSON.parse(h.decode(t))}catch(o){r=JSON.parse(t)}var s=e.indexOf("/"),a=e.lastIndexOf("/"),u=e.substr(s+1,a-s-1),c=e.substr(a+1),f={path:u,event:c,content:r};h._onMessage(f)}var h=this;this.sid=n,this.queue=[],this.error_callbacks={},this.comp_callbacks={},this.request_id=1,this.app_id=t.app_id,this.host=e,this.port=t.port||443,this.http_port=t.http_port||443,this.useSSL=!0,this.qos=0;var p="s"+n||"dammy";t.token&&(p="j"+t.token),t.apikey&&t.apisecret&&(p="k"+t.apikey+":"+t.apisecret,this.apikey={key:t.apikey,secret:t.apisecret}),t.hasOwnProperty("qos")&&(this.qos=t.qos),t.hasOwnProperty("useSSL")&&(this.useSSL=t.useSSL);var d=(this.useSSL?"wss://":"ws://")+e+":"+this.port+"/websocket";"browser"!==r.title?(this.port=this.useSSL?8883:1883,d=(this.useSSL?"mqtts://":"mqtt://")+e+":"+this.port):o.isAndroidStandardBrowser()&&(d=(this.useSSL?"sockjss://":"sockjs://")+e+":"+this.port+"/sockjs"),this.client=a.connect(d,{username:p,clientId:t.clientId,password:t.app_id,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:7e3,clean:!1}),this.client.onConnectionLost=c,this.client.onMessageArrived=l,this.client.on("connect",u),this.client.on("close",c),this.client.on("error",f),this.client.on("message",l),this._is_connected=!1}var i=e("./logger"),o=e("./ua"),s=e("./ajax"),a=e("mqtt"),u=e("./dataelement");t.exports=n,n.prototype.encode=function(e){return e},n.decode=function(e){return decodeURIComponent(e)},n.prototype.decode=function(e){return n.decode(e)},n.prototype.onMessage=function(e){this._onMessage=e},n.prototype.onConnected=function(e){this._onConnected=e},n.prototype.onClosed=function(e){this._onClosed=e},n.prototype.onError=function(e){this._onError=e},n.prototype.auth_call=function(e,t,r){t.cmd=e,t.appid=this.app_id,s.request("POST",this.useSSL,this.host,this.http_port,"/auth",t,{},r)},n.prototype.call=function(e,t,r){t.api=e,t.appid=this.app_id;var n={};this.sid&&(n.Authorization="MLKCCASID "+this.sid),this.apikey&&(n.Authorization="MLKCCAKEY "+this.apikey.key+":"+this.apikey.secret),s.request("GET",this.useSSL,this.host,this.http_port,"/api",t,n,r)},n.prototype.on=function(e,t){this.send({type:"s",topic:this.create_topic(e,t)})},n.prototype.off=function(e,t){this.send({type:"u",topic:this.create_topic(e,t)})},n.prototype.send_operation_request=function(e,t,r,n,i){this.request_id++,this.request_id>12287&&(this.request_id=1),r.r=this.request_id,this.error_callbacks[this.request_id]=i,this.comp_callbacks[this.request_id]=n,this.send({type:"p",topic:this.create_topic(e,t),msg:JSON.stringify(r),request_id:this.request_id})},n.prototype.create_topic=function(e,t){return this.app_id+"/"+e+"/"+t},n.prototype.send=function(e){var t=this;t._is_connected?t.send_op(e):t.queue.push(e)},n.prototype.flush=function(){this.send_next()},n.prototype.send_next=function(){var e=this;if(e._is_connected){var t=e.queue.shift();t&&(e.send_op(t),e.send_next())}},n.prototype.send_op=function(e){var t=this;switch(e.type){case"p":var r=t.encode(e.msg);t.client.publish(e.topic,r,{qos:t.qos,retain:!1},function(r,n){t.recvComp(e.request_id,null,u.format(JSON.parse(e.msg)))});break;case"s":t.client.subscribe(e.topic,{qos:3==t.qos?0:t.qos});break;case"u":t.client.unsubscribe(e.topic)}},n.prototype.recvError=function(e,t){function r(e){switch(e){case 3:return"permission denied";default:return"unknown error"}}var n=r(t);this.error_callbacks[e]?(this.error_callbacks[e](n),delete this.error_callbacks[e]):this._onError&&this._onError(n)},n.prototype.recvComp=function(e,t,r){this.comp_callbacks[e]&&this.comp_callbacks[e](t,r),delete this.comp_callbacks[e]},n.prototype.disconnect=function(e){this.client.end(e)}}).call(this,e("_process"))},{"./ajax":94,"./dataelement":96,"./logger":101,"./ua":107,_process:12,mqtt:46}],107:[function(e,t,r){t.exports={isAndroidStandardBrowser:function(){var e=navigator.userAgent;return e.indexOf("Android")>=0&&e.indexOf("Chrome")<0&&e.indexOf("Firefox")<0?!0:e.indexOf("MSIE 10")>=0?!0:!1}}},{}]},{},[102]);","ﾂ�":"\\u008b","ﾂ�":"\\u008c","ﾂ�":"\\u008d","ﾂ�":"\\u008e","ﾂ�":"\\u008f","ﾂ�":"\\u0090","ﾂ�":"\\u0091","ﾂ�":"\\u0092","ﾂ�":"\\u0093","ﾂ�":"\\u0094","ﾂ�":"\\u0095","ﾂ�":"\\u0096","ﾂ�":"\\u0097","ﾂ�":"\\u0098","ﾂ�":"\\u0099","ﾂ�":"\\u009a","ﾂ�":"\\u009b","ﾂ�":"\\u009c","ﾂ�":"\\u009d","ﾂ�":"\\u009e","ﾂ�":"\\u009f","ﾂｭ":"\\u00ad","ﾘ":"\\u0600","ﾘ�":"\\u0601","ﾘ�":"\\u0602","ﾘ�":"\\u0603","ﾘ�":"\\u0604","ﾜ�":"\\u070f","癰ｴ":"\\u17b4","癰ｵ":"\\u17b5","窶�":"\\u200c","窶�":"\\u200d","窶�":"\\u200e","窶�":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","窶ｪ":"\\u202a","窶ｫ":"\\u202b","窶ｬ":"\\u202c","窶ｭ":"\\u202d","窶ｮ":"\\u202e","窶ｯ":"\\u202f","竅�":"\\u2060","竅｡":"\\u2061","竅｢":"\\u2062","竅｣":"\\u2063","竅､":"\\u2064","竅･":"\\u2065","竅ｦ":"\\u2066","竅ｧ":"\\u2067","竅ｨ":"\\u2068","竅ｩ":"\\u2069","竅ｪ":"\\u206a","竅ｫ":"\\u206b","竅ｬ":"\\u206c","竅ｭ":"\\u206d","竅ｮ":"\\u206e","竅ｯ":"\\u206f","\ufeff":"\\ufeff","�ｰ":"\\ufff0","�ｱ":"\\ufff1","�ｲ":"\\ufff2","�ｳ":"\\ufff3","�ｴ":"\\ufff4","�ｵ":"\\ufff5","�ｶ":"\\ufff6","�ｷ":"\\ufff7","�ｸ":"\\ufff8","�ｹ":"\\ufff9","�ｺ":"\\ufffa","�ｻ":"\\ufffb","�ｼ":"\\ufffc","�ｽ":"\\ufffd","�ｾ":"\\ufffe","�ｿ":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h=JSON&&JSON.stringify||function(e){
return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,r={},n=[];for(t=0;65536>t;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return r[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,r};r.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(u||(u=p(l)),t.replace(l,function(e){return u[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){for(var e={},t=0;t<d.length;t++){var r=d[t];e[r]=k[r]&&k[r].enabled()}return e},r.detectProtocols=function(e,t,r){var n={},i=[];t||(t=d);for(var o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}var a=function(e){var t=e.shift();n[t]?i.push(t):e.length>0&&a(e)};return r.websocket!==!1&&a(["websocket"]),n["xhr-streaming"]&&!r.null_origin?i.push("xhr-streaming"):!n["xdr-streaming"]||r.cookie_needed||r.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),n["xhr-polling"]&&!r.null_origin?i.push("xhr-polling"):!n["xdr-polling"]||r.cookie_needed||r.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";r.createHook=function(){var t="a"+r.random_string(8);if(!(g in e)){var n={};e[g]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return e[g](t)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.addEventListener(r,n,!1):(t.attachEvent("on"+r,n),e.attachEvent("on"+r,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.removeEventListener(r,n,!1):(t.detachEvent("on"+r,n),e.detachEvent("on"+r,n))};var m={},v=!1,b=function(){for(var e in m)m[e](),delete m[e]},_=function(){v||(v=!0,b())};r.attachEvent("unload",_),r.unload_add=function(e){var t=r.random_string(8);return m[t]=e,v&&r.delay(b),t},r.unload_del=function(e){e in m&&delete m[e]},r.createIframe=function(e,n){var i,o,s=t.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unload_del(o))},c=function(e){s&&(u(),n(e))},f=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),i=setTimeout(function(){c("timeout")},15e3),o=r.unload_add(u),{post:f,cleanup:u,loaded:a}},r.createHtmlfile=function(t,n){var i,o,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},f=function(){u&&(c(),r.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(e){u&&(f(),n(e))},h=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var p=u.createElement("div");return u.body.appendChild(p),s=u.createElement("iframe"),p.appendChild(s),s.src=t,i=setTimeout(function(){l("timeout")},15e3),o=r.unload_add(f),{post:h,cleanup:f,loaded:c}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(t,n,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=r.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,n,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var c in o.headers)s.xhr.setRequestHeader(c,o.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,r=e.responseText}catch(e){}1223===t&&(t=204),r&&r.length>0&&s.emit("chunk",t,r);break;case 4:var t=e.status;1223===t&&(t=204),s.emit("finish",t,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};S.prototype=new y;var E=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,n){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:B.enabled()?3:4};var k=function(t,n,i){if(this===e)return new k(t,n,i);var o,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&r.objectExtend(s._options,i),s._base_url=r.amendUrl(t),s._server=s._options.server||r.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?o=s._options.protocols_whitelist:(o="string"==typeof n&&n.length>0?[n]:r.isArray(n)?n:null,o&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=z(s._base_url),s._ir.onfinish=function(e,t){s._ir=null,e?(s._options.info&&(e=r.objectExtend(e,s._options.info)),s._options.rtt&&(t=s._options.rtt),s._applyInfo(e,t,o),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new n,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},k.prototype._dispatchOpen=function(){var e=this;e.readyState===k.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=k.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("message",{data:e}))},k.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},k.prototype._didClose=function(e,t,n){var o=this;if(o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN&&o.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:r.userSetCode(e)});if(!r.userSetCode(e)&&o.readyState===k.CONNECTING&&!n){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=k.CLOSED,r.delay(function(){o.dispatchEvent(s)})},k.prototype._didMessage=function(e){var t=this,r=e.slice(0,1);switch(r){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var i=n.protocol=n._protocols.shift();if(!i)return!1;if(k[i]&&k[i].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(i),n.protocol="waiting-for-load",r.attachEvent("load",function(){n._try_next_protocol()}),!0;if(k[i]&&k[i].enabled(n._options)){var o=k[i].roundTrips||1,s=(n._options.rto||0)*o||5e3;n._transport_tref=r.delay(s,function(){n.readyState===k.CONNECTING&&n._didClose(2007,"Transport timeouted")});var a=r.random_string(8),u=n._base_url+"/"+n._server+"/"+a;return n._debug("Opening transport:",i," url:"+u," RTO:"+n._options.rto),n._transport=new k[i](n,u,n._base_url),!0}n._debug("Skipping transport:",i)}},k.prototype.close=function(e,t){var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==k.CONNECTING&&n.readyState!==k.OPEN?!1:(n.readyState=k.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},k.prototype.send=function(e){var t=this;if(t.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===k.OPEN&&t._transport.doSend(r.quote(""+e)),!0},k.prototype._applyInfo=function(e,n,i){var o=this;o._options.info=e,o._options.rtt=n,o._options.rto=r.countRTO(n),o._options.info.null_origin=!t.domain;var s=r.probeProtocols();o._protocols=r.detectProtocols(s,i,e)};var x=k.websocket=function(t,n){var i=this,o=n+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=t,i.url=o;var s=e.WebSocket||e.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=r.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(e){this.ws.send("["+e+"]")},x.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var j=function(){};j.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},j.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},j.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},j.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,r){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+r):e.send_schedule_wait()}),e.send_buffer=[]}},j.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(e,n,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=t.createElement("form"),a=o._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+r.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=n}catch(l){r.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var h=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,r.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",i(!0))};return c.onerror=c.onload=h,c.onreadystatechange=function(e){"complete"==c.readyState&&h()},h},M=function(e){return function(t,r,n){var i=new e("POST",t+"/xhr_send",r);return i.onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},O=function(e,n){var i,o,s=t.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,n(e),n=null)},u=!1,c=null;if(s.id="a"+r.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){c||(c=setTimeout(function(){u||a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))o=t.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),o&&l.insertBefore(o,l.firstChild),a},R=k["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(I),n._schedule_recv()};R.prototype=new j,R.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",O,t)},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(t,n,i){var o="a"+r.random_string(6),s=t+"?c="+escape(a+"."+o),u=0,c=function(t){switch(u){case 0:delete e[a][o],i(t);break;case 1:i(t),u=2;break;case 2:delete e[a][o]}},f=n(s,c);e[a][o]=f;var l=function(){e[a][o]&&(u=1,e[a][o](r.closeFrame(1e3,"JSONP user aborted read")))};return l},T=function(){};T.prototype=new j,T.prototype.run=function(e,t,r,n,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(M(i)),o.poll=new V(e,n,t+r,i)},T.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var C=k["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XHRCorsObject)};C.prototype=new T,C.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},C.roundTrips=2,C.need_body=!0;var A=k["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XDRObject)};A.prototype=new T,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var U=k["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRCorsObject)};U.prototype=new T,U.enabled=C.enabled,U.roundTrips=2;var q=k["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XDRObject)};q.prototype=new T,q.enabled=A.enabled,q.roundTrips=2;var B=function(){};B.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},B.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},B.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var r=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(r===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([k.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},B.prototype.postMessage=function(e,t){var r=this;r.iframeObj.post(r.window_id+e+(t||""),r.origin)},B.prototype.doSend=function(e){this.postMessage("m",e)},B.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var N,P=function(t,n){parent!==e?parent.postMessage(N+t+(n||""),"*"):r.log("Can't postMessage, no parent window.",t,n)},D=function(){};D.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},D.prototype._didMessage=function(e){P("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},r.parent_origin=void 0,k.bootstrap_iframe=function(){var n;N=t.location.hash.slice(1);var i=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var i=t.data.slice(0,8),o=t.data.slice(8,9),s=t.data.slice(9);if(i===N)switch(o){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==k.version&&r.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+k.version+'".'),!r.flatUrl(f)||!r.flatUrl(l))return void r.log("Only basic urls are supported in SockJS");if(!r.isSameOriginUrl(f)||!r.isSameOriginUrl(l))return void r.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");n=new D,n._transport=new D[c](n,f,l);break;case"m":n._doSend(s);break;case"c":n&&n._doCleanup(),n=null}}};r.attachMessage(i),P("s")};var W=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};W.prototype=new o(["finish"]),W.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=r.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var r=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var H=function(e){var n=this,i=function(){var t=new B;t.protocol="w-iframe-info-receiver";var r=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var r=JSON.parse(e.substr(1)),i=r[0],o=r[1];n.emit("finish",i,o)}else n.emit("finish");t.doCleanup(),t=null},i={_options:{},_didClose:r,_didMessage:r};t.i_constructor(i,e,e)};t.body?i():r.attachEvent("load",i)};H.prototype=new o(["finish"]);var F=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new o(["finish"]);var z=function(e){if(r.isSameOriginUrl(e))return new W(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new W(e,r.XHRLocalObject);case 2:return new W(e,r.XDRObject);case 3:return new H(e);default:return new F}},J=D["w-iframe-info-receiver"]=function(e,t,n){var i=new W(n,r.XHRLocalObject);i.onfinish=function(t,r){e._didMessage("m"+JSON.stringify([t,r])),e._didClose()}};J.prototype.doCleanup=function(){};var X=k["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};X.prototype=new B,X.enabled=function(){return"EventSource"in e&&B.enabled()},X.need_body=!0,X.roundTrips=3;var G=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,r.XHRLocalObject)};G.prototype=new T;var K=k["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};K.prototype=new B,K.enabled=function(){return e.XMLHttpRequest&&B.enabled()},K.need_body=!0,K.roundTrips=3;var Y=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRLocalObject)};Y.prototype=new T;var Q=k["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new B,Q.enabled=function(){return B.enabled()},Q.need_body=!0,Q.roundTrips=3;var $=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",re,r.XHRLocalObject)};$.prototype=new T;var V=function(e,t,r,n){var i=this;i.ri=e,i.Receiver=t,i.recv_url=r,i.AjaxObject=n,i._scheduleRecv()};V.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),r=0;t.onmessage=function(t){r+=1,e.ri._didMessage(t.data)},t.onclose=function(r){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===r.reason?e.ri._didClose(1006,"Polling error ("+r.reason+")"):e._scheduleRecv())}},V.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,o){var s=o?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Z.prototype=new n,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var ee,te=function(){if(void 0===ee)if("ActiveXObject"in e)try{ee=!!new ActiveXObject("htmlfile")}catch(t){}else ee=!1;return ee},re=function(t){var n=this;r.polluteGlobalNamespace(),n.id="a"+r.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+n.id);var o,s=te()?r.createHtmlfile:r.createIframe;e[a][n.id]={start:function(){o.loaded()},message:function(e){n.dispatchEvent(new i("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,r){o.cleanup(),n.iframe_close=o=null,delete e[a][n.id],n.dispatchEvent(new i("close",{reason:r}))},o=s(t,function(e){n.iframe_close({},"permanent")})};re.prototype=new n,re.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var ne=function(e,t){var r=this,n=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(n),s=o.indexOf("\n");if(-1===s)break;n+=s+1;var a=o.slice(0,s);r.dispatchEvent(new i("message",{data:a}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null;var n=200===e?"network":"permanent";r.dispatchEvent(new i("close",{reason:n}))}};return ne.prototype=new n,ne.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},k.getUtils=function(){return r},k.getIframeTransport=function(){return B},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}],94:[function(e,t,r){(function(r){function n(e,t,r,n,i,o,c,f){function l(e){if(f){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){f(null,JSON.parse(t))})}}var h=t?a:s;c["Content-Type"]="application/x-www-form-urlencoded";var p={hostname:r,port:n||(t?443:80),path:i,method:e,headers:c};if("GET"==e){var d=u.stringify(o);p.path+="?"+d,h.get(p,l).on("error",function(e){f(e)})}else{var g=h.request(p,l);g.setTimeout(5e3),g.on("timeout",function(){f&&f(new Error("timed out"),null),g.abort()}),g.on("error",function(e){f&&f(e,null)});var d=u.stringify(o);g.write(d),g.end()}}function i(e,t,r,n,i,s,a,c){var f=u.stringify(s),l=(t?"https://":"http://")+r+":"+n+i;"GET"==e&&(l+="?"+f);var h=o(e,l);h.withCredentials=!0,h.onload=function(){decoded="";try{var e=JSON.parse(h.responseText);c(null,e)}catch(t){c(null,JSON.parse(h.responseText))}},h.onerror=function(){c(h.statusText||"unknown error")},h.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(header_key in a)h.setRequestHeader(header_key,a[header_key]);h.send(f)}function o(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}var s=e("http"),a=e("https"),u=e("querystring");t.exports="browser"!==r.title?{request:n}:{request:i}}).call(this,e("_process"))},{_process:12,http:31,https:8,querystring:16}],95:[function(e,t,r){function n(e){if(0==e)return"";var t=Math.floor(62*Math.random())%62;return n(e-1)+i[t]}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.exports=n},{}],96:[function(e,t,r){function n(){}var i=e("./transporter");t.exports=n,n.format=function(e){var t="";e.params&&(e.value=e.params);try{t=i.decode(e.value)}catch(r){t=e.value}return{id:e.id,value:t?"string"==typeof t?JSON.parse(t):t:null,timestamp:e.timestamp}}},{"./transporter":106}],97:[function(e,t,r){function n(e,t){this.milkcocoa=e,this.idGenerator=e.idGenerator,this.path=t}var i=e("./streaming"),o=e("./streaming2"),s=e("./history"),a=e("./dataelement");t.exports=n,n.prototype.transporter=function(){return this.milkcocoa.transporter},n.prototype.push=function(e,t,r){var n=this;if(e instanceof Array)throw new Error("params must not be Array");if("object"!=typeof e)throw new Error("params must be object");this.idGenerator.getNextId(function(i,o){var s=n.milkcocoa.get_time();n.transporter().send_operation_request(n.path,"push",{id:o,ts:s,params:e},t,r)})},n.prototype.set=function(e,t,r,n){if("string"!=typeof e)throw new Error("id must be string");if(t instanceof Array)throw new Error("params must not be Array");if("object"!=typeof t)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"set",{path:this.path,id:e,params:t},r,n)},n.prototype.send=function(e,t,r){if("object"!=typeof e)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"send",{path:this.path,params:e},t,r)},n.prototype.remove=function(e,t,r){if("string"!=typeof e)throw new Error("id must be string");this.transporter().send_operation_request(this.path,"remove",{path:this.path,id:e},t,r)},n.prototype.get=function(e,t){if("string"!=typeof e)throw new Error("id must be string");this.transporter().call("get",{path:this.path,id:e},function(e,r){return r.err?void t(r.err):void t(null,a.format(r.content.d))})},n.prototype.get_many=function(e,t){this.transporter().call("get_many",{path:this.path,ids:JSON.stringify(e)},function(e,r){return r.err?void t(r.err):void t(null,r.content.d.map(a.format))})},n.prototype.count=function(e){e(new Error("deprecated"))},n.prototype.stream=function(){return new i(this.transporter(),this.path)},n.prototype.stream2=function(){return new o(this.transporter(),this.path)},n.prototype.history=function(){return new s(this.transporter(),this.path)},n.prototype.on=function(e,t){this.milkcocoa.listeners.add(e,this.path,t),this.transporter().on(this.path,e)},n.prototype.off=function(e){this.milkcocoa.listeners.del(e,this.path),this.transporter().off(this.path,e)},n.prototype.child=function(e){return new n(this.milkcocoa,this.path+"/"+e)}},{"./dataelement":96,"./history":98,"./streaming":104,"./streaming2":105}],98:[function(e,t,r){function n(e,t){this.stream=new i(e,t),this._times=1,this._limit=null,this._span=null,this.listeners={}}var i=e("./streaming2");n.prototype.sort=function(e){return this.stream.sort(e),this},n.prototype.size=function(e){return this.stream.size(e),this},n.prototype.times=function(e){return this._times=e,this},n.prototype.limit=function(e){return this._limit=e,this},n.prototype.span=function(e,t){return this._span={start:e,end:t},this},n.prototype.on=function(e,t){this.listeners[e]=t},n.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},n.prototype.runTimes=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e--,t.fire("data",n),void(e>0?t.runTimes(e):t.fire("end")))})},n.prototype.runLimit=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e-=n.length,0>e?"DESC"==t.stream.stream._sort?t.fire("data",n.slice(0,n.length+e)):t.fire("data",n.slice(0,n.length+e)):n.length>0&&t.fire("data",n),void(e>0&&n.length>0?t.runLimit(e):t.fire("end")))})},n.prototype.runSpan=function(e){var t=this;this.stream.next(function(r,n){if(r)return void t.fire("error",r);if("DESC"==t.stream.stream._sort)var i=function(t){return t.id>=e};else var i=function(t){return t.id<=e};var o=n.filter(i);o.length>0?(t.fire("data",o),t.runSpan(e)):t.fire("end")})},n.prototype.fire=function(e,t){this.listeners[e]&&this.listeners[e](t)},t.exports=n},{"./streaming2":105}],99:[function(e,t,r){(function(e){function r(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e%62,i=Math.floor(e/62);return 1>i?"":r(i)+t[n]}function n(){var t="ybfghijam6cpqdrw71nx34eo5suz0t9vkl28",n=(new Date).getTime(),i=n,o=null,s=[],a=0,u=1,c=a,f="0000";return{init:function(e){if(e&&"number"==typeof e){n=(new Date).getTime(),i=Math.floor(e/1e3);var t=r(i);f=t.substr(t.length-4)}},getHeader:function(e,t){var r=this,i=(new Date).getTime();if(o==i)setTimeout(function(){r.getHeader(e,t)},1);else{o=i;var s=i-n;t((e+s).toString(36))}},getNextId:function(e){s.push(e),c==a&&this._exec_getNextId()},_exec_getNextId:function(){var e=this,t=s.shift();t?(c=u,this._getNextId(function(r,n){t(r,n),e._exec_getNextId()})):c=a},_getNextId:function(r){function n(e){return 1>=e?t[Math.floor(36*Math.random())]:t[Math.floor(36*Math.random())]+n(e-1)}this.getHeader(i,function(t){var i=t+f+n(3);15!=i.length&&(e.console&&console.error("generated id is wrong.",i.length),i=i.substr(0,15)),r(null,i)})}}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(e,t,r){function n(){var e={push:{},set:{},remove:{},send:{}};return{add:function(t,r,n){e[t][r]||(e[t][r]=[]),e[t][r].push(n)},del:function(t,r){e[t][r]=[]},fire:function(t,r,n){e[t][r].forEach(function(e){e(n)})},get_subscribes:function(){var t=[];for(var r in e)for(var n in e[r])t.push({event:r,path:n});return t}}}t.exports=n},{}],101:[function(e,t,r){(function(e){t.exports="browser"!==e.title?{mode:!1,log:function(){this.mode&&console.log(arguments)},error:function(){this.mode&&console.error(arguments)}}:{mode:!1,log:function(){window.console&&this.mode&&console.log(arguments)},error:function(){window.console&&this.mode&&console.error(arguments)}}}).call(this,e("_process"))},{_process:12}],102:[function(e,t,r){(function(r){function n(e,t){if(this.host=e,this.option=t||{},this.file_path=this.option.file_path||"/var/lib/mlkcca",this.storage=new u(this.file_path),this.app_id=this.option.app_id||this.host.match(/([a-z0-9]+)\.mlkcca\.com/)[1],!this.app_id)throw new Error("app_id must be specified");this.option.clientId||(this.option.clientId="js"+this.app_id.substr(this.app_id.length-5)+c(16)),this.option.app_id=this.app_id,this.listeners=new o,this.idGenerator=new i,this.connect()}var i=e("./idgenerator"),o=e("./listeners"),s=e("./transporter"),a=e("./datastore"),u=(e("./logger"),e("./storage")),c=(e("./dataelement"),e("./clientid"));n.prototype.connect=function(e){function t(t){r.start_ts=(new Date).getTime(),r.idGenerator.init(t),r.server_ts=Math.floor(t/1e3),e&&e()}var r=this,n=null,i=this.storage.get("mlkcca_sid");i&&(n=i.sid),this.transporter=new s(this.host,this.option,n,t),this.transporter.onMessage(function(e){if(e.content.hasOwnProperty("params"))if("string"==typeof e.content.params)e.content.params=JSON.parse(e.content.params);else if("object"!=typeof e.content.params)throw new Error("unknown params");switch(e.event){case"push":r.listeners.fire("push",e.path,{id:e.content.id,path:e.path,value:e.content.params,timestamp:e.content.ts});break;case"set":r.listeners.fire("set",e.path,{id:e.content.id,path:e.path,value:e.content.params});break;case"remove":r.listeners.fire("remove",e.path,{id:e.content.id,path:e.path});break;case"send":r.listeners.fire("send",e.path,{path:e.path,value:e.content.params});break;case"success":console.log("success",e)}}),this.server_ts=(new Date).getTime(),this.start_ts=(new Date).getTime()},n.prototype.onConnected=function(e){this.transporter.onConnected(e);

},n.prototype.onClosed=function(e){this.transporter.onClosed(e)},n.prototype.onError=function(e){this.transporter.onError(e)},n.prototype.get_time=function(){var e=(new Date).getTime()-this.start_ts;return Math.floor(this.server_ts+e)},n.connectWithAuth=function(e,t,r){var i=r||{};i.token=t;var o=new n(e,i);return o.authWithToken(t,function(e){}),o},n.connectWithApiKey=function(e,t,r,i){var o=i||{};o.apikey=t,o.apisecret=r;var s=new n(e,o);return s},n.prototype.disconnect=function(e){this.transporter.disconnect(e)},n.prototype.reconnect=function(e){var t=this;this.transporter.disconnect(function(){t.connect(function(){t.listeners.get_subscribes().forEach(function(e){t.transporter.on(e.path,e.event)}),e&&e()})})},n.prototype.dataStore=function(e){if("string"!=typeof e)throw new Error("path must be string");return new a(this,e)},n.prototype.authWithToken=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginwithtoken",{token:e},function(e,n){return e?void t(e):n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.authAsAdmin=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginasadmin",{token:e},function(e,n){return n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.user=function(e){var t=this.storage.get("mlkcca_sid"),r={};t&&(r.mlkccasid=t.sid),this.transporter.auth_call("me",r,function(t,r){return r.err?void e(r.err):"notloggedin"==r.content.condition?void e(null,null):void e(r.err,r.content.account)})},n.prototype.getCurrentUser=function(e){this.user(e)},n.prototype.logout=function(e){var t=this,r=this.storage.get("mlkcca_sid"),n={};r&&(n.mlkccasid=r.sid),this.transporter.auth_call("logout",n,function(r){return r&&e?void e(r):void t.reconnect(e)})},"browser"!==r.title?t.exports=n:window.MilkCocoa=n}).call(this,e("_process"))},{"./clientid":95,"./dataelement":96,"./datastore":97,"./idgenerator":99,"./listeners":100,"./logger":101,"./storage":103,"./transporter":106,_process:12}],103:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r)^s;t.push(n.toString(36))}return t.join(",")}function i(e){var t=e.split(","),r="";return t.forEach(function(e){r+=String.fromCharCode(parseInt(e,36)^s)}),r}var o=e("./logger"),s=80,a=null;if("browser"!==r.title){var u=e("fs"),c=e("path");a=function(e){return{set:function(t,r){var i=c.join(e,t);u.writeFileSync(i,n(JSON.stringify(r)))},get:function(t){var r=c.join(e,t);if(!u.existsSync(r))return null;var n=u.readFileSync(r),s=null;try{s=JSON.parse(i(String(n)))}catch(a){o.error("parse error",a)}return s}}}}else a=function(){return{set:function(e,t){window.localStorage&&window.localStorage.setItem(e,n(JSON.stringify(t)))},get:function(e){if(!window.localStorage)return null;var t=window.localStorage.getItem(e),r=null;try{r=JSON.parse(i(t))}catch(n){o.error("parse error",n)}return r}}};t.exports=a}).call(this,e("_process"))},{"./logger":101,_process:12,fs:1,path:11}],104:[function(e,t,r){function n(e,t){this.transporter=e,this.path=t,this._current_id=null,this._size=50,this._sort="DESC",this.onData=null,this.onError=null}var i=e("./dataelement");t.exports=n,n.prototype.sort=n.prototype.order=function(e){return this._sort=e.toUpperCase(),this},n.prototype.size=n.prototype.limit=function(e){return e>999&&(e=999,window.console&&window.console.log("size too large")),this._size=e,this},n.prototype.onData=function(e){this.onData=e},n.prototype.onError=function(e){this.onError=e},n.prototype.next=function(e){return this.exec(e),this},n.prototype.setTimestamp=function(e){return this._current_id=e.toString(36),this},n.prototype.exec=function(e){var t=this,r={path:this.path,limit:this._size,sort:this._sort};this._current_id&&(r.th=this._current_id),this.transporter.call("query",r,function(r,n){if(r)return t.onError&&t.onError(n.err),void(e&&e(r,null));if(null!=n.err)return t.onError&&t.onError(n.err),void(e&&e(n.err,[]));var o=n.content.d.map(i.format);o=o.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),o.length>0&&(t._current_id="ASC"==t._sort?o[o.length-1].id:o[0].id),t.onData&&t.onData(o),e&&e(null,o)})}},{"./dataelement":96}],105:[function(e,t,r){function n(e,t){this.stream=new i(e,t)}var i=e("./streaming");n.prototype.sort=i.prototype.order=function(e){return this.stream.sort(e),this},n.prototype.size=i.prototype.limit=function(e){return this.stream.size(e),this},n.prototype.onData=function(e){this.stream.onData(e)},n.prototype.onError=function(e){this.stream.onError(e)},n.prototype.next=function(e){var t=this;return this.stream.next(function(r,n){null==r&&"DESC"==t.stream._sort?e(r,n.reverse()):e(r,n)}),this},n.prototype.setTimestamp=function(e){return this.stream.setTimestamp(e),this},t.exports=n},{"./streaming":104}],106:[function(e,t,r){(function(r){function n(e,t,n,s){function u(e){h._is_connected=!0,h.flush(),i.log("transporter:onopen",e),s&&s(e),h._onConnected&&h._onConnected()}function c(e){h._is_connected=!1,i.log("transporter:onclose",e),h._onClosed&&h._onClosed()}function f(e){i.log("transporter:onerror",e.message),h._onError&&h._onError(e)}function l(e,t){var r={};if(e==h.app_id+"/$sys/error"){var n=t.readUInt16BE(0),i=t.readUInt16BE(2);return void h.recvError(i,n)}try{r=JSON.parse(h.decode(t))}catch(o){r=JSON.parse(t)}var s=e.indexOf("/"),a=e.lastIndexOf("/"),u=e.substr(s+1,a-s-1),c=e.substr(a+1),f={path:u,event:c,content:r};h._onMessage(f)}var h=this;this.sid=n,this.queue=[],this.error_callbacks={},this.comp_callbacks={},this.request_id=1,this.app_id=t.app_id,this.host=e,this.port=t.port||443,this.http_port=t.http_port||443,this.useSSL=!0,this.qos=0;var p="s"+n||"dammy";t.token&&(p="j"+t.token),t.apikey&&t.apisecret&&(p="k"+t.apikey+":"+t.apisecret,this.apikey={key:t.apikey,secret:t.apisecret}),t.hasOwnProperty("qos")&&(this.qos=t.qos),t.hasOwnProperty("useSSL")&&(this.useSSL=t.useSSL);var d=(this.useSSL?"wss://":"ws://")+e+":"+this.port+"/websocket";"browser"!==r.title?(this.port=this.useSSL?8883:1883,d=(this.useSSL?"mqtts://":"mqtt://")+e+":"+this.port):o.isAndroidStandardBrowser()&&(d=(this.useSSL?"sockjss://":"sockjs://")+e+":"+this.port+"/sockjs"),this.client=a.connect(d,{username:p,clientId:t.clientId,password:t.app_id,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:7e3,clean:!1}),this.client.onConnectionLost=c,this.client.onMessageArrived=l,this.client.on("connect",u),this.client.on("close",c),this.client.on("error",f),this.client.on("message",l),this._is_connected=!1}var i=e("./logger"),o=e("./ua"),s=e("./ajax"),a=e("mqtt"),u=e("./dataelement");t.exports=n,n.prototype.encode=function(e){return e},n.decode=function(e){return decodeURIComponent(e)},n.prototype.decode=function(e){return n.decode(e)},n.prototype.onMessage=function(e){this._onMessage=e},n.prototype.onConnected=function(e){this._onConnected=e},n.prototype.onClosed=function(e){this._onClosed=e},n.prototype.onError=function(e){this._onError=e},n.prototype.auth_call=function(e,t,r){t.cmd=e,t.appid=this.app_id,s.request("POST",this.useSSL,this.host,this.http_port,"/auth",t,{},r)},n.prototype.call=function(e,t,r){t.api=e,t.appid=this.app_id;var n={};this.sid&&(n.Authorization="MLKCCASID "+this.sid),this.apikey&&(n.Authorization="MLKCCAKEY "+this.apikey.key+":"+this.apikey.secret),s.request("GET",this.useSSL,this.host,this.http_port,"/api",t,n,r)},n.prototype.on=function(e,t){this.send({type:"s",topic:this.create_topic(e,t)})},n.prototype.off=function(e,t){this.send({type:"u",topic:this.create_topic(e,t)})},n.prototype.send_operation_request=function(e,t,r,n,i){this.request_id++,this.request_id>12287&&(this.request_id=1),r.r=this.request_id,this.error_callbacks[this.request_id]=i,this.comp_callbacks[this.request_id]=n,this.send({type:"p",topic:this.create_topic(e,t),msg:JSON.stringify(r),request_id:this.request_id})},n.prototype.create_topic=function(e,t){return this.app_id+"/"+e+"/"+t},n.prototype.send=function(e){var t=this;t._is_connected?t.send_op(e):t.queue.push(e)},n.prototype.flush=function(){this.send_next()},n.prototype.send_next=function(){var e=this;if(e._is_connected){var t=e.queue.shift();t&&(e.send_op(t),e.send_next())}},n.prototype.send_op=function(e){var t=this;switch(e.type){case"p":var r=t.encode(e.msg);t.client.publish(e.topic,r,{qos:t.qos,retain:!1},function(r,n){t.recvComp(e.request_id,null,u.format(JSON.parse(e.msg)))});break;case"s":t.client.subscribe(e.topic,{qos:3==t.qos?0:t.qos});break;case"u":t.client.unsubscribe(e.topic)}},n.prototype.recvError=function(e,t){function r(e){switch(e){case 3:return"permission denied";default:return"unknown error"}}var n=r(t);this.error_callbacks[e]?(this.error_callbacks[e](n),delete this.error_callbacks[e]):this._onError&&this._onError(n)},n.prototype.recvComp=function(e,t,r){this.comp_callbacks[e]&&this.comp_callbacks[e](t,r),delete this.comp_callbacks[e]},n.prototype.disconnect=function(e){this.client.end(e)}}).call(this,e("_process"))},{"./ajax":94,"./dataelement":96,"./logger":101,"./ua":107,_process:12,mqtt:46}],107:[function(e,t,r){t.exports={isAndroidStandardBrowser:function(){var e=navigator.userAgent;return e.indexOf("Android")>=0&&e.indexOf("Chrome")<0&&e.indexOf("Firefox")<0?!0:e.indexOf("MSIE 10")>=0?!0:!1}}},{}]},{},[102]);","ﾂ�":"\\u008b","ﾂ�":"\\u008c","ﾂ�":"\\u008d","ﾂ�":"\\u008e","ﾂ�":"\\u008f","ﾂ�":"\\u0090","ﾂ�":"\\u0091","ﾂ�":"\\u0092","ﾂ�":"\\u0093","ﾂ�":"\\u0094","ﾂ�":"\\u0095","ﾂ�":"\\u0096","ﾂ�":"\\u0097","ﾂ�":"\\u0098","ﾂ�":"\\u0099","ﾂ�":"\\u009a","ﾂ�":"\\u009b","ﾂ�":"\\u009c","ﾂ�":"\\u009d","ﾂ�":"\\u009e","ﾂ�":"\\u009f","ﾂｭ":"\\u00ad","ﾘ":"\\u0600","ﾘ�":"\\u0601","ﾘ�":"\\u0602","ﾘ�":"\\u0603","ﾘ�":"\\u0604","ﾜ�":"\\u070f","癰ｴ":"\\u17b4","癰ｵ":"\\u17b5","窶�":"\\u200c","窶�":"\\u200d","窶�":"\\u200e","窶�":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","窶ｪ":"\\u202a","窶ｫ":"\\u202b","窶ｬ":"\\u202c","窶ｭ":"\\u202d","窶ｮ":"\\u202e","窶ｯ":"\\u202f","竅�":"\\u2060","竅｡":"\\u2061","竅｢":"\\u2062","竅｣":"\\u2063","竅､":"\\u2064","竅･":"\\u2065","竅ｦ":"\\u2066","竅ｧ":"\\u2067","竅ｨ":"\\u2068","竅ｩ":"\\u2069","竅ｪ":"\\u206a","竅ｫ":"\\u206b","竅ｬ":"\\u206c","竅ｭ":"\\u206d","竅ｮ":"\\u206e","竅ｯ":"\\u206f","\ufeff":"\\ufeff","�ｰ":"\\ufff0","�ｱ":"\\ufff1","�ｲ":"\\ufff2","�ｳ":"\\ufff3","�ｴ":"\\ufff4","�ｵ":"\\ufff5","�ｶ":"\\ufff6","�ｷ":"\\ufff7","�ｸ":"\\ufff8","�ｹ":"\\ufff9","�ｺ":"\\ufffa","�ｻ":"\\ufffb","�ｼ":"\\ufffc","�ｽ":"\\ufffd","�ｾ":"\\ufffe","�ｿ":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,h=JSON&&JSON.stringify||function(e){
return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return f[e]})),'"'+e+'"'},p=function(e){var t,r={},n=[];for(t=0;65536>t;t++)n.push(String.fromCharCode(t));return e.lastIndex=0,n.join("").replace(e,function(e){return r[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,r};r.quote=function(e){var t=h(e);return l.lastIndex=0,l.test(t)?(u||(u=p(l)),t.replace(l,function(e){return u[e]})):t};var d=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];r.probeProtocols=function(){for(var e={},t=0;t<d.length;t++){var r=d[t];e[r]=k[r]&&k[r].enabled()}return e},r.detectProtocols=function(e,t,r){var n={},i=[];t||(t=d);for(var o=0;o<t.length;o++){var s=t[o];n[s]=e[s]}var a=function(e){var t=e.shift();n[t]?i.push(t):e.length>0&&a(e)};return r.websocket!==!1&&a(["websocket"]),n["xhr-streaming"]&&!r.null_origin?i.push("xhr-streaming"):!n["xdr-streaming"]||r.cookie_needed||r.null_origin?a(["iframe-eventsource","iframe-htmlfile"]):i.push("xdr-streaming"),n["xhr-polling"]&&!r.null_origin?i.push("xhr-polling"):!n["xdr-polling"]||r.cookie_needed||r.null_origin?a(["iframe-xhr-polling","jsonp-polling"]):i.push("xdr-polling"),i};var g="_sockjs_global";r.createHook=function(){var t="a"+r.random_string(8);if(!(g in e)){var n={};e[g]=function(e){return e in n||(n[e]={id:e,del:function(){delete n[e]}}),n[e]}}return e[g](t)},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.addEventListener(r,n,!1):(t.attachEvent("on"+r,n),e.attachEvent("on"+r,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(r,n){"undefined"!=typeof e.addEventListener?e.removeEventListener(r,n,!1):(t.detachEvent("on"+r,n),e.detachEvent("on"+r,n))};var m={},v=!1,b=function(){for(var e in m)m[e](),delete m[e]},_=function(){v||(v=!0,b())};r.attachEvent("unload",_),r.unload_add=function(e){var t=r.random_string(8);return m[t]=e,v&&r.delay(b),t},r.unload_del=function(e){e in m&&delete m[e]},r.createIframe=function(e,n){var i,o,s=t.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(e){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unload_del(o))},c=function(e){s&&(u(),n(e))},f=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};return s.src=e,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2e3)},t.body.appendChild(s),i=setTimeout(function(){c("timeout")},15e3),o=r.unload_add(u),{post:f,cleanup:u,loaded:a}},r.createHtmlfile=function(t,n){var i,o,s,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(i)},f=function(){u&&(c(),r.unload_del(o),s.parentNode.removeChild(s),s=u=null,CollectGarbage())},l=function(e){u&&(f(),n(e))},h=function(e,t){try{s&&s.contentWindow&&s.contentWindow.postMessage(e,t)}catch(r){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[a]=e[a];var p=u.createElement("div");return u.body.appendChild(p),s=u.createElement("iframe"),p.appendChild(s),s.src=t,i=setTimeout(function(){l("timeout")},15e3),o=r.unload_add(f),{post:h,cleanup:f,loaded:c}};var y=function(){};y.prototype=new o(["chunk","finish"]),y.prototype._start=function(t,n,i,o){var s=this;try{s.xhr=new XMLHttpRequest}catch(a){}if(!s.xhr)try{s.xhr=new e.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}(e.ActiveXObject||e.XDomainRequest)&&(n+=(-1===n.indexOf("?")?"?":"&")+"t="+ +new Date),s.unload_ref=r.unload_add(function(){s._cleanup(!0)});try{s.xhr.open(t,n,!0)}catch(u){return s.emit("finish",0,""),void s._cleanup()}if(o&&o.no_credentials||(s.xhr.withCredentials="true"),o&&o.headers)for(var c in o.headers)s.xhr.setRequestHeader(c,o.headers[c]);s.xhr.onreadystatechange=function(){if(s.xhr){var e=s.xhr;switch(e.readyState){case 3:try{var t=e.status,r=e.responseText}catch(e){}1223===t&&(t=204),r&&r.length>0&&s.emit("chunk",t,r);break;case 4:var t=e.status;1223===t&&(t=204),s.emit("finish",t,e.responseText),s._cleanup(!1)}}},s.xhr.send(i)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(r.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(n){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=r.XHRCorsObject=function(){var e=this,t=arguments;r.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=r.XHRLocalObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n,{no_credentials:!0})})};S.prototype=new y;var E=r.XDRObject=function(e,t,n){var i=this;r.delay(function(){i._start(e,t,n)})};E.prototype=new o(["chunk","finish"]),E.prototype._start=function(e,t,n){var i=this,o=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var s=o.ontimeout=o.onerror=function(){i.emit("finish",0,""),i._cleanup(!1)};o.onprogress=function(){i.emit("chunk",200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},i.xdr=o,i.unload_ref=r.unload_add(function(){i._cleanup(!0)});try{i.xdr.open(e,t),i.xdr.send(n)}catch(a){s()}},E.prototype._cleanup=function(e){var t=this;if(t.xdr){if(r.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(n){}t.unload_ref=t.xdr=null}},E.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},r.isXHRCorsCapable=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:e.XDomainRequest&&t.domain?2:B.enabled()?3:4};var k=function(t,n,i){if(this===e)return new k(t,n,i);var o,s=this;s._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},i&&r.objectExtend(s._options,i),s._base_url=r.amendUrl(t),s._server=s._options.server||r.random_number_string(1e3),s._options.protocols_whitelist&&s._options.protocols_whitelist.length?o=s._options.protocols_whitelist:(o="string"==typeof n&&n.length>0?[n]:r.isArray(n)?n:null,o&&s._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),s._protocols=[],s.protocol=null,s.readyState=k.CONNECTING,s._ir=z(s._base_url),s._ir.onfinish=function(e,t){s._ir=null,e?(s._options.info&&(e=r.objectExtend(e,s._options.info)),s._options.rtt&&(t=s._options.rtt),s._applyInfo(e,t,o),s._didClose()):s._didClose(1002,"Can't connect to server",!0)}};k.prototype=new n,k.version="0.3.4",k.CONNECTING=0,k.OPEN=1,k.CLOSING=2,k.CLOSED=3,k.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},k.prototype._dispatchOpen=function(){var e=this;e.readyState===k.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=k.OPEN,e.dispatchEvent(new i("open"))):e._didClose(1006,"Server lost session")},k.prototype._dispatchMessage=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("message",{data:e}))},k.prototype._dispatchHeartbeat=function(e){var t=this;t.readyState===k.OPEN&&t.dispatchEvent(new i("heartbeat",{}))},k.prototype._didClose=function(e,t,n){var o=this;if(o.readyState!==k.CONNECTING&&o.readyState!==k.OPEN&&o.readyState!==k.CLOSING)throw new Error("INVALID_STATE_ERR");o._ir&&(o._ir.nuke(),o._ir=null),o._transport&&(o._transport.doCleanup(),o._transport=null);var s=new i("close",{code:e,reason:t,wasClean:r.userSetCode(e)});if(!r.userSetCode(e)&&o.readyState===k.CONNECTING&&!n){if(o._try_next_protocol(s))return;s=new i("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:s})}o.readyState=k.CLOSED,r.delay(function(){o.dispatchEvent(s)})},k.prototype._didMessage=function(e){var t=this,r=e.slice(0,1);switch(r){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),i=0;i<n.length;i++)t._dispatchMessage(n[i]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":t._dispatchHeartbeat()}},k.prototype._try_next_protocol=function(e){var n=this;for(n.protocol&&(n._debug("Closed transport:",n.protocol,""+e),n.protocol=null),n._transport_tref&&(clearTimeout(n._transport_tref),n._transport_tref=null);;){var i=n.protocol=n._protocols.shift();if(!i)return!1;if(k[i]&&k[i].need_body===!0&&(!t.body||"undefined"!=typeof t.readyState&&"complete"!==t.readyState))return n._protocols.unshift(i),n.protocol="waiting-for-load",r.attachEvent("load",function(){n._try_next_protocol()}),!0;if(k[i]&&k[i].enabled(n._options)){var o=k[i].roundTrips||1,s=(n._options.rto||0)*o||5e3;n._transport_tref=r.delay(s,function(){n.readyState===k.CONNECTING&&n._didClose(2007,"Transport timeouted")});var a=r.random_string(8),u=n._base_url+"/"+n._server+"/"+a;return n._debug("Opening transport:",i," url:"+u," RTO:"+n._options.rto),n._transport=new k[i](n,u,n._base_url),!0}n._debug("Skipping transport:",i)}},k.prototype.close=function(e,t){var n=this;if(e&&!r.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return n.readyState!==k.CONNECTING&&n.readyState!==k.OPEN?!1:(n.readyState=k.CLOSING,n._didClose(e||1e3,t||"Normal closure"),!0)},k.prototype.send=function(e){var t=this;if(t.readyState===k.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===k.OPEN&&t._transport.doSend(r.quote(""+e)),!0},k.prototype._applyInfo=function(e,n,i){var o=this;o._options.info=e,o._options.rtt=n,o._options.rto=r.countRTO(n),o._options.info.null_origin=!t.domain;var s=r.probeProtocols();o._protocols=r.detectProtocols(s,i,e)};var x=k.websocket=function(t,n){var i=this,o=n+"/websocket";o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),i.ri=t,i.url=o;var s=e.WebSocket||e.MozWebSocket;i.ws=new s(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.unload_ref=r.unload_add(function(){i.ws.close()}),i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};x.prototype.doSend=function(e){this.ws.send("["+e+"]")},x.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),r.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},x.enabled=function(){return!(!e.WebSocket&&!e.MozWebSocket)},x.roundTrips=2;var j=function(){};j.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},j.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},j.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=r.delay(25,function(){t.send_stop=null,t.send_schedule()})},j.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,r){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+r):e.send_schedule_wait()}),e.send_buffer=[]}},j.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var I=function(e,n,i){var o=this;if(!("_send_form"in o)){var s=o._send_form=t.createElement("form"),a=o._send_area=t.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),t.body.appendChild(s)}var s=o._send_form,a=o._send_area,u="a"+r.random_string(8);s.target=u,s.action=e+"/jsonp_send?i="+u;var c;try{c=t.createElement('<iframe name="'+u+'">')}catch(f){c=t.createElement("iframe"),c.name=u}c.id=u,s.appendChild(c),c.style.display="none";try{a.value=n}catch(l){r.log("Your browser is seriously broken. Go home! "+l.message)}s.submit();var h=function(e){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,r.delay(500,function(){c.parentNode.removeChild(c),c=null}),a.value="",i(!0))};return c.onerror=c.onload=h,c.onreadystatechange=function(e){"complete"==c.readyState&&h()},h},M=function(e){return function(t,r,n){var i=new e("POST",t+"/xhr_send",r);return i.onfinish=function(e,t){n(200===e||204===e,"http status "+e)},function(e){n(!1,e)}}},O=function(e,n){var i,o,s=t.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(i),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,n(e),n=null)},u=!1,c=null;if(s.id="a"+r.random_string(8),s.src=e,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(e){c||(c=setTimeout(function(){u||a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},s.onload=function(e){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(e){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick){u=!0;try{s.onclick()}catch(t){}}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async&&t.attachEvent)if(/opera/i.test(navigator.userAgent))o=t.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1;else{try{s.htmlFor=s.id,s.event="onclick"}catch(f){}s.async=!0}"undefined"!=typeof s.async&&(s.async=!0),i=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=t.getElementsByTagName("head")[0];return l.insertBefore(s,l.firstChild),o&&l.insertBefore(o,l.firstChild),a},R=k["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var n=this;n.ri=e,n.trans_url=t,n.send_constructor(I),n._schedule_recv()};R.prototype=new j,R.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=L(e.trans_url+"/jsonp",O,t)},R.enabled=function(){return!0},R.need_body=!0,R.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var L=function(t,n,i){var o="a"+r.random_string(6),s=t+"?c="+escape(a+"."+o),u=0,c=function(t){switch(u){case 0:delete e[a][o],i(t);break;case 1:i(t),u=2;break;case 2:delete e[a][o]}},f=n(s,c);e[a][o]=f;var l=function(){e[a][o]&&(u=1,e[a][o](r.closeFrame(1e3,"JSONP user aborted read")))};return l},T=function(){};T.prototype=new j,T.prototype.run=function(e,t,r,n,i){var o=this;o.ri=e,o.trans_url=t,o.send_constructor(M(i)),o.poll=new V(e,n,t+r,i)},T.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var C=k["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XHRCorsObject)};C.prototype=new T,C.enabled=function(){return e.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},C.roundTrips=2,C.need_body=!0;var A=k["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",ne,r.XDRObject)};A.prototype=new T,A.enabled=function(){return!!e.XDomainRequest},A.roundTrips=2;var U=k["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRCorsObject)};U.prototype=new T,U.enabled=C.enabled,U.roundTrips=2;var q=k["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XDRObject)};q.prototype=new T,q.enabled=A.enabled,q.roundTrips=2;var B=function(){};B.prototype.i_constructor=function(e,t,n){var i=this;i.ri=e,i.origin=r.getOrigin(n),i.base_url=n,i.trans_url=t;var o=n+"/iframe.html";i.ri._options.devel&&(o+="?t="+ +new Date),i.window_id=r.random_string(8),o+="#"+i.window_id,i.iframeObj=r.createIframe(o,function(e){i.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),i.onmessage_cb=r.bind(i.onmessage,i),r.attachMessage(i.onmessage_cb)},B.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},B.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var r=e.data.slice(0,8),n=e.data.slice(8,9),i=e.data.slice(9);if(r===t.window_id)switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([k.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(i)}}},B.prototype.postMessage=function(e,t){var r=this;r.iframeObj.post(r.window_id+e+(t||""),r.origin)},B.prototype.doSend=function(e){this.postMessage("m",e)},B.enabled=function(){var t=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof e.postMessage||"object"==typeof e.postMessage)&&!t};var N,P=function(t,n){parent!==e?parent.postMessage(N+t+(n||""),"*"):r.log("Can't postMessage, no parent window.",t,n)},D=function(){};D.prototype._didClose=function(e,t){P("t",r.closeFrame(e,t))},D.prototype._didMessage=function(e){P("t",e)},D.prototype._doSend=function(e){this._transport.doSend(e)},D.prototype._doCleanup=function(){this._transport.doCleanup()},r.parent_origin=void 0,k.bootstrap_iframe=function(){var n;N=t.location.hash.slice(1);var i=function(t){if(t.source===parent&&("undefined"==typeof r.parent_origin&&(r.parent_origin=t.origin),t.origin===r.parent_origin)){var i=t.data.slice(0,8),o=t.data.slice(8,9),s=t.data.slice(9);if(i===N)switch(o){case"s":var a=JSON.parse(s),u=a[0],c=a[1],f=a[2],l=a[3];if(u!==k.version&&r.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+k.version+'".'),!r.flatUrl(f)||!r.flatUrl(l))return void r.log("Only basic urls are supported in SockJS");if(!r.isSameOriginUrl(f)||!r.isSameOriginUrl(l))return void r.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([e.location.href,f,l])+")");n=new D,n._transport=new D[c](n,f,l);break;case"m":n._doSend(s);break;case"c":n&&n._doCleanup(),n=null}}};r.attachMessage(i),P("s")};var W=function(e,t){var n=this;r.delay(function(){n.doXhr(e,t)})};W.prototype=new o(["finish"]),W.prototype.doXhr=function(e,t){var n=this,i=(new Date).getTime(),o=new t("GET",e+"/info"),s=r.delay(8e3,function(){o.ontimeout()});o.onfinish=function(e,t){if(clearTimeout(s),s=null,200===e){var r=(new Date).getTime()-i,o=JSON.parse(t);"object"!=typeof o&&(o={}),n.emit("finish",o,r)}else n.emit("finish")},o.ontimeout=function(){o.close(),n.emit("finish")}};var H=function(e){var n=this,i=function(){var t=new B;t.protocol="w-iframe-info-receiver";var r=function(e){if("string"==typeof e&&"m"===e.substr(0,1)){var r=JSON.parse(e.substr(1)),i=r[0],o=r[1];n.emit("finish",i,o)}else n.emit("finish");t.doCleanup(),t=null},i={_options:{},_didClose:r,_didMessage:r};t.i_constructor(i,e,e)};t.body?i():r.attachEvent("load",i)};H.prototype=new o(["finish"]);var F=function(){var e=this;r.delay(function(){e.emit("finish",{},2e3)})};F.prototype=new o(["finish"]);var z=function(e){if(r.isSameOriginUrl(e))return new W(e,r.XHRLocalObject);switch(r.isXHRCorsCapable()){case 1:return new W(e,r.XHRLocalObject);case 2:return new W(e,r.XDRObject);case 3:return new H(e);default:return new F}},J=D["w-iframe-info-receiver"]=function(e,t,n){var i=new W(n,r.XHRLocalObject);i.onfinish=function(t,r){e._didMessage("m"+JSON.stringify([t,r])),e._didClose()}};J.prototype.doCleanup=function(){};var X=k["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};X.prototype=new B,X.enabled=function(){return"EventSource"in e&&B.enabled()},X.need_body=!0,X.roundTrips=3;var G=D["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,r.XHRLocalObject)};G.prototype=new T;var K=k["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};K.prototype=new B,K.enabled=function(){return e.XMLHttpRequest&&B.enabled()},K.need_body=!0,K.roundTrips=3;var Y=D["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",ne,r.XHRLocalObject)};Y.prototype=new T;var Q=k["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Q.prototype=new B,Q.enabled=function(){return B.enabled()},Q.need_body=!0,Q.roundTrips=3;var $=D["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",re,r.XHRLocalObject)};$.prototype=new T;var V=function(e,t,r,n){var i=this;i.ri=e,i.Receiver=t,i.recv_url=r,i.AjaxObject=n,i._scheduleRecv()};V.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),r=0;t.onmessage=function(t){r+=1,e.ri._didMessage(t.data)},t.onclose=function(r){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===r.reason?e.ri._didClose(1006,"Polling error ("+r.reason+")"):e._scheduleRecv())}},V.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,n=new EventSource(e);n.onmessage=function(e){t.dispatchEvent(new i("message",{data:unescape(e.data)}))},t.es_close=n.onerror=function(e,o){var s=o?"user":2!==n.readyState?"network":"permanent";t.es_close=n.onmessage=n.onerror=null,n.close(),n=null,r.delay(200,function(){t.dispatchEvent(new i("close",{reason:s}))})}};Z.prototype=new n,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var ee,te=function(){if(void 0===ee)if("ActiveXObject"in e)try{ee=!!new ActiveXObject("htmlfile")}catch(t){}else ee=!1;return ee},re=function(t){var n=this;r.polluteGlobalNamespace(),n.id="a"+r.random_string(6,26),t+=(-1===t.indexOf("?")?"?":"&")+"c="+escape(a+"."+n.id);var o,s=te()?r.createHtmlfile:r.createIframe;e[a][n.id]={start:function(){o.loaded()},message:function(e){n.dispatchEvent(new i("message",{data:e}))},stop:function(){n.iframe_close({},"network")}},n.iframe_close=function(t,r){o.cleanup(),n.iframe_close=o=null,delete e[a][n.id],n.dispatchEvent(new i("close",{reason:r}))},o=s(t,function(e){n.iframe_close({},"permanent")})};re.prototype=new n,re.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var ne=function(e,t){var r=this,n=0;r.xo=new t("POST",e,null),r.xo.onchunk=function(e,t){if(200===e)for(;;){var o=t.slice(n),s=o.indexOf("\n");if(-1===s)break;n+=s+1;var a=o.slice(0,s);r.dispatchEvent(new i("message",{data:a}))}},r.xo.onfinish=function(e,t){r.xo.onchunk(e,t),r.xo=null;var n=200===e?"network":"permanent";r.dispatchEvent(new i("close",{reason:n}))}};return ne.prototype=new n,ne.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new i("close",{reason:"user"})),e.xo=null)},k.getUtils=function(){return r},k.getIframeTransport=function(){return B},k}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),module.exports=SockJS},{}],94:[function(e,t,r){(function(r){function n(e,t,r,n,i,o,c,f){function l(e){if(f){var t="";e.on("data",function(e){t+=e}),e.on("end",function(){f(null,JSON.parse(t))})}}var h=t?a:s;c["Content-Type"]="application/x-www-form-urlencoded";var p={hostname:r,port:n||(t?443:80),path:i,method:e,headers:c};if("GET"==e){var d=u.stringify(o);p.path+="?"+d,h.get(p,l).on("error",function(e){f(e)})}else{var g=h.request(p,l);g.setTimeout(5e3),g.on("timeout",function(){f&&f(new Error("timed out"),null),g.abort()}),g.on("error",function(e){f&&f(e,null)});var d=u.stringify(o);g.write(d),g.end()}}function i(e,t,r,n,i,s,a,c){var f=u.stringify(s),l=(t?"https://":"http://")+r+":"+n+i;"GET"==e&&(l+="?"+f);var h=o(e,l);h.withCredentials=!0,h.onload=function(){decoded="";try{var e=JSON.parse(h.responseText);c(null,e)}catch(t){c(null,JSON.parse(h.responseText))}},h.onerror=function(){c(h.statusText||"unknown error")},h.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(header_key in a)h.setRequestHeader(header_key,a[header_key]);h.send(f)}function o(e,t){var r=new XMLHttpRequest;return"withCredentials"in r?r.open(e,t,!0):"undefined"!=typeof XDomainRequest?(r=new XDomainRequest,r.open(e,t)):r=null,r}var s=e("http"),a=e("https"),u=e("querystring");t.exports="browser"!==r.title?{request:n}:{request:i}}).call(this,e("_process"))},{_process:12,http:31,https:8,querystring:16}],95:[function(e,t,r){function n(e){if(0==e)return"";var t=Math.floor(62*Math.random())%62;return n(e-1)+i[t]}var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";t.exports=n},{}],96:[function(e,t,r){function n(){}var i=e("./transporter");t.exports=n,n.format=function(e){var t="";e.params&&(e.value=e.params);try{t=i.decode(e.value)}catch(r){t=e.value}return{id:e.id,value:t?"string"==typeof t?JSON.parse(t):t:null,timestamp:e.timestamp}}},{"./transporter":106}],97:[function(e,t,r){function n(e,t){this.milkcocoa=e,this.idGenerator=e.idGenerator,this.path=t}var i=e("./streaming"),o=e("./streaming2"),s=e("./history"),a=e("./dataelement");t.exports=n,n.prototype.transporter=function(){return this.milkcocoa.transporter},n.prototype.push=function(e,t,r){var n=this;if(e instanceof Array)throw new Error("params must not be Array");if("object"!=typeof e)throw new Error("params must be object");this.idGenerator.getNextId(function(i,o){var s=n.milkcocoa.get_time();n.transporter().send_operation_request(n.path,"push",{id:o,ts:s,params:e},t,r)})},n.prototype.set=function(e,t,r,n){if("string"!=typeof e)throw new Error("id must be string");if(t instanceof Array)throw new Error("params must not be Array");if("object"!=typeof t)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"set",{path:this.path,id:e,params:t},r,n)},n.prototype.send=function(e,t,r){if("object"!=typeof e)throw new Error("params must be object");this.transporter().send_operation_request(this.path,"send",{path:this.path,params:e},t,r)},n.prototype.remove=function(e,t,r){if("string"!=typeof e)throw new Error("id must be string");this.transporter().send_operation_request(this.path,"remove",{path:this.path,id:e},t,r)},n.prototype.get=function(e,t){if("string"!=typeof e)throw new Error("id must be string");this.transporter().call("get",{path:this.path,id:e},function(e,r){return r.err?void t(r.err):void t(null,a.format(r.content.d))})},n.prototype.get_many=function(e,t){this.transporter().call("get_many",{path:this.path,ids:JSON.stringify(e)},function(e,r){return r.err?void t(r.err):void t(null,r.content.d.map(a.format))})},n.prototype.count=function(e){e(new Error("deprecated"))},n.prototype.stream=function(){return new i(this.transporter(),this.path)},n.prototype.stream2=function(){return new o(this.transporter(),this.path)},n.prototype.history=function(){return new s(this.transporter(),this.path)},n.prototype.on=function(e,t){this.milkcocoa.listeners.add(e,this.path,t),this.transporter().on(this.path,e)},n.prototype.off=function(e){this.milkcocoa.listeners.del(e,this.path),this.transporter().off(this.path,e)},n.prototype.child=function(e){return new n(this.milkcocoa,this.path+"/"+e)}},{"./dataelement":96,"./history":98,"./streaming":104,"./streaming2":105}],98:[function(e,t,r){function n(e,t){this.stream=new i(e,t),this._times=1,this._limit=null,this._span=null,this.listeners={}}var i=e("./streaming2");n.prototype.sort=function(e){return this.stream.sort(e),this},n.prototype.size=function(e){return this.stream.size(e),this},n.prototype.times=function(e){return this._times=e,this},n.prototype.limit=function(e){return this._limit=e,this},n.prototype.span=function(e,t){return this._span={start:e,end:t},this},n.prototype.on=function(e,t){this.listeners[e]=t},n.prototype.run=function(){this._span?"DESC"==this.stream.stream._sort?(this.stream.setTimestamp(this._span.end),this.runSpan(this._span.start.toString(36))):(this.stream.setTimestamp(this._span.start),this.runSpan(this._span.end.toString(36))):this._limit?this.runLimit(this._limit):this.runTimes(this._times)},n.prototype.runTimes=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e--,t.fire("data",n),void(e>0?t.runTimes(e):t.fire("end")))})},n.prototype.runLimit=function(e){var t=this;this.stream.next(function(r,n){return r?void t.fire("error",r):(e-=n.length,0>e?"DESC"==t.stream.stream._sort?t.fire("data",n.slice(0,n.length+e)):t.fire("data",n.slice(0,n.length+e)):n.length>0&&t.fire("data",n),void(e>0&&n.length>0?t.runLimit(e):t.fire("end")))})},n.prototype.runSpan=function(e){var t=this;this.stream.next(function(r,n){if(r)return void t.fire("error",r);if("DESC"==t.stream.stream._sort)var i=function(t){return t.id>=e};else var i=function(t){return t.id<=e};var o=n.filter(i);o.length>0?(t.fire("data",o),t.runSpan(e)):t.fire("end")})},n.prototype.fire=function(e,t){this.listeners[e]&&this.listeners[e](t)},t.exports=n},{"./streaming2":105}],99:[function(e,t,r){(function(e){function r(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=e%62,i=Math.floor(e/62);return 1>i?"":r(i)+t[n]}function n(){var t="ybfghijam6cpqdrw71nx34eo5suz0t9vkl28",n=(new Date).getTime(),i=n,o=null,s=[],a=0,u=1,c=a,f="0000";return{init:function(e){if(e&&"number"==typeof e){n=(new Date).getTime(),i=Math.floor(e/1e3);var t=r(i);f=t.substr(t.length-4)}},getHeader:function(e,t){var r=this,i=(new Date).getTime();if(o==i)setTimeout(function(){r.getHeader(e,t)},1);else{o=i;var s=i-n;t((e+s).toString(36))}},getNextId:function(e){s.push(e),c==a&&this._exec_getNextId()},_exec_getNextId:function(){var e=this,t=s.shift();t?(c=u,this._getNextId(function(r,n){t(r,n),e._exec_getNextId()})):c=a},_getNextId:function(r){function n(e){return 1>=e?t[Math.floor(36*Math.random())]:t[Math.floor(36*Math.random())]+n(e-1)}this.getHeader(i,function(t){var i=t+f+n(3);15!=i.length&&(e.console&&console.error("generated id is wrong.",i.length),i=i.substr(0,15)),r(null,i)})}}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],100:[function(e,t,r){function n(){var e={push:{},set:{},remove:{},send:{}};return{add:function(t,r,n){e[t][r]||(e[t][r]=[]),e[t][r].push(n)},del:function(t,r){e[t][r]=[]},fire:function(t,r,n){e[t][r].forEach(function(e){e(n)})},get_subscribes:function(){var t=[];for(var r in e)for(var n in e[r])t.push({event:r,path:n});return t}}}t.exports=n},{}],101:[function(e,t,r){(function(e){t.exports="browser"!==e.title?{mode:!1,log:function(){this.mode&&console.log(arguments)},error:function(){this.mode&&console.error(arguments)}}:{mode:!1,log:function(){window.console&&this.mode&&console.log(arguments)},error:function(){window.console&&this.mode&&console.error(arguments)}}}).call(this,e("_process"))},{_process:12}],102:[function(e,t,r){(function(r){function n(e,t){if(this.host=e,this.option=t||{},this.file_path=this.option.file_path||"/var/lib/mlkcca",this.storage=new u(this.file_path),this.app_id=this.option.app_id||this.host.match(/([a-z0-9]+)\.mlkcca\.com/)[1],!this.app_id)throw new Error("app_id must be specified");this.option.clientId||(this.option.clientId="js"+this.app_id.substr(this.app_id.length-5)+c(16)),this.option.app_id=this.app_id,this.listeners=new o,this.idGenerator=new i,this.connect()}var i=e("./idgenerator"),o=e("./listeners"),s=e("./transporter"),a=e("./datastore"),u=(e("./logger"),e("./storage")),c=(e("./dataelement"),e("./clientid"));n.prototype.connect=function(e){function t(t){r.start_ts=(new Date).getTime(),r.idGenerator.init(t),r.server_ts=Math.floor(t/1e3),e&&e()}var r=this,n=null,i=this.storage.get("mlkcca_sid");i&&(n=i.sid),this.transporter=new s(this.host,this.option,n,t),this.transporter.onMessage(function(e){if(e.content.hasOwnProperty("params"))if("string"==typeof e.content.params)e.content.params=JSON.parse(e.content.params);else if("object"!=typeof e.content.params)throw new Error("unknown params");switch(e.event){case"push":r.listeners.fire("push",e.path,{id:e.content.id,path:e.path,value:e.content.params,timestamp:e.content.ts});break;case"set":r.listeners.fire("set",e.path,{id:e.content.id,path:e.path,value:e.content.params});break;case"remove":r.listeners.fire("remove",e.path,{id:e.content.id,path:e.path});break;case"send":r.listeners.fire("send",e.path,{path:e.path,value:e.content.params});break;case"success":console.log("success",e)}}),this.server_ts=(new Date).getTime(),this.start_ts=(new Date).getTime()},n.prototype.onConnected=function(e){this.transporter.onConnected(e);

},n.prototype.onClosed=function(e){this.transporter.onClosed(e)},n.prototype.onError=function(e){this.transporter.onError(e)},n.prototype.get_time=function(){var e=(new Date).getTime()-this.start_ts;return Math.floor(this.server_ts+e)},n.connectWithAuth=function(e,t,r){var i=r||{};i.token=t;var o=new n(e,i);return o.authWithToken(t,function(e){}),o},n.connectWithApiKey=function(e,t,r,i){var o=i||{};o.apikey=t,o.apisecret=r;var s=new n(e,o);return s},n.prototype.disconnect=function(e){this.transporter.disconnect(e)},n.prototype.reconnect=function(e){var t=this;this.transporter.disconnect(function(){t.connect(function(){t.listeners.get_subscribes().forEach(function(e){t.transporter.on(e.path,e.event)}),e&&e()})})},n.prototype.dataStore=function(e){if("string"!=typeof e)throw new Error("path must be string");return new a(this,e)},n.prototype.authWithToken=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginwithtoken",{token:e},function(e,n){return e?void t(e):n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.authAsAdmin=function(e,t){if("string"!=typeof e)throw new Error("token must be string");var r=this;this.transporter.auth_call("loginasadmin",{token:e},function(e,n){return n.err?void t(n.err):(r.storage.set("mlkcca_sid",{sid:n.sid}),void r.reconnect(function(){r.user(t)}))})},n.prototype.user=function(e){var t=this.storage.get("mlkcca_sid"),r={};t&&(r.mlkccasid=t.sid),this.transporter.auth_call("me",r,function(t,r){return r.err?void e(r.err):"notloggedin"==r.content.condition?void e(null,null):void e(r.err,r.content.account)})},n.prototype.getCurrentUser=function(e){this.user(e)},n.prototype.logout=function(e){var t=this,r=this.storage.get("mlkcca_sid"),n={};r&&(n.mlkccasid=r.sid),this.transporter.auth_call("logout",n,function(r){return r&&e?void e(r):void t.reconnect(e)})},"browser"!==r.title?t.exports=n:window.MilkCocoa=n}).call(this,e("_process"))},{"./clientid":95,"./dataelement":96,"./datastore":97,"./idgenerator":99,"./listeners":100,"./logger":101,"./storage":103,"./transporter":106,_process:12}],103:[function(e,t,r){(function(r){function n(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r)^s;t.push(n.toString(36))}return t.join(",")}function i(e){var t=e.split(","),r="";return t.forEach(function(e){r+=String.fromCharCode(parseInt(e,36)^s)}),r}var o=e("./logger"),s=80,a=null;if("browser"!==r.title){var u=e("fs"),c=e("path");a=function(e){return{set:function(t,r){var i=c.join(e,t);u.writeFileSync(i,n(JSON.stringify(r)))},get:function(t){var r=c.join(e,t);if(!u.existsSync(r))return null;var n=u.readFileSync(r),s=null;try{s=JSON.parse(i(String(n)))}catch(a){o.error("parse error",a)}return s}}}}else a=function(){return{set:function(e,t){window.localStorage&&window.localStorage.setItem(e,n(JSON.stringify(t)))},get:function(e){if(!window.localStorage)return null;var t=window.localStorage.getItem(e),r=null;try{r=JSON.parse(i(t))}catch(n){o.error("parse error",n)}return r}}};t.exports=a}).call(this,e("_process"))},{"./logger":101,_process:12,fs:1,path:11}],104:[function(e,t,r){function n(e,t){this.transporter=e,this.path=t,this._current_id=null,this._size=50,this._sort="DESC",this.onData=null,this.onError=null}var i=e("./dataelement");t.exports=n,n.prototype.sort=n.prototype.order=function(e){return this._sort=e.toUpperCase(),this},n.prototype.size=n.prototype.limit=function(e){return e>999&&(e=999,window.console&&window.console.log("size too large")),this._size=e,this},n.prototype.onData=function(e){this.onData=e},n.prototype.onError=function(e){this.onError=e},n.prototype.next=function(e){return this.exec(e),this},n.prototype.setTimestamp=function(e){return this._current_id=e.toString(36),this},n.prototype.exec=function(e){var t=this,r={path:this.path,limit:this._size,sort:this._sort};this._current_id&&(r.th=this._current_id),this.transporter.call("query",r,function(r,n){if(r)return t.onError&&t.onError(n.err),void(e&&e(r,null));if(null!=n.err)return t.onError&&t.onError(n.err),void(e&&e(n.err,[]));var o=n.content.d.map(i.format);o=o.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),o.length>0&&(t._current_id="ASC"==t._sort?o[o.length-1].id:o[0].id),t.onData&&t.onData(o),e&&e(null,o)})}},{"./dataelement":96}],105:[function(e,t,r){function n(e,t){this.stream=new i(e,t)}var i=e("./streaming");n.prototype.sort=i.prototype.order=function(e){return this.stream.sort(e),this},n.prototype.size=i.prototype.limit=function(e){return this.stream.size(e),this},n.prototype.onData=function(e){this.stream.onData(e)},n.prototype.onError=function(e){this.stream.onError(e)},n.prototype.next=function(e){var t=this;return this.stream.next(function(r,n){null==r&&"DESC"==t.stream._sort?e(r,n.reverse()):e(r,n)}),this},n.prototype.setTimestamp=function(e){return this.stream.setTimestamp(e),this},t.exports=n},{"./streaming":104}],106:[function(e,t,r){(function(r){function n(e,t,n,s){function u(e){h._is_connected=!0,h.flush(),i.log("transporter:onopen",e),s&&s(e),h._onConnected&&h._onConnected()}function c(e){h._is_connected=!1,i.log("transporter:onclose",e),h._onClosed&&h._onClosed()}function f(e){i.log("transporter:onerror",e.message),h._onError&&h._onError(e)}function l(e,t){var r={};if(e==h.app_id+"/$sys/error"){var n=t.readUInt16BE(0),i=t.readUInt16BE(2);return void h.recvError(i,n)}try{r=JSON.parse(h.decode(t))}catch(o){r=JSON.parse(t)}var s=e.indexOf("/"),a=e.lastIndexOf("/"),u=e.substr(s+1,a-s-1),c=e.substr(a+1),f={path:u,event:c,content:r};h._onMessage(f)}var h=this;this.sid=n,this.queue=[],this.error_callbacks={},this.comp_callbacks={},this.request_id=1,this.app_id=t.app_id,this.host=e,this.port=t.port||443,this.http_port=t.http_port||443,this.useSSL=!0,this.qos=0;var p="s"+n||"dammy";t.token&&(p="j"+t.token),t.apikey&&t.apisecret&&(p="k"+t.apikey+":"+t.apisecret,this.apikey={key:t.apikey,secret:t.apisecret}),t.hasOwnProperty("qos")&&(this.qos=t.qos),t.hasOwnProperty("useSSL")&&(this.useSSL=t.useSSL);var d=(this.useSSL?"wss://":"ws://")+e+":"+this.port+"/websocket";"browser"!==r.title?(this.port=this.useSSL?8883:1883,d=(this.useSSL?"mqtts://":"mqtt://")+e+":"+this.port):o.isAndroidStandardBrowser()&&(d=(this.useSSL?"sockjss://":"sockjs://")+e+":"+this.port+"/sockjs"),this.client=a.connect(d,{username:p,clientId:t.clientId,password:t.app_id,protocolId:"MQTT",protocolVersion:4,reconnectPeriod:7e3,clean:!1}),this.client.onConnectionLost=c,this.client.onMessageArrived=l,this.client.on("connect",u),this.client.on("close",c),this.client.on("error",f),this.client.on("message",l),this._is_connected=!1}var i=e("./logger"),o=e("./ua"),s=e("./ajax"),a=e("mqtt"),u=e("./dataelement");t.exports=n,n.prototype.encode=function(e){return e},n.decode=function(e){return decodeURIComponent(e)},n.prototype.decode=function(e){return n.decode(e)},n.prototype.onMessage=function(e){this._onMessage=e},n.prototype.onConnected=function(e){this._onConnected=e},n.prototype.onClosed=function(e){this._onClosed=e},n.prototype.onError=function(e){this._onError=e},n.prototype.auth_call=function(e,t,r){t.cmd=e,t.appid=this.app_id,s.request("POST",this.useSSL,this.host,this.http_port,"/auth",t,{},r)},n.prototype.call=function(e,t,r){t.api=e,t.appid=this.app_id;var n={};this.sid&&(n.Authorization="MLKCCASID "+this.sid),this.apikey&&(n.Authorization="MLKCCAKEY "+this.apikey.key+":"+this.apikey.secret),s.request("GET",this.useSSL,this.host,this.http_port,"/api",t,n,r)},n.prototype.on=function(e,t){this.send({type:"s",topic:this.create_topic(e,t)})},n.prototype.off=function(e,t){this.send({type:"u",topic:this.create_topic(e,t)})},n.prototype.send_operation_request=function(e,t,r,n,i){this.request_id++,this.request_id>12287&&(this.request_id=1),r.r=this.request_id,this.error_callbacks[this.request_id]=i,this.comp_callbacks[this.request_id]=n,this.send({type:"p",topic:this.create_topic(e,t),msg:JSON.stringify(r),request_id:this.request_id})},n.prototype.create_topic=function(e,t){return this.app_id+"/"+e+"/"+t},n.prototype.send=function(e){var t=this;t._is_connected?t.send_op(e):t.queue.push(e)},n.prototype.flush=function(){this.send_next()},n.prototype.send_next=function(){var e=this;if(e._is_connected){var t=e.queue.shift();t&&(e.send_op(t),e.send_next())}},n.prototype.send_op=function(e){var t=this;switch(e.type){case"p":var r=t.encode(e.msg);t.client.publish(e.topic,r,{qos:t.qos,retain:!1},function(r,n){t.recvComp(e.request_id,null,u.format(JSON.parse(e.msg)))});break;case"s":t.client.subscribe(e.topic,{qos:3==t.qos?0:t.qos});break;case"u":t.client.unsubscribe(e.topic)}},n.prototype.recvError=function(e,t){function r(e){switch(e){case 3:return"permission denied";default:return"unknown error"}}var n=r(t);this.error_callbacks[e]?(this.error_callbacks[e](n),delete this.error_callbacks[e]):this._onError&&this._onError(n)},n.prototype.recvComp=function(e,t,r){this.comp_callbacks[e]&&this.comp_callbacks[e](t,r),delete this.comp_callbacks[e]},n.prototype.disconnect=function(e){this.client.end(e)}}).call(this,e("_process"))},{"./ajax":94,"./dataelement":96,"./logger":101,"./ua":107,_process:12,mqtt:46}],107:[function(e,t,r){t.exports={isAndroidStandardBrowser:function(){var e=navigator.userAgent;return e.indexOf("Android")>=0&&e.indexOf("Chrome")<0&&e.indexOf("Firefox")<0?!0:e.indexOf("MSIE 10")>=0?!0:!1}}},{}]},{},[102]);
